<!DOCTYPE html>

<html lang="en">

<head>
  <link rel="shortcut icon" type="image/jpg" href="/indi/static/favicon.ico">
  <title>pyINDI</title>
  <script src="//code.jquery.com/jquery-1.12.4.js"></script>
  <script src="//code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <!--These libraries are built with pyINDI
and are available at /static/ using
pyINDI's client libarary.-->
  <link rel="stylesheet" href="/indi/static/indi.css">
  <script src="/indi/static/indi.js"></script>
  <script src="/indi/static/utility.js"></script>
  <script src="/indi/static/maps-indi.js"></script>

  <script>
    const CUSTOM_GUI = true;
    const INDI_TYPES = ["tvp", "lvp", "svp", "nvp"]

    //This is a hack to change the behavior of maps-indi.js
    doLess = true;
    const main = () => {
      start = new Date()
      imgs = []
      //Line builds a jquery-ui property. Simply replace handlePropery
      //with your own function to overwrite this behavior. 
      setPropertyCallback("{{ device_name }}.*", handleProperty);
    }

    const handleProperty = (map) => {
      /*
      This function will be called whenever an INDI property
      with the device {{ device_name }} is received. It uses
      jquery-ui to build each vector property as an html fieldset
        */
      switch (map.metainfo) {
        case "nvp":
          ele = newNumber(map);
          break;
        case "svp":
          ele = newSwitch(map);
          break;
        case "tvp":
          ele = newText(map);
          break;
        case "lvp":
          ele = newLight(map);
          break;
      }



      // Returns string if ele exists already
      if (typeof ele != 'string' && !CUSTOM_GUI) {
        vpele = $('span.INDIvp' + '[indiname="' + map.name + '"][indidevice="' + map.device + '"]')
        if (vpele.length > 0) {
          ele.appendTo(vpele)
          console.warn('Appending to vpele');
        }
        else {
          var device = newDevice(map);
          var group = newGroup(map);
          ele.appendTo(group);
        }
      }
      // Update leds depending on state
      if (INDI_TYPES.includes(map.metainfo)) {
        var prop = "background-color" // What you want to change colors for state
        $(ele).find(".led").css(prop, `${indistate2css(map.state)}`)
      }
    }

    const showMapMessage = (map) => {
      // this is called everytime there is an
      //INDImessage from the server. 
      console.log("Message:", map.message);
    }

  </script>
  <style>
    .gui-body {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
    }
  </style>
</head>

<body onload=main()>
  <div class="gui">
    <div class="gui-header">
      <p>90Prime Topbox GUI (Filter Wheel & Focus)</p>
    </div>
    <div class="gui-body">
      <div class="grid-1">
        <section id="settings">
          <p class="section-title">Settings</p>
          <input type="checkbox" checked><label>Hold Focus</label>
          <input type="checkbox"><label>Populate</label>
          <p class="section-title">Setup</p>
          <button>Nominal Plane</button>
          <button>Set Reference Focus</button>
          <button>Restore Reference Focus</button>
          <button>Quit</button>
        </section>
      </div>
      <div class="grid-2">
        <section id="state">
          <p class="section-title">Current State</p>
        </section>
        <section id="filters">
          <p class="section-title">Change Filter</p>
          <input type="radio"><label>A</label>
          <input type="radio"><label>B</label>
          <input type="radio"><label>C</label>
          <input type="radio"><label>D</label>
          <input type="radio"><label>E</label>
          <input type="radio"><label>F</label>
          <p class="section-title">Filter Commands</p>
          <button>Read Filters</button>
          <button>Unload Filter*</button>
          <p class="section-tip">Only meant to be used at end of the night or when power cycling</p>
        </section>
      </div>
      <div class="grid-3">
        <section id="focus">
          <p class="section-title">Focus Offset</p>
          <label>Focus A</label><input type="text">
          <label>Focus B</label><input type="text">
          <label>Focus C</label><input type="text">
          <button>Apply Focus Offset</button>
          <p class="section-title">Goto Focus</p>
          <label>Focus A</label><input type="text">
          <label>Focus B</label><input type="text">
          <label>Focus C</label><input type="text">
          <button>Goto Focus</button>
        </section>
      </div>
    </div>
  </div>
</body>

</html>
