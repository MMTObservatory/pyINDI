<!DOCTYPE html>

<html lang="en" >
<head>
<link rel="shortcut icon" type="image/jpg" href="/indi/static/favicon.ico">
<title>pyINDI</title>
<script src="//code.jquery.com/jquery-1.12.4.js"></script>
<script src="//code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<!--These libraries are built with pyINDI
and are available at /static/ using
pyINDI's client libarary.-->
<link rel="stylesheet" href="/indi/static/indi.css">
<script src="/indi/static/indi.js"></script>
<script src="/indi/static/utility.js"></script>
<script src="/indi/static/maps-indi.js"></script>

<script>
	const INDI_TYPES = ["tvp", "lvp", "svp", "nvp"]

	//This is a hack to change the behavior of maps-indi.js
	doLess = true;
	const main = () => {
		start = new Date()
		imgs = []
		//Line builds a jquery-ui property. Simply replace handlePropery
		//with your own function to overwrite this behavior. 
		setPropertyCallback( "{{ device_name }}.*", handleProperty );
	}

	const handleProperty = (map) => {
		/*
		This function will be called whenever an INDI property
		with the device {{ device_name }} is received. It uses
		jquery-ui to build each vector property as an html fieldset
			*/
		switch( map.metainfo )
		{
			case "nvp":
				ele = newNumber(map);
			break;
			case "svp":
				ele = newSwitch(map);
			break;	
			case "tvp":
				ele = newText(map);
			break;
			case "lvp":
				ele = newLight(map);
			break;
		}



		// Returns string if ele exists already
		// This is because newText would return a jquery selector if new
		// or a string if not new
		if(typeof ele != 'string')
		{	
			vpele = $('span.INDIvp'+'[indiname="'+map.name+'"][indidevice="'+map.device+'"]')
			if(vpele.length > 0) {
				ele.appendTo(vpele)
				console.warn('Appending to vpele');
			}
			else {
				var device = newDevice(map);
				var group = newGroup(map);
				ele.appendTo(group);
			}
		}
		// Update leds depending on state
		if (INDI_TYPES.includes(map.metainfo)) {
			var prop = "background-color" // What you want to change colors for state
			$(ele).find(".led").css(prop, `${indistate2css(map.state)}`)
		}
	}

	const  showMapMessage = (map) => {
		// this is called everytime there is an
		//INDImessage from the server. 
		console.log("Message:", map.message);
	}

</script>
</head>
<body onload=main()>
	
</body>
</html>

