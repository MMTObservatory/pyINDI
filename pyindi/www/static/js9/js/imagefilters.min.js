var ImageFilters;
ImageFilters=function(){function D(c){var d;var a=c.reduce(function(a,c){return a+c});for(d=0;d<c.length;++d)c[d]/=a}function v(c,d,a,b,e){var f,g,h,k,m,q,n,p=Math.round(Math.sqrt(a.length)),r=Math.floor(p/2),l=d.width,t=d.height;var u=l*t*4;var v=d.data;c=c.createImageData(d.width,d.height);for(f=0;f<u;f++)c[f]=v[f];if("[object Array]"!==Object.prototype.toString.call(a))return d;void 0===b&&(b=!0);b=b?1:0;e&&D(a);for(u=0;u<t;u++)for(e=0;e<l;e++){var y=u;f=e;var x=4*(u*l+e);for(h=n=q=m=k=0;h<p;h++)for(g=
0;g<p;g++){var w=Math.min(t-1,Math.max(0,y+h-r));var z=Math.min(l-1,Math.max(0,f+g-r));z=4*(w*l+z);w=a[h*p+g];k+=c[z]*w;m+=c[z+1]*w;q+=c[z+2]*w;n+=c[z+3]*w}v[x]=k;v[x+1]=m;v[x+2]=q;v[x+3]=n+b*(255-n)}return d}function A(c,d,a,b){var e,f,g,h,k,m,q;c=Math.round(Math.sqrt(a.length));var n=Math.floor(c/2),p=d.data,r=d.width;d=d.height;var l=new Float32Array(r*d*4),t=b?1:0;for(e=0;e<d;e++)for(b=0;b<r;b++){var u=e;var v=b;var y=4*(e*r+b);for(g=q=m=k=h=0;g<c;g++)for(f=0;f<c;f++){var x=Math.min(d-1,Math.max(0,
u+g-n));var w=Math.min(r-1,Math.max(0,v+f-n));w=4*(x*r+w);x=a[g*c+f];h+=p[w]*x;k+=p[w+1]*x;m+=p[w+2]*x;q+=p[w+3]*x}l[y]=h;l[y+1]=k;l[y+2]=m;l[y+3]=q+t*(255-q)}return l}function B(c,d){var a=d.data;for(c=0;c<a.length;c+=4){var b=.299*a[c]+.587*a[c+1]+.114*a[c+2];a[c]=a[c+1]=a[c+2]=b}return d}function C(c,d){var a=d.data;for(c=0;c<a.length;c+=4){var b=(a[c]+a[c+1]+a[c+2])/3;a[c]=a[c+1]=a[c+2]=b}return d}return{convolve:v,luminance:function(c,d){var a=d.data;for(c=0;c<a.length;c+=4){var b=.2126*a[c]+
.7152*a[c+1]+.0722*a[c+2];a[c]=a[c+1]=a[c+2]=b}return d},greyscale:B,greyscaleAvg:C,brighten:function(c,d,a){var b,e=d.data;3>arguments.length&&(a=10);for(b=0;b<e.length;b+=4)e[b]+=a,e[b+1]+=a,e[b+2]+=a;return d},noise:function(c,d,a,b){var e,f=d.data;3>arguments.length?(a=-30,b=30):3===arguments.length&&(b=a,a=-a);var g=b-a;for(e=0;e<f.length;e+=4){var h=Math.floor(Math.random()*g-b);f[e]+=h;f[e+1]+=h;f[e+2]+=h}return d},duotone:function(c,d,a){var b=d.data;switch(a){case "r":a=0;break;case "g":a=
1;break;case "b":a=2;break;default:a=0}for(c=0;c<b.length;c+=4){var e=(b[c]+b[c+1]+b[c+2]-b[c+a])/2;b[c+a]=e}return d},invert:function(c,d){var a=d.data;for(c=0;c<a.length;c+=4)a[c]=255-a[c],a[c+1]=255-a[c+1],a[c+2]=255-a[c+2];return d},pixelate:function(c,d,a){var b,e,f,g,h=d.width,k=d.height,m=d.data;3>arguments.length&&(a=2);if(0>=a)return d;var q=2*a;for(e=a;e<k-a;e+=q)for(b=a;b<h-a;b+=q){var n=4*(h*e+b);var p=m[n];var r=m[n+1];var l=m[n+2];for(g=-a;g<a;++g){var t=h*(e+g);for(f=-a;f<a;++f)n=4*
(t+(b+f)),m[n]=p,m[n+1]=r,m[n+2]=l}}for(e=k-(k%q?k%q:q);e<k;e++)for(t=h*e,b=0;b<h;b++)n=4*(b+t),m[n]=0,m[n+1]=0,m[n+2]=0;p=h%q?h%q:q;for(e=0;e<k;e++)for(t=h*e,b=h-p;b<h;b++)n=4*(b+t),m[n]=0,m[n+1]=0,m[n+2]=0;return d},sobel:function(c,d,a){var b=d.data;d=C(c,d);var e=A(c,d,[-1,0,1,-2,0,2,-1,0,1]);var f=A(c,d,[-1,-2,-1,0,0,0,1,2,1]);if(a)for(a=0;a<b.length;a+=4){var g=Math.abs(f[a]);var h=Math.abs(e[a]);b[a]=g;b[a+1]=h;b[a+2]=(g+h)/4}else{for(a=0;a<b.length;a+=4)g=Math.abs(f[a]),h=Math.abs(e[a]),b[a]=
g,b[a+1]=h,b[a+2]=(g+h)/2;B(c,d)}return d},medianFilter:function(c,d){return v(c,d,[1,0,0,0,1,0,1,0,1,0,1,1,1,1,1,0,1,0,1,0,1,0,0,0,1],!0,!0)},sepia:function(c,d,a){var b=d.data;void 0===a&&(a=100);a/=100;for(c=0;c<b.length;c+=4){var e=b[c];var f=b[c+1];var g=b[c+2];b[c]=Math.min(255,e*(1-.607*a)+.769*f*a+.189*g*a);b[c+1]=Math.min(255,.349*e*a+f*(1-.314*a)+.168*g*a);b[c+2]=Math.min(255,.272*e*a+.534*f*a+g*(1-.869*a))}return d},contrast:function(c,d,a){var b,e=d.data;3>arguments.length&&(a=2);-100>
a?a=-100:100<a&&(a=100);for(b=0;b<e.length;b+=4)e[b]=255*((e[b]/255-.5)*a+.5),e[b+1]=255*((e[b+1]/255-.5)*a+.5),e[b+2]=255*((e[b+2]/255-.5)*a+.5);return d},threshold:function(c,d,a,b,e){var f,g=d.data;3>arguments.length?(a=10,b=0,e=255):5>arguments.length&&(b=0,e=255);for(f=0;f<g.length-1;f+=4){var h=g[f];var k=g[f+1];var m=g[f+2];h=.2126*h+.7152*k+.0722*m>=a?e:b;g[f]=g[f+1]=g[f+2]=h}return d},gamma:function(c,d,a){var b,e=d.data;3>arguments.length&&(a=.2);for(b=0;b<e.length;b+=4)e[b]=255*Math.pow(e[b]/
255,a),e[b+1]=255*Math.pow(e[b+1]/255,a),e[b+2]=255*Math.pow(e[b+2]/255,a);return d},gaussBlur5:function(c,d){return v(c,d,[.003,.0133,.0219,.0133,.003,.0133,.0596,.0983,.0596,.0133,.0219,.0983,.1621,.0983,.0219,.0133,.0596,.0983,.0596,.0133,.003,.0133,.0219,.0133,.003])},posterize:function(c,d,a){var b,e=[];var f=1;var g=d.data;3>arguments.length&&(a=40);for(b=0;256>b;++b)b<a*f?e[b]=a*(f-1):(e[b]=a*f,++f);for(b=0;b<g.length;b+=4){f=g[b];var h=g[b+1];var k=g[b+2];g[b]=e[f];g[b+1]=e[h];g[b+2]=e[k]}return d},
scatter:function(c,d,a){var b,e,f,g=d.width,h=d.height,k=d.data;3>arguments.length&&(a=5);if(0>=a)return d;var m=2*a;var q=(a-1)*a;for(e=a;e<h-a;e+=m)for(b=a;b<g-a;b+=m){var n=!1;for(f=0;!n;){var p=Math.floor(Math.random()*m-a);var r=Math.floor(Math.random()*m-a);var l=Math.floor(Math.random()*m-a);var t=Math.floor(Math.random()*m-a);var u=[];p=4*(g*(r+e)+(p+b));l=4*(g*(t+e)+(l+b));u[0]=k[p];u[1]=k[p+1];u[2]=k[p+2];u[3]=k[p+3];k[p]=k[l];k[p+1]=k[l+1];k[p+2]=k[l+2];k[p+3]=k[l+3];k[l]=u[0];k[l+1]=u[1];
k[l+2]=u[2];k[l+3]=u[3];++f;f>q&&(n=!0)}}return d},solarize:function(c,d,a){var b,e=d.data;3>arguments.length&&(a=50);for(b=0;b<e.length;++b){var f=e[b];var g=e[b+1];var h=e[b+2];var k=(f+g+h)/3;k<a&&(e[b]=255-f,e[b+1]=255-g,e[b+2]=255-h)}return d},sharpen:function(c,d,a){3>arguments.length&&(a=20);return v(c,d,[0,-1,0,-1,a,-1,0,-1,0],!0,!0)},edgeDetect:function(c,d){return v(c,d,[-1,-1,-1,-1,8,-1,-1,-1,-1])},blur:function(c,d,a){c=d.width;var b=c<<2,e=d.height;d=d.data;var f,g,h,k,m;void 0===a&&
(a=30);a/=10;0>a&&(a=0);a=2.5<=a?.98711*a-.9633:.5<=a?3.97156-4.14554*Math.sqrt(1-.26891*a):2*a*(3.97156-4.14554*Math.sqrt(.865545));var q=a*a;var n=q*a;var p=1.57825+2.44413*a+1.4281*q+.422205*n;a=(2.44413*a+2.85619*q+1.26661*n)/p;q=-(1.4281*q+1.26661*n)/p;n=.422205*n/p;p=1-(a+q+n);for(m=0;3>m;m++)for(var r=0;r<e;r++){var l=r*b+m;var t=r*b+(c-1<<2)+m;for(k=h=g=f=d[l];l<=t;l+=4)f=p*d[l]+a*g+q*h+n*k,d[l]=f,k=h,h=g,g=f;l=r*b+(c-1<<2)+m;t=r*b+m;for(k=h=g=f=d[l];l>=t;l-=4)f=p*d[l]+a*g+q*h+n*k,d[l]=f,
k=h,h=g,g=f}for(m=0;3>m;m++)for(r=0;r<c;r++){l=(r<<2)+m;t=(e-1)*b+(r<<2)+m;for(k=h=g=f=d[l];l<=t;l+=b)f=p*d[l]+a*g+q*h+n*k,d[l]=f,k=h,h=g,g=f;l=(e-1)*b+(r<<2)+m;t=(r<<2)+m;for(k=h=g=f=d[l];l>=t;l-=b)f=p*d[l]+a*g+q*h+n*k,d[l]=f,k=h,h=g,g=f}},emboss:function(c,d,a){3>arguments.length&&(a=95);return v(c,d,[-18,-9,9,-9,100-a,9,0,9,18],!0,!0)},lighten:function(c,d,a){if(3>arguments.length||0>a)a=12/9;return v(c,d,[0,0,0,0,a,0,0,0,0])},darken:function(c,d,a){if(3>arguments.length||1<a)a=6/9;return v(c,
d,[0,0,0,0,a,0,0,0,0])}}}();
