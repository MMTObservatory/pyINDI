(function(k){var m,v,w,n=Object.prototype.hasOwnProperty;k.plot.plugins.push({init:function(p,c){c=c.Canvas;null==m&&(v=c.prototype.getTextInfo,w=c.prototype.addText,m=c.prototype.render);c.prototype.render=function(){if(!p.getOptions().canvas)return m.call(this);var h=this.context,e=this._textCache;h.save();h.textBaseline="middle";for(var b in e)if(n.call(e,b)){var d=e[b],a;for(a in d)if(n.call(d,a)){var g=d[a],l=!0,c;for(c in g)if(n.call(g,c)){var f=g[c],q=f.positions,k=f.lines;l&&(h.fillStyle=
f.font.color,h.font=f.font.definition,l=!1);f=0;for(var r;r=q[f];f++)if(r.active)for(var t=0,u;u=r.lines[t];t++)h.fillText(k[t].text,u[0],u[1]);else q.splice(f--,1);0==q.length&&delete g[c]}}}h.restore()};c.prototype.getTextInfo=function(h,e,b,d,a){if(!p.getOptions().canvas)return v.call(this,h,e,b,d,a);e=""+e;var g="object"===typeof b?b.style+" "+b.variant+" "+b.weight+" "+b.size+"px "+b.family:b;d=this._textCache[h];null==d&&(d=this._textCache[h]={});var c=d[g];null==c&&(c=d[g]={});a=c[e];if(null==
a){d=this.context;"object"!==typeof b&&(a=k("<div>&nbsp;</div>").css("position","absolute").addClass("string"===typeof b?b:null).appendTo(this.getTextLayer(h)),b={lineHeight:a.height(),style:a.css("font-style"),variant:a.css("font-variant"),weight:a.css("font-weight"),family:a.css("font-family"),color:a.css("color")},b.size=a.css("line-height",1).height(),a.remove());g=b.style+" "+b.variant+" "+b.weight+" "+b.size+"px "+b.family;a=c[e]={width:0,height:0,positions:[],lines:[],font:{definition:g,color:b.color}};
d.save();d.font=g;e=(e+"").replace(/<br ?\/?>|\r\n|\r/g,"\n").split("\n");for(h=0;h<e.length;++h)c=e[h],g=d.measureText(c),a.width=Math.max(g.width,a.width),a.height+=b.lineHeight,a.lines.push({text:c,width:g.width,height:b.lineHeight});d.restore()}return a};c.prototype.addText=function(c,e,b,d,a,g,l,k,f){if(!p.getOptions().canvas)return w.call(this,c,e,b,d,a,g,l,k,f);a=this.getTextInfo(c,d,a,g,l);d=a.positions;c=a.lines;b+=a.height/c.length/2;b="middle"==f?Math.round(b-a.height/2):"bottom"==f?Math.round(b-
a.height):Math.round(b);window.opera&&12>window.opera.version().split(".")[0]&&(b-=2);for(f=0;a=d[f];f++)if(a.x==e&&a.y==b){a.active=!0;return}a={active:!0,lines:[],x:e,y:b};d.push(a);for(f=0;d=c[f];f++)"center"==k?a.lines.push([Math.round(e-d.width/2),b]):"right"==k?a.lines.push([Math.round(e-d.width),b]):a.lines.push([Math.round(e),b]),b+=d.height}},options:{canvas:!0},name:"canvas",version:"1.0"})})(jQuery);
