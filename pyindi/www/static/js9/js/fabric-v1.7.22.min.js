/*
 Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,b,c){e!=Array.prototype&&e!=Object.prototype&&(e[b]=c.value)};$jscomp.getGlobal=function(e){return"undefined"!=typeof window&&window===e?e:"undefined"!=typeof global&&null!=global?global:e};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(e,b,c,d){if(b){c=$jscomp.global;e=e.split(".");for(d=0;d<e.length-1;d++){var a=e[d];a in c||(c[a]={});c=c[a]}e=e[e.length-1];d=c[e];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,e,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.fill",function(e){return e?e:function(b,c,d){var a=this.length||0;0>c&&(c=Math.max(0,a+c));if(null==d||d>a)d=a;d=Number(d);0>d&&(d=Math.max(0,a+d));for(c=Number(c||0);c<d;c++)this[c]=b;return this}},"es6","es3");
$jscomp.checkStringArgs=function(e,b,c){if(null==e)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return e+""};
$jscomp.polyfill("String.prototype.repeat",function(e){return e?e:function(b){var c=$jscomp.checkStringArgs(this,null,"repeat");if(0>b||1342177279<b)throw new RangeError("Invalid count value");b|=0;for(var d="";b;)if(b&1&&(d+=c),b>>>=1)c+=c;return d}},"es6","es3");$jscomp.arrayIteratorImpl=function(e){var b=0;return function(){return b<e.length?{done:!1,value:e[b++]}:{done:!0}}};$jscomp.arrayIterator=function(e){return{next:$jscomp.arrayIteratorImpl(e)}};$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(e,b){this.$jscomp$symbol$id_=e;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:b})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function e(c){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(c||"")+"_"+b++,c)}var b=0;return e}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var e=$jscomp.global.Symbol.iterator;e||(e=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[e]&&$jscomp.defineProperty(Array.prototype,e,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var e=$jscomp.global.Symbol.asyncIterator;e||(e=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(e){$jscomp.initSymbolIterator();e={next:e};e[$jscomp.global.Symbol.iterator]=function(){return this};return e};
$jscomp.iteratorFromArray=function(e,b){$jscomp.initSymbolIterator();e instanceof String&&(e+="");var c=0,d={next:function(){if(c<e.length){var a=c++;return{value:b(a,e[a]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};$jscomp.polyfill("Array.prototype.keys",function(e){return e?e:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6","es3");var fabric=fabric||{version:"1.7.22"};
"undefined"!==typeof exports&&(exports.fabric=fabric);"undefined"!==typeof document&&"undefined"!==typeof window?(fabric.document=document,fabric.window=window,window.fabric=fabric):(fabric.document=require("jsdom").jsdom(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E")),fabric.window=fabric.document.createWindow?fabric.document.createWindow():fabric.document.parentWindow);fabric.isTouchSupported="ontouchstart"in fabric.window;
fabric.isLikelyNode="undefined"!==typeof Buffer&&"undefined"===typeof window;fabric.SHARED_ATTRIBUTES="display transform fill fill-opacity fill-rule opacity stroke stroke-dasharray stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width id".split(" ");fabric.DPI=96;fabric.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)";fabric.fontPaths={};fabric.iMatrix=[1,0,0,1,0,0];fabric.canvasModule="canvas";fabric.perfLimitSizeTotal=2097152;fabric.maxCacheSideLimit=4096;
fabric.minCacheSideLimit=256;fabric.charWidthsCache={};fabric.devicePixelRatio=fabric.window.devicePixelRatio||fabric.window.webkitDevicePixelRatio||fabric.window.mozDevicePixelRatio||1;
(function(){function e(a,b){this.__eventListeners[a]&&(a=this.__eventListeners[a],b?a[a.indexOf(b)]=!1:fabric.util.array.fill(a,!1))}function b(a,b){this.__eventListeners||(this.__eventListeners={});if(1===arguments.length)for(var c in a)this.on(c,a[c]);else this.__eventListeners[a]||(this.__eventListeners[a]=[]),this.__eventListeners[a].push(b);return this}function c(a,b){if(this.__eventListeners){if(0===arguments.length)for(a in this.__eventListeners)e.call(this,a);else if(1===arguments.length&&
"object"===typeof arguments[0])for(var c in a)e.call(this,c,a[c]);else e.call(this,a,b);return this}}function d(a,b){if(this.__eventListeners){var c=this.__eventListeners[a];if(c){for(var f=0,d=c.length;f<d;f++)c[f]&&c[f].call(this,b||{});this.__eventListeners[a]=c.filter(function(a){return!1!==a});return this}}}fabric.Observable={observe:b,stopObserving:c,fire:d,on:b,off:c,trigger:d}})();
fabric.Collection={_objects:[],add:function(){this._objects.push.apply(this._objects,arguments);if(this._onObjectAdded)for(var e=0,b=arguments.length;e<b;e++)this._onObjectAdded(arguments[e]);this.renderOnAddRemove&&this.renderAll();return this},insertAt:function(e,b,c){var d=this.getObjects();c?d[b]=e:d.splice(b,0,e);this._onObjectAdded&&this._onObjectAdded(e);this.renderOnAddRemove&&this.renderAll();return this},remove:function(){for(var e=this.getObjects(),b,c=!1,d=0,a=arguments.length;d<a;d++)b=
e.indexOf(arguments[d]),-1!==b&&(c=!0,e.splice(b,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[d]));this.renderOnAddRemove&&c&&this.renderAll();return this},forEachObject:function(e,b){for(var c=this.getObjects(),d=0,a=c.length;d<a;d++)e.call(b,c[d],d,c);return this},getObjects:function(e){return"undefined"===typeof e?this._objects:this._objects.filter(function(b){return b.type===e})},item:function(e){return this.getObjects()[e]},isEmpty:function(){return 0===this.getObjects().length},
size:function(){return this.getObjects().length},contains:function(e){return-1<this.getObjects().indexOf(e)},complexity:function(){return this.getObjects().reduce(function(e,b){return e+=b.complexity?b.complexity():0},0)}};
fabric.CommonMethods={_setOptions:function(e){for(var b in e)this.set(b,e[b])},_initGradient:function(e,b){!e||!e.colorStops||e instanceof fabric.Gradient||this.set(b,new fabric.Gradient(e))},_initPattern:function(e,b,c){!e||!e.source||e instanceof fabric.Pattern?c&&c():this.set(b,new fabric.Pattern(e,c))},_initClipping:function(e){e.clipTo&&"string"===typeof e.clipTo&&(e=fabric.util.getFunctionBody(e.clipTo),"undefined"!==typeof e&&(this.clipTo=new Function("ctx",e)))},_setObject:function(e){for(var b in e)this._set(b,
e[b])},set:function(e,b){"object"===typeof e?this._setObject(e):"function"===typeof b&&"clipTo"!==e?this._set(e,b(this.get(e))):this._set(e,b);return this},_set:function(e,b){this[e]=b},toggle:function(e){var b=this.get(e);"boolean"===typeof b&&this.set(e,!b);return this},get:function(e){return this[e]}};
(function(e){var b=Math.sqrt,c=Math.atan2,d=Math.pow,a=Math.abs,g=Math.PI/180;fabric.util={removeFromArray:function(a,f){f=a.indexOf(f);-1!==f&&a.splice(f,1);return a},getRandomInt:function(a,f){return Math.floor(Math.random()*(f-a+1))+a},degreesToRadians:function(a){return a*g},radiansToDegrees:function(a){return a/g},rotatePoint:function(a,f,b){a.subtractEquals(f);a=fabric.util.rotateVector(a,b);return(new fabric.Point(a.x,a.y)).addEquals(f)},rotateVector:function(a,f){var b=Math.sin(f);f=Math.cos(f);
return{x:a.x*f-a.y*b,y:a.x*b+a.y*f}},transformPoint:function(a,f,b){return b?new fabric.Point(f[0]*a.x+f[2]*a.y,f[1]*a.x+f[3]*a.y):new fabric.Point(f[0]*a.x+f[2]*a.y+f[4],f[1]*a.x+f[3]*a.y+f[5])},makeBoundingBoxFromPoints:function(a){var f=[a[0].x,a[1].x,a[2].x,a[3].x],b=fabric.util.array.min(f);f=fabric.util.array.max(f);f=Math.abs(b-f);var c=[a[0].y,a[1].y,a[2].y,a[3].y];a=fabric.util.array.min(c);c=fabric.util.array.max(c);return{left:b,top:a,width:f,height:Math.abs(a-c)}},invertTransform:function(a){var f=
1/(a[0]*a[3]-a[1]*a[2]);f=[f*a[3],-f*a[1],-f*a[2],f*a[0]];a=fabric.util.transformPoint({x:a[4],y:a[5]},f,!0);f[4]=-a.x;f[5]=-a.y;return f},toFixed:function(a,f){return parseFloat(Number(a).toFixed(f))},parseUnit:function(a,f){var b=/\D{0,2}$/.exec(a);a=parseFloat(a);f||(f=fabric.Text.DEFAULT_SVG_FONT_SIZE);switch(b[0]){case "mm":return a*fabric.DPI/25.4;case "cm":return a*fabric.DPI/2.54;case "in":return a*fabric.DPI;case "pt":return a*fabric.DPI/72;case "pc":return a*fabric.DPI/72*12;case "em":return a*
f;default:return a}},falseFunction:function(){return!1},getKlass:function(a,f){a=fabric.util.string.camelize(a.charAt(0).toUpperCase()+a.slice(1));return fabric.util.resolveNamespace(f)[a]},resolveNamespace:function(a){if(!a)return fabric;a=a.split(".");var f=a.length,b,c=e||fabric.window;for(b=0;b<f;++b)c=c[a[b]];return c},loadImage:function(a,f,b,c){if(a){var d=fabric.util.createImage();d.onload=function(){f&&f.call(b,d);d=d.onload=d.onerror=null};d.onerror=function(){fabric.log("Error loading "+
d.src);f&&f.call(b,null,!0);d=d.onload=d.onerror=null};0!==a.indexOf("data")&&c&&(d.crossOrigin=c);d.src=a}else f&&f.call(b,a)},enlivenObjects:function(a,f,b,c){a=a||[];var d=[],l=0,g=a.length;g?a.forEach(function(a,h){a&&a.type?fabric.util.getKlass(a.type,b).fromObject(a,function(b,k){k||(d[h]=b);c&&c(a,b,k);++l===g&&f&&f(d)},!0):++l===g&&f&&f(d)}):f&&f(d)},enlivenPatterns:function(a,f){a=a||[];var b=[],c=0,d=a.length;d?a.forEach(function(a,l){a&&a.source?new fabric.Pattern(a,function(a){b[l]=a;
++c===d&&f&&f(b)}):(b[l]=a,++c===d&&f&&f(b))}):f&&f(b)},groupSVGElements:function(a,f,b){a=new fabric.PathGroup(a,f);"undefined"!==typeof b&&(a.sourcePath=b);return a},populateWithProperties:function(a,f,b){if(b&&"[object Array]"===Object.prototype.toString.call(b))for(var c=0,d=b.length;c<d;c++)b[c]in a&&(f[b[c]]=a[b[c]])},drawDashedLine:function(a,f,d,g,e,n){g-=f;var l=e-d;e=b(g*g+l*l);g=c(l,g);l=n.length;var h=0,k=!0;a.save();a.translate(f,d);a.moveTo(0,0);a.rotate(g);for(f=0;e>f;)f+=n[h++%l],
f>e&&(f=e),a[k?"lineTo":"moveTo"](f,0),k=!k;a.restore()},createCanvasElement:function(a){a||(a=fabric.document.createElement("canvas"));a.getContext||"undefined"===typeof G_vmlCanvasManager||G_vmlCanvasManager.initElement(a);return a},createImage:function(){return fabric.isLikelyNode?new (require("canvas").Image):fabric.document.createElement("img")},createAccessors:function(a){a=a.prototype;var f;for(f=a.stateProperties.length;f--;){var b=a.stateProperties[f];var c=b.charAt(0).toUpperCase()+b.slice(1);
var d="set"+c;c="get"+c;a[c]||(a[c]=new Function('return this.get("'+b+'")'));a[d]||(a[d]=new Function("value",'return this.set("'+b+'", value)'))}},clipContext:function(a,f){f.save();f.beginPath();a.clipTo(f);f.clip()},multiplyTransformMatrices:function(a,f,b){return[a[0]*f[0]+a[2]*f[1],a[1]*f[0]+a[3]*f[1],a[0]*f[2]+a[2]*f[3],a[1]*f[2]+a[3]*f[3],b?0:a[0]*f[4]+a[2]*f[5]+a[4],b?0:a[1]*f[4]+a[3]*f[5]+a[5]]},qrDecompose:function(a){var f=c(a[1],a[0]),l=d(a[0],2)+d(a[1],2),h=b(l),e=(a[0]*a[3]-a[2]*a[1])/
h;l=c(a[0]*a[2]+a[1]*a[3],l);return{angle:f/g,scaleX:h,scaleY:e,skewX:l/g,skewY:0,translateX:a[4],translateY:a[5]}},customTransformMatrix:function(b,f,c){c=[1,0,a(Math.tan(c*g)),1];b=[a(b),0,0,a(f)];return fabric.util.multiplyTransformMatrices(b,c,!0)},resetObjectTransform:function(a){a.scaleX=1;a.scaleY=1;a.skewX=0;a.skewY=0;a.flipX=!1;a.flipY=!1;a.setAngle(0)},getFunctionBody:function(a){return(String(a).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(a,f,b,c){0<c&&(f=f>c?f-
c:0,b=b>c?b-c:0);var d=!0;f=a.getImageData(f,b,2*c||1,2*c||1);b=f.data.length;for(a=3;a<b&&(d=f.data[a],d=0>=d,!1!==d);a+=4);return d},parsePreserveAspectRatioAttribute:function(a){var f="meet";if((a=a.split(" "))&&a.length)if(f=a.pop(),"meet"!==f&&"slice"!==f){var b=f;f="meet"}else a.length&&(b=a.pop());a="none"!==b?b.slice(1,4):"none";b="none"!==b?b.slice(5,8):"none";return{meetOrSlice:f,alignX:a,alignY:b}},clearFabricFontCache:function(a){a?fabric.charWidthsCache[a]&&delete fabric.charWidthsCache[a]:
fabric.charWidthsCache={}},limitDimsByArea:function(a,f){a=Math.sqrt(f*a);return{x:Math.floor(a),y:Math.floor(f/a)}},capValue:function(a,f,b){return Math.max(a,Math.min(f,b))}}})("undefined"!==typeof exports?exports:this);
(function(){function e(d,g,h,e,p,q,t){var l=f.call(arguments);if(a[l])return a[l];var k=Math.PI,m=t*k/180,n=Math.sin(m);m=Math.cos(m);var A=0,D=0;h=Math.abs(h);e=Math.abs(e);var u=-m*d*.5-n*g*.5,y=-m*g*.5+n*d*.5,x=h*h,B=e*e,E=y*y,F=u*u,C=x*B-x*E-B*F,G=0;0>C?(x=Math.sqrt(1-C/(x*B)),h*=x,e*=x):G=(p===q?-1:1)*Math.sqrt(C/(x*E+B*F));E=G*h*y/e;F=-G*e*u/h;G=m*E-n*F+.5*d;x=n*E+m*F+.5*g;B=c(1,0,(u-E)/h,(y-F)/e);y=c((u-E)/h,(y-F)/e,(-u-E)/h,(-y-F)/e);0===q&&0<y?y-=2*k:1===q&&0>y&&(y+=2*k);k=Math.ceil(Math.abs(y/
k*2));u=[];y/=k;E=8/3*Math.sin(y/4)*Math.sin(y/4)/Math.sin(y/2);F=B+y;for(C=0;C<k;C++)u[C]=b(B,F,m,n,h,e,G,x,E,A,D),A=u[C][4],D=u[C][5],B=F,F+=y;return a[l]=u}function b(a,b,c,d,h,e,t,r,w,z,v){var l=f.call(arguments);if(g[l])return g[l];var k=Math.cos(a),m=Math.sin(a),n=Math.cos(b),p=Math.sin(b),q=c*h*n-d*e*p+t,E=d*h*n+c*e*p+r;g[l]=[z+w*(-c*h*m-d*e*k),v+w*(-d*h*m+c*e*k),q+w*(c*h*p+d*e*n),E+w*(d*h*p-c*e*n),q,E];return g[l]}function c(a,f,b,c){a=Math.atan2(f,a);b=Math.atan2(c,b);return b>=a?b-a:2*Math.PI-
(a-b)}function d(a,b,c,d,g,e,t,r){var l=f.call(arguments);if(h[l])return h[l];var k=Math.sqrt,m=Math.min,n=Math.max,p=Math.abs,q=[],y=[[],[]];var x=6*a-12*c+6*g;var B=-3*a+9*c-9*g+3*t;var E=3*c-3*a;for(var F=0;2>F;++F)if(0<F&&(x=6*b-12*d+6*e,B=-3*b+9*d-9*e+3*r,E=3*d-3*b),1E-12>p(B)){if(!(1E-12>p(x))){var C=-E/x;0<C&&1>C&&q.push(C)}}else if(C=x*x-4*E*B,!(0>C)){var G=k(C);C=(-x+G)/(2*B);0<C&&1>C&&q.push(C);C=(-x-G)/(2*B);0<C&&1>C&&q.push(C)}for(p=k=q.length;k--;)C=q[k],x=1-C,B=x*x*x*a+3*x*x*C*c+3*x*
C*C*g+C*C*C*t,y[0][k]=B,B=x*x*x*b+3*x*x*C*d+3*x*C*C*e+C*C*C*r,y[1][k]=B;y[0][p]=a;y[1][p]=b;y[0][p+1]=t;y[1][p+1]=r;m=[{x:m.apply(null,y[0]),y:m.apply(null,y[1])},{x:n.apply(null,y[0]),y:n.apply(null,y[1])}];return h[l]=m}var a={},g={},h={},f=Array.prototype.join;fabric.util.drawArc=function(a,f,b,c){var d=[[],[],[],[]];c=e(c[5]-f,c[6]-b,c[0],c[1],c[3],c[4],c[2]);for(var g=0,l=c.length;g<l;g++)d[g][0]=c[g][0]+f,d[g][1]=c[g][1]+b,d[g][2]=c[g][2]+f,d[g][3]=c[g][3]+b,d[g][4]=c[g][4]+f,d[g][5]=c[g][5]+
b,a.bezierCurveTo.apply(a,d[g])};fabric.util.getBoundsOfArc=function(a,f,b,c,g,h,t,r,w){var l=0,k=0,m=[];b=e(r-a,w-f,b,c,h,t,g);c=0;for(g=b.length;c<g;c++)l=d(l,k,b[c][0],b[c][1],b[c][2],b[c][3],b[c][4],b[c][5]),m.push({x:l[0].x+a,y:l[0].y+f}),m.push({x:l[1].x+a,y:l[1].y+f}),l=b[c][4],k=b[c][5];return m};fabric.util.getBoundsOfCurve=d})();
(function(){function e(b,d,a){if(b&&0!==b.length){var c=b.length-1,h=d?b[c][d]:b[c];if(d)for(;c--;)a(b[c][d],h)&&(h=b[c][d]);else for(;c--;)a(b[c],h)&&(h=b[c]);return h}}var b=Array.prototype.slice;Array.prototype.indexOf||(Array.prototype.indexOf=function(b){if(void 0===this||null===this)throw new TypeError;var c=Object(this),a=c.length>>>0;if(0===a)return-1;var g=0;0<arguments.length&&(g=Number(arguments[1]),g!==g?g=0:0!==g&&g!==Number.POSITIVE_INFINITY&&g!==Number.NEGATIVE_INFINITY&&(g=(0<g||-1)*
Math.floor(Math.abs(g))));if(g>=a)return-1;for(g=0<=g?g:Math.max(a-Math.abs(g),0);g<a;g++)if(g in c&&c[g]===b)return g;return-1});Array.prototype.forEach||(Array.prototype.forEach=function(b,d){for(var a=0,c=this.length>>>0;a<c;a++)a in this&&b.call(d,this[a],a,this)});Array.prototype.map||(Array.prototype.map=function(b,d){for(var a=[],c=0,h=this.length>>>0;c<h;c++)c in this&&(a[c]=b.call(d,this[c],c,this));return a});Array.prototype.every||(Array.prototype.every=function(b,d){for(var a=0,c=this.length>>>
0;a<c;a++)if(a in this&&!b.call(d,this[a],a,this))return!1;return!0});Array.prototype.some||(Array.prototype.some=function(b,d){for(var a=0,c=this.length>>>0;a<c;a++)if(a in this&&b.call(d,this[a],a,this))return!0;return!1});Array.prototype.filter||(Array.prototype.filter=function(b,d){for(var a=[],c,h=0,f=this.length>>>0;h<f;h++)h in this&&(c=this[h],b.call(d,c,h,this)&&a.push(c));return a});Array.prototype.reduce||(Array.prototype.reduce=function(b){var c=this.length>>>0,a=0;if(1<arguments.length)var g=
arguments[1];else{do{if(a in this){g=this[a++];break}if(++a>=c)throw new TypeError;}while(1)}for(;a<c;a++)a in this&&(g=b.call(null,g,this[a],a,this));return g});fabric.util.array={fill:function(b,d){for(var a=b.length;a--;)b[a]=d;return b},invoke:function(c,d){for(var a=b.call(arguments,2),g=[],h=0,f=c.length;h<f;h++)g[h]=a.length?c[h][d].apply(c[h],a):c[h][d].call(c[h]);return g},min:function(b,d){return e(b,d,function(a,b){return a<b})},max:function(b,d){return e(b,d,function(a,b){return a>=b})}}})();
(function(){function e(b,c,d){if(d)if(!fabric.isLikelyNode&&c instanceof Element)b=c;else if(c instanceof Array){b=[];for(var a=0,g=c.length;a<g;a++)b[a]=e({},c[a],d)}else if(c&&"object"===typeof c)for(a in c)c.hasOwnProperty(a)&&(b[a]=e({},c[a],d));else b=c;else for(a in c)b[a]=c[a];return b}fabric.util.object={extend:e,clone:function(b,c){return e({},b,c)}}})();
(function(){String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")});fabric.util.string={camelize:function(e){return e.replace(/-+(.)?/g,function(b,c){return c?c.toUpperCase():""})},capitalize:function(e,b){return e.charAt(0).toUpperCase()+(b?e.slice(1):e.slice(1).toLowerCase())},escapeXml:function(e){return e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}}})();
(function(){var e=Array.prototype.slice,b=Function.prototype.apply,c=function(){};Function.prototype.bind||(Function.prototype.bind=function(d){var a=this,g=e.call(arguments,1);var h=g.length?function(){return b.call(a,this instanceof c?this:d,g.concat(e.call(arguments)))}:function(){return b.call(a,this instanceof c?this:d,arguments)};c.prototype=this.prototype;h.prototype=new c;return h})})();
(function(){function e(){}function b(a){for(var f=null,b=this;b.constructor.superclass;){var d=b.constructor.superclass.prototype[a];if(b[a]!==d){f=d;break}b=b.constructor.superclass.prototype}return f?1<arguments.length?f.apply(this,c.call(arguments,1)):f.call(this):console.log("tried to callSuper "+a+", method not found in prototype chain",this)}var c=Array.prototype.slice,d=function(){},a=function(){for(var a in{toString:1})if("toString"===a)return!1;return!0}(),g=function(b,f,c){for(var d in f)d in
b.prototype&&"function"===typeof b.prototype[d]&&-1<(f[d]+"").indexOf("callSuper")?b.prototype[d]=function(a){return function(){var b=this.constructor.superclass;this.constructor.superclass=c;var d=f[a].apply(this,arguments);this.constructor.superclass=b;if("initialize"!==a)return d}}(d):b.prototype[d]=f[d],a&&(f.toString!==Object.prototype.toString&&(b.prototype.toString=f.toString),f.valueOf!==Object.prototype.valueOf&&(b.prototype.valueOf=f.valueOf))};fabric.util.createClass=function(){function a(){this.initialize.apply(this,
arguments)}var f=null,l=c.call(arguments,0);"function"===typeof l[0]&&(f=l.shift());a.superclass=f;a.subclasses=[];f&&(e.prototype=f.prototype,a.prototype=new e,f.subclasses.push(a));for(var k=0,m=l.length;k<m;k++)g(a,l[k],f);a.prototype.initialize||(a.prototype.initialize=d);a.prototype.constructor=a;a.prototype.callSuper=b;return a}})();
(function(){function e(a){var f=Array.prototype.slice.call(arguments,1),b,c=f.length;for(b=0;b<c;b++){var d=typeof a[f[b]];if(!/^(?:function|object|unknown)$/.test(d))return!1}return!0}function b(f,b){return function(c){b.call(a(f),c||fabric.window.event)}}function c(a,f){return function(b){if(m[a]&&m[a][f])for(var c=m[a][f],d=0,g=c.length;d<g;d++)c[d].call(this,b||fabric.window.event)}}function d(a,f,b){var c="touchend"===a.type?"changedTouches":"touches";return a[c]&&a[c][0]?a[c][0][f]-(a[c][0][f]-
a[c][0][b])||a[b]:a[b]}var a,g,h=function(){var a=0;return function(f){return f.__uniqueID||(f.__uniqueID="uniqueID__"+a++)}}();(function(){var f={};a=function(a){return f[a]};g=function(a,b){f[a]=b}})();var f=e(fabric.document.documentElement,"addEventListener","removeEventListener")&&e(fabric.window,"addEventListener","removeEventListener"),l=e(fabric.document.documentElement,"attachEvent","detachEvent")&&e(fabric.window,"attachEvent","detachEvent"),k={},m={};if(f){f=function(a,f,b,c){a&&a.addEventListener(f,
b,l?!1:c)};var n=function(a,f,b,c){a&&a.removeEventListener(f,b,l?!1:c)}}else l?(f=function(a,f,c){if(a){var d=h(a);g(d,a);k[d]||(k[d]={});k[d][f]||(k[d][f]=[]);c={handler:c,wrappedHandler:b(d,c)};k[d][f].push(c);a.attachEvent("on"+f,c.wrappedHandler)}},n=function(a,f,b){if(a){var c=h(a),d;if(k[c]&&k[c][f])for(var g=0,l=k[c][f].length;g<l;g++)(d=k[c][f][g])&&d.handler===b&&(a.detachEvent("on"+f,d.wrappedHandler),k[c][f][g]=null)}}):(f=function(a,f,b){if(a){var d=h(a);m[d]||(m[d]={});if(!m[d][f]){m[d][f]=
[];var g=a["on"+f];g&&m[d][f].push(g);a["on"+f]=c(d,f)}m[d][f].push(b)}},n=function(a,f,b){if(a&&(a=h(a),m[a]&&m[a][f])){f=m[a][f];a=0;for(var c=f.length;a<c;a++)f[a]===b&&f.splice(a,1)}});fabric.util.addListener=f;fabric.util.removeListener=n;var p=function(a){return"unknown"!==typeof a.clientX?a.clientX:0},q=function(a){return"unknown"!==typeof a.clientY?a.clientY:0};fabric.isTouchSupported&&(p=function(a){return d(a,"pageX","clientX")},q=function(a){return d(a,"pageY","clientY")});fabric.util.getPointer=
function(a){a||(a=fabric.window.event);var f=fabric.util.getScrollLeftTop(a.target||("unknown"!==typeof a.srcElement?a.srcElement:null));return{x:p(a)+f.left,y:q(a)+f.top}};fabric.util.object.extend(fabric.util,fabric.Observable)})();
(function(){var e=fabric.document.createElement("div"),b="string"===typeof e.style.filter,c=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,d=function(a){return a};"string"===typeof e.style.opacity?d=function(a,b){a.style.opacity=b;return a}:b&&(d=function(a,b){var d=a.style;a.currentStyle&&!a.currentStyle.hasLayout&&(d.zoom=1);c.test(d.filter)?d.filter=d.filter.replace(c,.9999<=b?"":"alpha(opacity="+100*b+")"):d.filter+=" alpha(opacity="+100*b+")";return a});fabric.util.setStyle=function(a,b){var c=a.style;
if(!c)return a;if("string"===typeof b)return a.style.cssText+=";"+b,-1<b.indexOf("opacity")?d(a,b.match(/opacity:\s*(\d?\.?\d*)/)[1]):a;for(var f in b)"opacity"===f?d(a,b[f]):c["float"===f||"cssFloat"===f?"undefined"===typeof c.styleFloat?"cssFloat":"styleFloat":f]=b[f];return a}})();
(function(){function e(a,f){a=fabric.document.createElement(a);for(var b in f)"class"===b?a.className=f[b]:"for"===b?a.htmlFor=f[b]:a.setAttribute(b,f[b]);return a}function b(a){for(var f=0,b=0,c=fabric.document.documentElement,d=fabric.document.body||{scrollLeft:0,scrollTop:0};a&&(a.parentNode||a.host)&&(a=a.parentNode||a.host,a===fabric.document?(f=d.scrollLeft||c.scrollLeft||0,b=d.scrollTop||c.scrollTop||0):(f+=a.scrollLeft||0,b+=a.scrollTop||0),1!==a.nodeType||"fixed"!==fabric.util.getElementStyle(a,
"position")););return{left:f,top:b}}var c=Array.prototype.slice,d=function(a){return c.call(a,0)};try{var a=d(fabric.document.childNodes)instanceof Array}catch(h){}a||(d=function(a){for(var f=Array(a.length),b=a.length;b--;)f[b]=a[b];return f});var g=fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle?function(a,f){return(a=fabric.document.defaultView.getComputedStyle(a,null))?a[f]:void 0}:function(a,f){var b=a.style[f];!b&&a.currentStyle&&(b=a.currentStyle[f]);return b};(function(){var a=
fabric.document.documentElement.style,f="userSelect"in a?"userSelect":"MozUserSelect"in a?"MozUserSelect":"WebkitUserSelect"in a?"WebkitUserSelect":"KhtmlUserSelect"in a?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=function(a){"undefined"!==typeof a.onselectstart&&(a.onselectstart=fabric.util.falseFunction);f?a.style[f]="none":"string"===typeof a.unselectable&&(a.unselectable="on");return a};fabric.util.makeElementSelectable=function(a){"undefined"!==typeof a.onselectstart&&(a.onselectstart=
null);f?a.style[f]="":"string"===typeof a.unselectable&&(a.unselectable="");return a}})();(function(){fabric.util.getScript=function(a,f){var b=fabric.document.getElementsByTagName("head")[0],c=fabric.document.createElement("script"),d=!0;c.onload=c.onreadystatechange=function(a){!d||"string"===typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(d=!1,f(a||fabric.window.event),c=c.onload=c.onreadystatechange=null)};c.src=a;b.appendChild(c)}})();fabric.util.getById=function(a){return"string"===
typeof a?fabric.document.getElementById(a):a};fabric.util.toArray=d;fabric.util.makeElement=e;fabric.util.addClass=function(a,f){a&&-1===(" "+a.className+" ").indexOf(" "+f+" ")&&(a.className+=(a.className?" ":"")+f)};fabric.util.wrapElement=function(a,f,b){"string"===typeof f&&(f=e(f,b));a.parentNode&&a.parentNode.replaceChild(f,a);f.appendChild(a);return f};fabric.util.getScrollLeftTop=b;fabric.util.getElementOffset=function(a){var f=a&&a.ownerDocument;var c={left:0,top:0},d={left:0,top:0},h={borderLeftWidth:"left",
borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!f)return d;for(var e in h)d[h[e]]+=parseInt(g(a,e),10)||0;f=f.documentElement;"undefined"!==typeof a.getBoundingClientRect&&(c=a.getBoundingClientRect());a=b(a);return{left:c.left+a.left-(f.clientLeft||0)+d.left,top:c.top+a.top-(f.clientTop||0)+d.top}};fabric.util.getElementStyle=g})();
(function(){function e(b,a){return b+(/\?/.test(b)?"&":"?")+a}function b(){}var c=function(){for(var b=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],a=b.length;a--;)try{if(b[a]())return b[a]}catch(g){}}();fabric.util.request=function(d,a){a||(a={});var g=a.method?a.method.toUpperCase():"GET",h=a.onComplete||function(){},f=c(),l=a.body||
a.parameters;f.onreadystatechange=function(){4===f.readyState&&(h(f),f.onreadystatechange=b)};"GET"===g&&(l=null,"string"===typeof a.parameters&&(d=e(d,a.parameters)));f.open(g,d,!0);"POST"!==g&&"PUT"!==g||f.setRequestHeader("Content-Type","application/x-www-form-urlencoded");f.send(l);return f}})();fabric.log=function(){};fabric.warn=function(){};
"undefined"!==typeof console&&["log","warn"].forEach(function(e){"undefined"!==typeof console[e]&&"function"===typeof console[e].apply&&(fabric[e]=function(){return console[e].apply(console,arguments)})});
(function(){function e(){return!1}function b(){return c.apply(fabric.window,arguments)}var c=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(b){fabric.window.setTimeout(b,1E3/60)};fabric.util.animate=function(c){b(function(a){c||(c={});var d=a||+new Date,h=c.duration||500,f=d+h,l,k=c.onChange||e,m=c.abort||e,n=c.onComplete||e,p=c.easing||function(a,
f,b,c){return-b*Math.cos(a/c*(Math.PI/2))+b+f},q="startValue"in c?c.startValue:0,t="endValue"in c?c.endValue:100,r=c.byValue||t-q;c.onStart&&c.onStart();(function v(a){if(m())n(t,1,1);else{l=a||+new Date;var g=l>f?h:l-d;a=g/h;g=p(g,q,r,h);k(g,Math.abs((g-q)/r),a);l>f?c.onComplete&&c.onComplete():b(v)}})(d)})};fabric.util.requestAnimFrame=b})();
(function(){fabric.util.animateColor=function(e,b,c,d){e=(new fabric.Color(e)).getSource();b=(new fabric.Color(b)).getSource();d=d||{};fabric.util.animate(fabric.util.object.extend(d,{duration:c||500,startValue:e,endValue:b,byValue:b,easing:function(a,b,c,f){a=d.colorEasing?d.colorEasing(a,f):1-Math.cos(a/f*(Math.PI/2));f="rgba("+parseInt(b[0]+a*(c[0]-b[0]),10)+","+parseInt(b[1]+a*(c[1]-b[1]),10)+","+parseInt(b[2]+a*(c[2]-b[2]),10);f+=","+(b&&c?parseFloat(b[3]+a*(c[3]-b[3])):1);return f+")"}}))}})();
(function(){function e(a,b,c,f){a<Math.abs(b)?(a=b,f=c/4):f=0===b&&0===a?c/(2*Math.PI)*Math.asin(1):c/(2*Math.PI)*Math.asin(b/a);return{a:a,c:b,p:c,s:f}}function b(a,b,c){return a.a*Math.pow(2,10*--b)*Math.sin(2*(b*c-a.s)*Math.PI/a.p)}function c(a,b,c,f){return c-d(f-a,0,c,f)+b}function d(a,b,c,f){return(a/=f)<1/2.75?7.5625*c*a*a+b:a<2/2.75?c*(7.5625*(a-=1.5/2.75)*a+.75)+b:a<2.5/2.75?c*(7.5625*(a-=2.25/2.75)*a+.9375)+b:c*(7.5625*(a-=2.625/2.75)*a+.984375)+b}fabric.util.ease={easeInQuad:function(a,
b,c,f){return c*(a/=f)*a+b},easeOutQuad:function(a,b,c,f){return-c*(a/=f)*(a-2)+b},easeInOutQuad:function(a,b,c,f){a/=f/2;return 1>a?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b},easeInCubic:function(a,b,c,f){return c*(a/=f)*a*a+b},easeOutCubic:function(a,b,c,f){return c*((a=a/f-1)*a*a+1)+b},easeInOutCubic:function(a,b,c,f){a/=f/2;return 1>a?c/2*a*a*a+b:c/2*((a-=2)*a*a+2)+b},easeInQuart:function(a,b,c,f){return c*(a/=f)*a*a*a+b},easeOutQuart:function(a,b,c,f){return-c*((a=a/f-1)*a*a*a-1)+b},easeInOutQuart:function(a,
b,c,f){a/=f/2;return 1>a?c/2*a*a*a*a+b:-c/2*((a-=2)*a*a*a-2)+b},easeInQuint:function(a,b,c,f){return c*(a/=f)*a*a*a*a+b},easeOutQuint:function(a,b,c,f){return c*((a=a/f-1)*a*a*a*a+1)+b},easeInOutQuint:function(a,b,c,f){a/=f/2;return 1>a?c/2*a*a*a*a*a+b:c/2*((a-=2)*a*a*a*a+2)+b},easeInSine:function(a,b,c,f){return-c*Math.cos(a/f*(Math.PI/2))+c+b},easeOutSine:function(a,b,c,f){return c*Math.sin(a/f*(Math.PI/2))+b},easeInOutSine:function(a,b,c,f){return-c/2*(Math.cos(Math.PI*a/f)-1)+b},easeInExpo:function(a,
b,c,f){return 0===a?b:c*Math.pow(2,10*(a/f-1))+b},easeOutExpo:function(a,b,c,f){return a===f?b+c:c*(-Math.pow(2,-10*a/f)+1)+b},easeInOutExpo:function(a,b,c,f){if(0===a)return b;if(a===f)return b+c;a/=f/2;return 1>a?c/2*Math.pow(2,10*(a-1))+b:c/2*(-Math.pow(2,-10*--a)+2)+b},easeInCirc:function(a,b,c,f){return-c*(Math.sqrt(1-(a/=f)*a)-1)+b},easeOutCirc:function(a,b,c,f){return c*Math.sqrt(1-(a=a/f-1)*a)+b},easeInOutCirc:function(a,b,c,f){a/=f/2;return 1>a?-c/2*(Math.sqrt(1-a*a)-1)+b:c/2*(Math.sqrt(1-
(a-=2)*a)+1)+b},easeInElastic:function(a,c,d,f){var g=0;if(0===a)return c;a/=f;if(1===a)return c+d;g||(g=.3*f);d=e(d,d,g,1.70158);return-b(d,a,f)+c},easeOutElastic:function(a,b,c,f){var d=0;if(0===a)return b;a/=f;if(1===a)return b+c;d||(d=.3*f);c=e(c,c,d,1.70158);return c.a*Math.pow(2,-10*a)*Math.sin(2*(a*f-c.s)*Math.PI/c.p)+c.c+b},easeInOutElastic:function(a,c,d,f){var g=0;if(0===a)return c;a/=f/2;if(2===a)return c+d;g||(g=.3*f*1.5);d=e(d,d,g,1.70158);return 1>a?-.5*b(d,a,f)+c:d.a*Math.pow(2,-10*
--a)*Math.sin(2*(a*f-d.s)*Math.PI/d.p)*.5+d.c+c},easeInBack:function(a,b,c,f,d){void 0===d&&(d=1.70158);return c*(a/=f)*a*((d+1)*a-d)+b},easeOutBack:function(a,b,c,f,d){void 0===d&&(d=1.70158);return c*((a=a/f-1)*a*((d+1)*a+d)+1)+b},easeInOutBack:function(a,b,c,f,d){void 0===d&&(d=1.70158);a/=f/2;return 1>a?c/2*a*a*(((d*=1.525)+1)*a-d)+b:c/2*((a-=2)*a*(((d*=1.525)+1)*a+d)+2)+b},easeInBounce:c,easeOutBounce:d,easeInOutBounce:function(a,b,e,f){return a<f/2?.5*c(2*a,0,e,f)+b:.5*d(2*a-f,0,e,f)+.5*e+b}}})();
(function(e){function b(a,f,b,c){var d="[object Array]"===Object.prototype.toString.call(f),g;"fill"!==a&&"stroke"!==a||"none"!==f?"strokeDashArray"===a?f="none"===f?null:f.replace(/,/g," ").split(/\s+/).map(function(a){return parseFloat(a)}):"transformMatrix"===a?f=b&&b.transformMatrix?t(b.transformMatrix,k.parseTransformAttribute(f)):k.parseTransformAttribute(f):"visible"===a?(f="none"===f||"hidden"===f?!1:!0,b&&!1===b.visible&&(f=!1)):"opacity"===a?(f=parseFloat(f),b&&"undefined"!==typeof b.opacity&&
(f*=b.opacity)):"originX"===a?f="start"===f?"left":"end"===f?"right":"center":g=d?f.map(q):q(f,c):f="";return!d&&isNaN(g)?f:g}function c(a){for(var f in D)if("undefined"!==typeof a[D[f]]&&""!==a[f]){if("undefined"===typeof a[f]){if(!k.Object.prototype[f])continue;a[f]=k.Object.prototype[f]}if(0!==a[f].indexOf("url(")){var b=new k.Color(a[f]);a[f]=b.setAlpha(p(b.getAlpha()*a[D[f]],2)).toRgba()}}return a}function d(a,f){for(var b,c=[],d=0;d<f.length;d++)b=f[d],b=a.getElementsByTagName(b),c=c.concat(Array.prototype.slice.call(b));
return c}function a(a,f){var b,c;a.replace(/;\s*$/,"").split(";").forEach(function(a){a=a.split(":");b=a[0].trim().toLowerCase();c=a[1].trim();f[b]=c})}function g(a,f){var b={},c;for(c in k.cssRules[f]){var d,g=a,l=c.split(" "),e=!0;if((d=h(g,l.pop()))&&l.length){e=void 0;for(var m=l,n=!0;g.parentNode&&1===g.parentNode.nodeType&&m.length;)n&&(e=m.pop()),g=g.parentNode,n=h(g,e);e=0===m.length}if(d&&e&&0===l.length)for(var p in k.cssRules[f][c])b[p]=k.cssRules[f][c][p]}return b}function h(a,f){var b=
a.nodeName,c=a.getAttribute("class");a=a.getAttribute("id");b=new RegExp("^"+b,"i");f=f.replace(b,"");a&&f.length&&(b=new RegExp("#"+a+"(?![a-zA-Z\\-]+)","i"),f=f.replace(b,""));if(c&&f.length)for(c=c.split(" "),a=c.length;a--;)b=new RegExp("\\."+c[a]+"(?![a-zA-Z\\-]+)","i"),f=f.replace(b,"");return 0===f.length}function f(a){for(var f=d(a,["use","svg:use"]),b=0;f.length&&b<f.length;){var c=f[b],g=c.getAttribute("xlink:href").substr(1),e=c.getAttribute("x")||0,h=c.getAttribute("y")||0;a:{var k=void 0;
var m=a;m.getElementById&&(k=m.getElementById(g));if(k)g=k;else{var n=m.getElementsByTagName("*");for(k=0;k<n.length;k++)if(m=n[k],g===m.getAttribute("id")){g=m;break a}g=void 0}}g=g.cloneNode(!0);e=(g.getAttribute("transform")||"")+" translate("+e+", "+h+")";h=f.length;var p;l(g);if(/^svg$/i.test(g.nodeName)){var q=g.ownerDocument.createElement("g");m=0;n=g.attributes;for(p=n.length;m<p;m++)k=n.item(m),q.setAttribute(k.nodeName,k.nodeValue);for(;g.firstChild;)q.appendChild(g.firstChild);g=q}m=0;
n=c.attributes;for(p=n.length;m<p;m++)k=n.item(m),"x"!==k.nodeName&&"y"!==k.nodeName&&"xlink:href"!==k.nodeName&&("transform"===k.nodeName?e=k.nodeValue+" "+e:g.setAttribute(k.nodeName,k.nodeValue));g.setAttribute("transform",e);g.setAttribute("instantiated_by_use","1");g.removeAttribute("id");c.parentNode.replaceChild(g,c);f.length===h&&b++}}function l(a){var f=a.getAttribute("viewBox"),b=1,c=1,d=a.getAttribute("width"),g=a.getAttribute("height"),l=a.getAttribute("x")||0,e=a.getAttribute("y")||0,
h=a.getAttribute("preserveAspectRatio")||"";var m=!f||!w.test(a.nodeName)||!(f=f.match(u));var n=!d||!g||"100%"===d||"100%"===g;var p=m&&n;var t={},r="";t.width=0;t.height=0;if(t.toBeParsed=p)return t;if(m)return t.width=q(d),t.height=q(g),t;m=-parseFloat(f[1]);p=-parseFloat(f[2]);var x=parseFloat(f[3]);f=parseFloat(f[4]);n?(t.width=x,t.height=f):(t.width=q(d),t.height=q(g),b=t.width/x,c=t.height/f);h=k.util.parsePreserveAspectRatioAttribute(h);"none"!==h.alignX&&(c=b=b>c?c:b);if(1===b&&1===c&&0===
m&&0===p&&0===l&&0===e)return t;if(l||e)r=" translate("+q(l)+" "+q(e)+") ";b=r+" matrix("+b+" 0 0 "+c+" "+m*b+" "+p*c+") ";if("svg"===a.nodeName){for(c=a.ownerDocument.createElement("g");a.firstChild;)c.appendChild(a.firstChild);a.appendChild(c)}else c=a,b=c.getAttribute("transform")+b;c.setAttribute("transform",b);return t}var k=e.fabric||(e.fabric={}),m=k.util.object.extend,n=k.util.object.clone,p=k.util.toFixed,q=k.util.parseUnit,t=k.util.multiplyTransformMatrices,r=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/i,
w=/^(symbol|image|marker|pattern|view|svg)$/i,z=/^(?:pattern|defs|symbol|metadata|clipPath|mask)$/i,v=/^(symbol|g|a|svg)$/i,A={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit",
"stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"originX",opacity:"opacity"},D={stroke:"strokeOpacity",fill:"fillOpacity"};k.cssRules={};k.gradientDefs={};k.parseTransformAttribute=function(){function a(a,f){var b=Math.cos(f[0]),c=Math.sin(f[0]),d=0,g=0;3===f.length&&(d=f[1],g=f[2]);a[0]=b;a[1]=c;a[2]=-c;a[3]=b;a[4]=d-(b*d-c*g);a[5]=g-(c*d+b*g)}function f(a,f){var b=2===f.length?f[1]:f[0];a[0]=f[0];a[3]=b}function b(a,f){a[4]=f[0];2===
f.length&&(a[5]=f[1])}var c=[1,0,0,1,0,0],d=k.reNum,g="(?:(?:(matrix)\\s*\\(\\s*("+(d+")(?:\\s+,?\\s*|,\\s*)("+d+")(?:\\s+,?\\s*|,\\s*)("+d+")(?:\\s+,?\\s*|,\\s*)("+d+")(?:\\s+,?\\s*|,\\s*)("+d+")(?:\\s+,?\\s*|,\\s*)("+d+")\\s*\\))|(?:(translate)\\s*\\(\\s*(")+(d+")(?:(?:\\s+,?\\s*|,\\s*)("+d+"))?\\s*\\))|(?:(scale)\\s*\\(\\s*(")+(d+")(?:(?:\\s+,?\\s*|,\\s*)("+d+"))?\\s*\\))|(?:(rotate)\\s*\\(\\s*(")+(d+")(?:(?:\\s+,?\\s*|,\\s*)("+d+")(?:\\s+,?\\s*|,\\s*)("+d+"))?\\s*\\))|(?:(skewX)\\s*\\(\\s*(")+
(d+")\\s*\\))|(?:(skewY)\\s*\\(\\s*(")+(d+")\\s*\\)))"),l=new RegExp("^\\s*(?:(?:"+(g+"(?:(?:\\s+,?\\s*|,\\s*)*"+g+")*)?)\\s*$")),e=new RegExp(g,"g");return function(d){var h=c.concat(),m=[];if(!d||d&&!l.test(d))return h;d.replace(e,function(d){var l=(new RegExp(g)).exec(d).filter(function(a){return!!a});d=l[1];l=l.slice(2).map(parseFloat);switch(d){case "translate":b(h,l);break;case "rotate":l[0]=k.util.degreesToRadians(l[0]);a(h,l);break;case "scale":f(h,l);break;case "skewX":h[2]=Math.tan(k.util.degreesToRadians(l[0]));
break;case "skewY":h[1]=Math.tan(k.util.degreesToRadians(l[0]));break;case "matrix":h=l}m.push(h.concat());h=c.concat()});for(d=m[0];1<m.length;)m.shift(),d=k.util.multiplyTransformMatrices(d,m[0]);return d}}();var u=new RegExp("^\\s*("+k.reNum+"+)\\s*,?\\s*("+k.reNum+"+)\\s*,?\\s*("+k.reNum+"+)\\s*,?\\s*("+k.reNum+"+)\\s*$");k.parseSVGDocument=function(a,b,c,d){if(a){f(a);var g=k.Object.__uid++,e=l(a),h=k.util.toArray(a.getElementsByTagName("*"));e.crossOrigin=d&&d.crossOrigin;e.svgUid=g;if(0===
h.length&&k.isLikelyNode){h=a.selectNodes('//*[name(.)!="svg"]');for(var m=[],p=0,q=h.length;p<q;p++)m[p]=h[p];h=m}h=h.filter(function(a){l(a);var f;if(f=r.test(a.nodeName.replace("svg:",""))){a:{for(;a&&(a=a.parentNode);)if(a.nodeName&&z.test(a.nodeName.replace("svg:",""))&&!a.getAttribute("instantiated_by_use")){a=!0;break a}a=!1}f=!a}return f});!h||h&&!h.length?b&&b([],{}):(k.gradientDefs[g]=k.getGradientDefs(a),k.cssRules[g]=k.getCSSRules(a),k.parseElements(h,function(a){b&&b(a,e)},n(e),c,d))}};
var y=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+k.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+k.reNum+"))?\\s+(.*)");m(k,{parseFontDeclaration:function(a,f){var b=a.match(y);if(b){a=b[1];var c=b[3],d=b[4],g=b[5];b=b[6];a&&(f.fontStyle=a);c&&(f.fontWeight=isNaN(parseFloat(c))?c:parseFloat(c));d&&(f.fontSize=q(d));b&&(f.fontFamily=b);g&&(f.lineHeight="normal"===g?1:g)}},getGradientDefs:function(a){var f=d(a,["linearGradient",
"radialGradient","svg:linearGradient","svg:radialGradient"]),b,c={},g={};for(b=f.length;b--;){a=f[b];var l=a.getAttribute("xlink:href");var e=a.getAttribute("id");l&&(g[e]=l.substr(1));c[e]=a}for(e in g)for(f=c[g[e]].cloneNode(!0),a=c[e];f.firstChild;)a.appendChild(f.firstChild);return c},parseAttributes:function(a,f,d){if(a){var l,e={};"undefined"===typeof d&&(d=a.getAttribute("svgUid"));a.parentNode&&v.test(a.parentNode.nodeName)&&(e=k.parseAttributes(a.parentNode,f,d));var h=e&&e.fontSize||a.getAttribute("font-size")||
k.Text.DEFAULT_SVG_FONT_SIZE;f=f.reduce(function(f,b){(l=a.getAttribute(b))&&(f[b]=l);return f},{});f=m(f,m(g(a,d),k.parseStyleAttribute(a)));var n={},p;for(p in f){d=p in A?A[p]:p;var q=b(d,f[p],e,h);n[d]=q}n&&n.font&&k.parseFontDeclaration(n.font,n);e=m(e,n);return v.test(a.nodeName)?e:c(e)}},parseElements:function(a,f,b,c,d){(new k.ElementsParser(a,f,b,c,d)).parse()},parseStyleAttribute:function(f){var b={};f=f.getAttribute("style");if(!f)return b;if("string"===typeof f)a(f,b);else{var c;for(c in f)if("undefined"!==
typeof f[c]){var d=c.toLowerCase();var g=f[c];b[d]=g}}return b},parsePointsAttribute:function(a){if(!a)return null;a=a.replace(/,/g," ").trim();a=a.split(/\s+/);var f=[],b;var c=0;for(b=a.length;c<b;c+=2)f.push({x:parseFloat(a[c]),y:parseFloat(a[c+1])});return f},getCSSRules:function(a){a=a.getElementsByTagName("style");for(var f={},b,c=0,d=a.length;c<d;c++)b=a[c].textContent||a[c].text,b=b.replace(/\/\*[\s\S]*?\*\//g,""),""!==b.trim()&&(b=b.match(/[^{]*\{[\s\S]*?\}/g),b=b.map(function(a){return a.trim()}),
b.forEach(function(a){a=a.match(/([\s\S]*?)\s*\{([^}]*)\}/);for(var b={},c=a[2].trim().replace(/;$/,"").split(/\s*;\s*/),d=0,g=c.length;d<g;d++){var l=c[d].split(/\s*:\s*/);b[l[0]]=l[1]}a=a[1];a.split(",").forEach(function(a){a=a.replace(/^svg/i,"").trim();""!==a&&(f[a]?k.util.object.extend(f[a],b):f[a]=k.util.object.clone(b))})}));return f},loadSVGFromURL:function(a,f,b,c){a=a.replace(/^\n\s*/,"").trim();new k.util.request(a,{method:"get",onComplete:function(a){var d=a.responseXML;d&&!d.documentElement&&
k.window.ActiveXObject&&a.responseText&&(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(a.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));d&&d.documentElement||f&&f(null);k.parseSVGDocument(d.documentElement,function(a,b){f&&f(a,b)},b,c)}})},loadSVGFromString:function(a,f,b,c){a=a.trim();var d;if("undefined"!==typeof DOMParser){var g=new DOMParser;g&&g.parseFromString&&(d=g.parseFromString(a,"text/xml"))}else k.window.ActiveXObject&&(d=new ActiveXObject("Microsoft.XMLDOM"),
d.async="false",d.loadXML(a.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));k.parseSVGDocument(d.documentElement,function(a,b){f(a,b)},b,c)}})})("undefined"!==typeof exports?exports:this);fabric.ElementsParser=function(e,b,c,d,a){this.elements=e;this.callback=b;this.options=c;this.reviver=d;this.svgUid=c&&c.svgUid||0;this.parsingOptions=a};fabric.ElementsParser.prototype.parse=function(){this.instances=Array(this.elements.length);this.numElements=this.elements.length;this.createObjects()};
fabric.ElementsParser.prototype.createObjects=function(){for(var e=0,b=this.elements.length;e<b;e++)this.elements[e].setAttribute("svgUid",this.svgUid),function(b,d){setTimeout(function(){b.createObject(b.elements[d],d)},0)}(this,e)};fabric.ElementsParser.prototype.createObject=function(e,b){var c=fabric[fabric.util.string.capitalize(e.tagName.replace("svg:",""))];if(c&&c.fromElement)try{this._createObject(c,e,b)}catch(d){fabric.log(d)}else this.checkIfDone()};
fabric.ElementsParser.prototype._createObject=function(e,b,c){e.async?e.fromElement(b,this.createCallback(c,b),this.options):(e=e.fromElement(b,this.options),this.resolveGradient(e,"fill"),this.resolveGradient(e,"stroke"),this.reviver&&this.reviver(b,e),this.instances[c]=e,this.checkIfDone())};fabric.ElementsParser.prototype.createCallback=function(e,b){var c=this;return function(d){c.resolveGradient(d,"fill");c.resolveGradient(d,"stroke");c.reviver&&c.reviver(b,d);c.instances[e]=d;c.checkIfDone()}};
fabric.ElementsParser.prototype.resolveGradient=function(e,b){var c=e.get(b);/^url\(/.test(c)&&(c=c.slice(5,c.length-1),fabric.gradientDefs[this.svgUid][c]&&e.set(b,fabric.Gradient.fromElement(fabric.gradientDefs[this.svgUid][c],e)))};fabric.ElementsParser.prototype.checkIfDone=function(){0===--this.numElements&&(this.instances=this.instances.filter(function(e){return null!=e}),this.callback(this.instances))};
(function(e){function b(b,d){this.x=b;this.y=d}e=e.fabric||(e.fabric={});e.Point?e.warn("fabric.Point is already defined"):(e.Point=b,b.prototype={type:"point",constructor:b,add:function(c){return new b(this.x+c.x,this.y+c.y)},addEquals:function(b){this.x+=b.x;this.y+=b.y;return this},scalarAdd:function(c){return new b(this.x+c,this.y+c)},scalarAddEquals:function(b){this.x+=b;this.y+=b;return this},subtract:function(c){return new b(this.x-c.x,this.y-c.y)},subtractEquals:function(b){this.x-=b.x;this.y-=
b.y;return this},scalarSubtract:function(c){return new b(this.x-c,this.y-c)},scalarSubtractEquals:function(b){this.x-=b;this.y-=b;return this},multiply:function(c){return new b(this.x*c,this.y*c)},multiplyEquals:function(b){this.x*=b;this.y*=b;return this},divide:function(c){return new b(this.x/c,this.y/c)},divideEquals:function(b){this.x/=b;this.y/=b;return this},eq:function(b){return this.x===b.x&&this.y===b.y},lt:function(b){return this.x<b.x&&this.y<b.y},lte:function(b){return this.x<=b.x&&this.y<=
b.y},gt:function(b){return this.x>b.x&&this.y>b.y},gte:function(b){return this.x>=b.x&&this.y>=b.y},lerp:function(c,d){"undefined"===typeof d&&(d=.5);d=Math.max(Math.min(1,d),0);return new b(this.x+(c.x-this.x)*d,this.y+(c.y-this.y)*d)},distanceFrom:function(b){var c=this.x-b.x;b=this.y-b.y;return Math.sqrt(c*c+b*b)},midPointFrom:function(b){return this.lerp(b)},min:function(c){return new b(Math.min(this.x,c.x),Math.min(this.y,c.y))},max:function(c){return new b(Math.max(this.x,c.x),Math.max(this.y,
c.y))},toString:function(){return this.x+","+this.y},setXY:function(b,d){this.x=b;this.y=d;return this},setX:function(b){this.x=b;return this},setY:function(b){this.y=b;return this},setFromPoint:function(b){this.x=b.x;this.y=b.y;return this},swap:function(b){var c=this.x,a=this.y;this.x=b.x;this.y=b.y;b.x=c;b.y=a},clone:function(){return new b(this.x,this.y)}})})("undefined"!==typeof exports?exports:this);
(function(e){function b(b){this.status=b;this.points=[]}var c=e.fabric||(e.fabric={});c.Intersection?c.warn("fabric.Intersection is already defined"):(c.Intersection=b,c.Intersection.prototype={constructor:b,appendPoint:function(b){this.points.push(b);return this},appendPoints:function(b){this.points=this.points.concat(b);return this}},c.Intersection.intersectLineLine=function(d,a,g,e){var f=(e.x-g.x)*(d.y-g.y)-(e.y-g.y)*(d.x-g.x);var l=(a.x-d.x)*(d.y-g.y)-(a.y-d.y)*(d.x-g.x);g=(e.y-g.y)*(a.x-d.x)-
(e.x-g.x)*(a.y-d.y);0!==g?(f/=g,l/=g,0<=f&&1>=f&&0<=l&&1>=l?(l=new b("Intersection"),l.appendPoint(new c.Point(d.x+f*(a.x-d.x),d.y+f*(a.y-d.y)))):l=new b):l=0===f||0===l?new b("Coincident"):new b("Parallel");return l},c.Intersection.intersectLinePolygon=function(c,a,g){for(var d=new b,f=g.length,l,e,m=0;m<f;m++)l=g[m],e=g[(m+1)%f],l=b.intersectLineLine(c,a,l,e),d.appendPoints(l.points);0<d.points.length&&(d.status="Intersection");return d},c.Intersection.intersectPolygonPolygon=function(c,a){for(var d=
new b,e=c.length,f=0;f<e;f++){var l=b.intersectLinePolygon(c[f],c[(f+1)%e],a);d.appendPoints(l.points)}0<d.points.length&&(d.status="Intersection");return d},c.Intersection.intersectPolygonRectangle=function(d,a,g){var e=a.min(g),f=a.max(g);g=new c.Point(f.x,e.y);var l=new c.Point(e.x,f.y);a=b.intersectLinePolygon(e,g,d);g=b.intersectLinePolygon(g,f,d);f=b.intersectLinePolygon(f,l,d);d=b.intersectLinePolygon(l,e,d);e=new b;e.appendPoints(a.points);e.appendPoints(g.points);e.appendPoints(f.points);
e.appendPoints(d.points);0<e.points.length&&(e.status="Intersection");return e})})("undefined"!==typeof exports?exports:this);
(function(e){function b(a){a?this._tryParsingColor(a):this.setSource([0,0,0,1])}function c(a,b,c){0>c&&(c+=1);1<c&&--c;return c<1/6?a+6*(b-a)*c:.5>c?b:c<2/3?a+(b-a)*(2/3-c)*6:a}var d=e.fabric||(e.fabric={});d.Color?d.warn("fabric.Color is already defined."):(d.Color=b,d.Color.prototype={_tryParsingColor:function(a){var c;a in b.colorNameMap&&(a=b.colorNameMap[a]);"transparent"===a&&(c=[255,255,255,0]);c||(c=b.sourceFromHex(a));c||(c=b.sourceFromRgb(a));c||(c=b.sourceFromHsl(a));c||(c=[0,0,0,1]);c&&
this.setSource(c)},_rgbToHsl:function(a,b,c){a/=255;b/=255;c/=255;var f=d.util.array.max([a,b,c]);var g=d.util.array.min([a,b,c]);var e=(f+g)/2;if(f===g)var h=g=0;else{var n=f-g;g=.5<e?n/(2-f-g):n/(f+g);switch(f){case a:h=(b-c)/n+(b<c?6:0);break;case b:h=(c-a)/n+2;break;case c:h=(a-b)/n+4}h/=6}return[Math.round(360*h),Math.round(100*g),Math.round(100*e)]},getSource:function(){return this._source},setSource:function(a){this._source=a},toRgb:function(){var a=this.getSource();return"rgb("+a[0]+","+a[1]+
","+a[2]+")"},toRgba:function(){var a=this.getSource();return"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")"},toHsl:function(){var a=this.getSource();a=this._rgbToHsl(a[0],a[1],a[2]);return"hsl("+a[0]+","+a[1]+"%,"+a[2]+"%)"},toHsla:function(){var a=this.getSource(),b=this._rgbToHsl(a[0],a[1],a[2]);return"hsla("+b[0]+","+b[1]+"%,"+b[2]+"%,"+a[3]+")"},toHex:function(){var a=this.getSource();var b=a[0].toString(16);b=1===b.length?"0"+b:b;var c=a[1].toString(16);c=1===c.length?"0"+c:c;a=a[2].toString(16);
a=1===a.length?"0"+a:a;return b.toUpperCase()+c.toUpperCase()+a.toUpperCase()},toHexa:function(){var a=255*this.getSource()[3];a=a.toString(16);a=1===a.length?"0"+a:a;return this.toHex()+a.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(a){var b=this.getSource();b[3]=a;this.setSource(b);return this},toGrayscale:function(){var a=this.getSource(),b=parseInt((.3*a[0]+.59*a[1]+.11*a[2]).toFixed(0),10);this.setSource([b,b,b,a[3]]);return this},toBlackWhite:function(a){var b=
this.getSource(),c=(.3*b[0]+.59*b[1]+.11*b[2]).toFixed(0);b=b[3];c=Number(c)<Number(a||127)?0:255;this.setSource([c,c,c,b]);return this},overlayWith:function(a){a instanceof b||(a=new b(a));var c=[],d=this.getAlpha(),f=this.getSource();a=a.getSource();for(var l=0;3>l;l++)c.push(Math.round(.5*f[l]+.5*a[l]));c[3]=d;this.setSource(c);return this}},d.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?%?)\s*,\s*(\d{1,3}(?:\.\d+)?%?)\s*,\s*(\d{1,3}(?:\.\d+)?%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/,d.Color.reHSLa=
/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}%)\s*,\s*(\d{1,3}%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,d.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,d.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",grey:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},d.Color.fromRgb=function(a){return b.fromSource(b.sourceFromRgb(a))},
d.Color.sourceFromRgb=function(a){if(a=a.match(b.reRGBa)){var c=parseInt(a[1],10)/(/%$/.test(a[1])?100:1)*(/%$/.test(a[1])?255:1),d=parseInt(a[2],10)/(/%$/.test(a[2])?100:1)*(/%$/.test(a[2])?255:1),f=parseInt(a[3],10)/(/%$/.test(a[3])?100:1)*(/%$/.test(a[3])?255:1);return[parseInt(c,10),parseInt(d,10),parseInt(f,10),a[4]?parseFloat(a[4]):1]}},d.Color.fromRgba=b.fromRgb,d.Color.fromHsl=function(a){return b.fromSource(b.sourceFromHsl(a))},d.Color.sourceFromHsl=function(a){if(a=a.match(b.reHSLa)){var d=
(parseFloat(a[1])%360+360)%360/360,e=parseFloat(a[2])/(/%$/.test(a[2])?100:1),f=parseFloat(a[3])/(/%$/.test(a[3])?100:1);if(0===e)f=e=d=f;else{var l=.5>=f?f*(e+1):f+e-f*e,k=2*f-l;f=c(k,l,d+1/3);e=c(k,l,d);d=c(k,l,d-1/3)}return[Math.round(255*f),Math.round(255*e),Math.round(255*d),a[4]?parseFloat(a[4]):1]}},d.Color.fromHsla=b.fromHsl,d.Color.fromHex=function(a){return b.fromSource(b.sourceFromHex(a))},d.Color.sourceFromHex=function(a){if(a.match(b.reHex)){var c=a.slice(a.indexOf("#")+1),d=3===c.length||
4===c.length,f=8===c.length||4===c.length;a=d?c.charAt(0)+c.charAt(0):c.substring(0,2);var l=d?c.charAt(1)+c.charAt(1):c.substring(2,4),e=d?c.charAt(2)+c.charAt(2):c.substring(4,6);c=f?d?c.charAt(3)+c.charAt(3):c.substring(6,8):"FF";return[parseInt(a,16),parseInt(l,16),parseInt(e,16),parseFloat((parseInt(c,16)/255).toFixed(2))]}},d.Color.fromSource=function(a){var c=new b;c.setSource(a);return c})})("undefined"!==typeof exports?exports:this);
(function(){function e(b){var a=b.getAttribute("style"),c=b.getAttribute("offset")||0,d,f;c=parseFloat(c)/(/%$/.test(c)?100:1);c=0>c?0:1<c?1:c;if(a){a=a.split(/\s*;\s*/);""===a[a.length-1]&&a.pop();for(var l=a.length;l--;){var e=a[l].split(/\s*:\s*/),m=e[0].trim();e=e[1].trim();"stop-color"===m?d=e:"stop-opacity"===m&&(f=e)}}d||(d=b.getAttribute("stop-color")||"rgb(0,0,0)");f||(f=b.getAttribute("stop-opacity"));d=new fabric.Color(d);b=d.getAlpha();f=isNaN(parseFloat(f))?1:parseFloat(f);f*=b;return{offset:c,
color:d.toRgb(),opacity:f}}function b(b,a,c){var d=0,f="",l;for(l in a){"Infinity"===a[l]?a[l]=1:"-Infinity"===a[l]&&(a[l]=0);var g=parseFloat(a[l],10);var e="string"===typeof a[l]&&/^\d+%$/.test(a[l])?.01:1;if("x1"===l||"x2"===l||"r2"===l)e*="objectBoundingBox"===c?b.width:1,d="objectBoundingBox"===c?b.left||0:0;else if("y1"===l||"y2"===l)e*="objectBoundingBox"===c?b.height:1,d="objectBoundingBox"===c?b.top||0:0;a[l]=g*e+d}"ellipse"===b.type&&null!==a.r2&&"objectBoundingBox"===c&&b.rx!==b.ry&&(b=
b.ry/b.rx,f=" scale(1, "+b+")",a.y1&&(a.y1/=b),a.y2&&(a.y2/=b));return f}var c=fabric.util.object.clone;fabric.Gradient=fabric.util.createClass({offsetX:0,offsetY:0,initialize:function(b){b||(b={});this.id=fabric.Object.__uid++;this.type=b.type||"linear";var a={x1:b.coords.x1||0,y1:b.coords.y1||0,x2:b.coords.x2||0,y2:b.coords.y2||0};"radial"===this.type&&(a.r1=b.coords.r1||0,a.r2=b.coords.r2||0);this.coords=a;this.colorStops=b.colorStops.slice();b.gradientTransform&&(this.gradientTransform=b.gradientTransform);
this.offsetX=b.offsetX||this.offsetX;this.offsetY=b.offsetY||this.offsetY},addColorStop:function(b){for(var a in b){var c=new fabric.Color(b[a]);this.colorStops.push({offset:parseFloat(a),color:c.toRgb(),opacity:c.getAlpha()})}return this},toObject:function(b){var a={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};fabric.util.populateWithProperties(this,
a,b);return a},toSVG:function(b){var a=c(this.coords,!0),d,e=c(this.colorStops,!0),f=a.r1>a.r2;e.sort(function(a,b){return a.offset-b.offset});if(!b.group||"path-group"!==b.group.type)for(var l in a)if("x1"===l||"x2"===l)a[l]+=this.offsetX-b.width/2;else if("y1"===l||"y2"===l)a[l]+=this.offsetY-b.height/2;b='id="SVGID_'+this.id+'" gradientUnits="userSpaceOnUse"';this.gradientTransform&&(b+=' gradientTransform="matrix('+this.gradientTransform.join(" ")+')" ');"linear"===this.type?d=["<linearGradient ",
b,' x1="',a.x1,'" y1="',a.y1,'" x2="',a.x2,'" y2="',a.y2,'">\n']:"radial"===this.type&&(d=["<radialGradient ",b,' cx="',f?a.x1:a.x2,'" cy="',f?a.y1:a.y2,'" r="',f?a.r1:a.r2,'" fx="',f?a.x2:a.x1,'" fy="',f?a.y2:a.y1,'">\n']);if("radial"===this.type){if(f)for(e=e.concat(),e.reverse(),f=0;f<e.length;f++)e[f].offset=1-e[f].offset;f=Math.min(a.r1,a.r2);if(0<f)for(a=f/Math.max(a.r1,a.r2),f=0;f<e.length;f++)e[f].offset+=a*(1-e[f].offset)}for(f=0;f<e.length;f++)a=e[f],d.push("<stop ",'offset="',100*a.offset+
"%",'" style="stop-color:',a.color,null!==a.opacity?";stop-opacity: "+a.opacity:";",'"/>\n');d.push("linear"===this.type?"</linearGradient>\n":"</radialGradient>\n");return d.join("")},toLive:function(b,a){var c,d=fabric.util.object.clone(this.coords);if(this.type){if(a.group&&"path-group"===a.group.type)for(f in d)if("x1"===f||"x2"===f)d[f]+=-this.offsetX+a.width/2;else if("y1"===f||"y2"===f)d[f]+=-this.offsetY+a.height/2;"linear"===this.type?c=b.createLinearGradient(d.x1,d.y1,d.x2,d.y2):"radial"===
this.type&&(c=b.createRadialGradient(d.x1,d.y1,d.r1,d.x2,d.y2,d.r2));b=0;for(a=this.colorStops.length;b<a;b++){var f=this.colorStops[b].color;d=this.colorStops[b].opacity;var l=this.colorStops[b].offset;"undefined"!==typeof d&&(f=(new fabric.Color(f)).setAlpha(d).toRgba());c.addColorStop(l,f)}return c}}});fabric.util.object.extend(fabric.Gradient,{fromElement:function(c,a){var d=c.getElementsByTagName("stop"),h=c.getAttribute("gradientUnits")||"objectBoundingBox",f=c.getAttribute("gradientTransform"),
l=[],k;var m="linearGradient"===c.nodeName||"LINEARGRADIENT"===c.nodeName?"linear":"radial";"linear"===m?k={x1:c.getAttribute("x1")||0,y1:c.getAttribute("y1")||0,x2:c.getAttribute("x2")||"100%",y2:c.getAttribute("y2")||0}:"radial"===m&&(k={x1:c.getAttribute("fx")||c.getAttribute("cx")||"50%",y1:c.getAttribute("fy")||c.getAttribute("cy")||"50%",r1:0,x2:c.getAttribute("cx")||"50%",y2:c.getAttribute("cy")||"50%",r2:c.getAttribute("r")||"50%"});for(c=d.length;c--;)l.push(e(d[c]));d=b(a,k,h);a=new fabric.Gradient({type:m,
coords:k,colorStops:l,offsetX:-a.left,offsetY:-a.top});if(f||""!==d)a.gradientTransform=fabric.parseTransformAttribute((f||"")+d);return a},forObject:function(c,a){a||(a={});b(c,a.coords,"userSpaceOnUse");return new fabric.Gradient(a)}})})();
(function(){var e=fabric.util.toFixed;fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,initialize:function(b,c){b||(b={});this.id=fabric.Object.__uid++;this.setOptions(b);if(!b.source||b.source&&"string"!==typeof b.source)c&&c(this);else if("undefined"!==typeof fabric.util.getFunctionBody(b.source))this.source=new Function(fabric.util.getFunctionBody(b.source)),c&&c(this);else{var d=this;this.source=fabric.util.createImage();fabric.util.loadImage(b.source,function(a){d.source=
a;c&&c(d)})}},toObject:function(b){var c=fabric.Object.NUM_FRACTION_DIGITS,d;"function"===typeof this.source?d=String(this.source):"string"===typeof this.source.src?d=this.source.src:"object"===typeof this.source&&this.source.toDataURL&&(d=this.source.toDataURL());c={type:"pattern",source:d,repeat:this.repeat,offsetX:e(this.offsetX,c),offsetY:e(this.offsetY,c)};fabric.util.populateWithProperties(this,c,b);return c},toSVG:function(b){var c="function"===typeof this.source?this.source():this.source,
d=c.width/b.width,a=c.height/b.height,g=this.offsetX/b.width;b=this.offsetY/b.height;var e="";if("repeat-x"===this.repeat||"no-repeat"===this.repeat)a=1;if("repeat-y"===this.repeat||"no-repeat"===this.repeat)d=1;c.src?e=c.src:c.toDataURL&&(e=c.toDataURL());return'<pattern id="SVGID_'+this.id+'" x="'+g+'" y="'+b+'" width="'+d+'" height="'+a+'">\n<image x="0" y="0" width="'+c.width+'" height="'+c.height+'" xlink:href="'+e+'"></image>\n</pattern>\n'},setOptions:function(b){for(var c in b)this[c]=b[c]},
toLive:function(b){var c="function"===typeof this.source?this.source():this.source;return c&&("undefined"===typeof c.src||c.complete&&0!==c.naturalWidth&&0!==c.naturalHeight)?b.createPattern(c,this.repeat):""}})})();
(function(e){var b=e.fabric||(e.fabric={}),c=b.util.toFixed;b.Shadow?b.warn("fabric.Shadow is already defined."):(b.Shadow=b.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,initialize:function(c){"string"===typeof c&&(c=this._parseShadow(c));for(var a in c)this[a]=c[a];this.id=b.Object.__uid++},_parseShadow:function(c){c=c.trim();var a=b.Shadow.reOffsetsAndBlur.exec(c)||[];return{color:(c.replace(b.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),
offsetX:parseInt(a[1],10)||0,offsetY:parseInt(a[2],10)||0,blur:parseInt(a[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(d){var a=40,g=40,e=b.Object.NUM_FRACTION_DIGITS,f=b.util.rotateVector({x:this.offsetX,y:this.offsetY},b.util.degreesToRadians(-d.angle));d.width&&d.height&&(a=100*c((Math.abs(f.x)+this.blur)/d.width,e)+20,g=100*c((Math.abs(f.y)+this.blur)/d.height,e)+20);d.flipX&&(f.x*=-1);d.flipY&&(f.y*=-1);return'<filter id="SVGID_'+
this.id+'" y="-'+g+'%" height="'+(100+2*g)+'%" x="-'+a+'%" width="'+(100+2*a)+'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="'+c(this.blur?this.blur/2:0,e)+'"></feGaussianBlur>\n\t<feOffset dx="'+c(f.x,e)+'" dy="'+c(f.y,e)+'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="'+this.color+'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,
blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke};var c={},a=b.Shadow.prototype;["color","blur","offsetX","offsetY","affectStroke"].forEach(function(b){this[b]!==a[b]&&(c[b]=this[b])},this);return c}}),b.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/)})("undefined"!==typeof exports?exports:this);
(function(){if(fabric.StaticCanvas)fabric.warn("fabric.StaticCanvas is already defined.");else{var e=fabric.util.object.extend,b=fabric.util.getElementOffset,c=fabric.util.removeFromArray,d=fabric.util.toFixed,a=fabric.util.transformPoint,g=fabric.util.invertTransform,h=Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass(fabric.CommonMethods,{initialize:function(a,b){b||(b={});this._initStatic(a,b)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,
includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:fabric.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,onBeforeScaleRotate:function(){},enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!1,_initStatic:function(a,b){var f=fabric.StaticCanvas.prototype.renderAll.bind(this);this._objects=[];this._createLowerCanvas(a);this._initOptions(b);this._setImageSmoothing();this.interactive||this._initRetinaScaling();
b.overlayImage&&this.setOverlayImage(b.overlayImage,f);b.backgroundImage&&this.setBackgroundImage(b.backgroundImage,f);b.backgroundColor&&this.setBackgroundColor(b.backgroundColor,f);b.overlayColor&&this.setOverlayColor(b.overlayColor,f);this.calcOffset()},_isRetinaScaling:function(){return 1!==fabric.devicePixelRatio&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?fabric.devicePixelRatio:1},_initRetinaScaling:function(){this._isRetinaScaling()&&(this.lowerCanvasEl.setAttribute("width",
this.width*fabric.devicePixelRatio),this.lowerCanvasEl.setAttribute("height",this.height*fabric.devicePixelRatio),this.contextContainer.scale(fabric.devicePixelRatio,fabric.devicePixelRatio))},calcOffset:function(){this._offset=b(this.lowerCanvasEl);return this},setOverlayImage:function(a,b,c){return this.__setBgOverlayImage("overlayImage",a,b,c)},setBackgroundImage:function(a,b,c){return this.__setBgOverlayImage("backgroundImage",a,b,c)},setOverlayColor:function(a,b){return this.__setBgOverlayColor("overlayColor",
a,b)},setBackgroundColor:function(a,b){return this.__setBgOverlayColor("backgroundColor",a,b)},_setImageSmoothing:function(){var a=this.getContext();a.imageSmoothingEnabled=a.imageSmoothingEnabled||a.webkitImageSmoothingEnabled||a.mozImageSmoothingEnabled||a.msImageSmoothingEnabled||a.oImageSmoothingEnabled;a.imageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(a,b,c,d){"string"===typeof b?fabric.util.loadImage(b,function(b){b&&(this[a]=new fabric.Image(b,d));c&&c(b)},this,
d&&d.crossOrigin):(d&&b.setOptions(d),this[a]=b,c&&c(b));return this},__setBgOverlayColor:function(a,b,c){this[a]=b;this._initGradient(b,a);this._initPattern(b,a,c);return this},_createCanvasElement:function(a){a=fabric.util.createCanvasElement(a);a.style||(a.style={});if(!a)throw h;if("undefined"===typeof a.getContext)throw h;return a},_initOptions:function(a){this._setOptions(a);this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0;this.height=this.height||parseInt(this.lowerCanvasEl.height,
10)||0;this.lowerCanvasEl.style&&(this.lowerCanvasEl.width=this.width,this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(a){this.lowerCanvasEl=fabric.util.getById(a)||this._createCanvasElement(a);fabric.util.addClass(this.lowerCanvasEl,"lower-canvas");this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl);this.contextContainer=
this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(a,b){return this.setDimensions({width:a},b)},setHeight:function(a,b){return this.setDimensions({height:a},b)},setDimensions:function(a,b){b=b||{};for(var f in a){var c=a[f];b.cssOnly||(this._setBackstoreDimension(f,a[f]),c+="px");b.backstoreOnly||this._setCssDimension(f,c)}this._initRetinaScaling();this._setImageSmoothing();this.calcOffset();b.cssOnly||this.renderAll();
return this},_setBackstoreDimension:function(a,b){this.lowerCanvasEl[a]=b;this.upperCanvasEl&&(this.upperCanvasEl[a]=b);this.cacheCanvasEl&&(this.cacheCanvasEl[a]=b);this[a]=b;return this},_setCssDimension:function(a,b){this.lowerCanvasEl.style[a]=b;this.upperCanvasEl&&(this.upperCanvasEl.style[a]=b);this.wrapperEl&&(this.wrapperEl.style[a]=b);return this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(a){var b=this._activeGroup;this.viewportTransform=a;for(var f=
0,c=this._objects.length;f<c;f++)a=this._objects[f],a.group||a.setCoords(!1,!0);b&&b.setCoords(!1,!0);this.calcViewportBoundaries();this.renderAll();return this},zoomToPoint:function(b,c){var f=b,d=this.viewportTransform.slice(0);b=a(b,g(this.viewportTransform));d[0]=c;d[3]=c;b=a(b,d);d[4]+=f.x-b.x;d[5]+=f.y-b.y;return this.setViewportTransform(d)},setZoom:function(a){this.zoomToPoint(new fabric.Point(0,0),a);return this},absolutePan:function(a){var b=this.viewportTransform.slice(0);b[4]=-a.x;b[5]=
-a.y;return this.setViewportTransform(b)},relativePan:function(a){return this.absolutePan(new fabric.Point(-a.x-this.viewportTransform[4],-a.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(a){this.stateful&&a.setupState();a._set("canvas",this);a.setCoords();this.fire("object:added",{target:a});a.fire("added")},_onObjectRemoved:function(a){this.fire("object:removed",{target:a});a.fire("removed");delete a.canvas},clearContext:function(a){a.clearRect(0,
0,this.width,this.height);return this},getContext:function(){return this.contextContainer},clear:function(){this._objects.length=0;this.overlayImage=this.backgroundImage=null;this.overlayColor=this.backgroundColor="";this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1);this.clearContext(this.contextContainer);this.fire("canvas:cleared");this.renderAll();return this},renderAll:function(){this.renderCanvas(this.contextContainer,
this._objects);return this},calcViewportBoundaries:function(){var b={},c=this.getWidth(),d=this.getHeight(),e=g(this.viewportTransform);b.tl=a({x:0,y:0},e);b.br=a({x:c,y:d},e);b.tr=new fabric.Point(b.br.x,b.tl.y);b.bl=new fabric.Point(b.tl.x,b.br.y);return this.vptCoords=b},renderCanvas:function(a,b){this.calcViewportBoundaries();this.clearContext(a);this.fire("before:render");this.clipTo&&fabric.util.clipContext(this,a);this._renderBackground(a);a.save();a.transform.apply(a,this.viewportTransform);
this._renderObjects(a,b);a.restore();!this.controlsAboveOverlay&&this.interactive&&this.drawControls(a);this.clipTo&&a.restore();this._renderOverlay(a);this.controlsAboveOverlay&&this.interactive&&this.drawControls(a);this.fire("after:render")},_renderObjects:function(a,b){for(var f=0,c=b.length;f<c;++f)b[f]&&b[f].render(a)},_renderBackgroundOrOverlay:function(a,b){var f=this[b+"Color"];f&&(a.fillStyle=f.toLive?f.toLive(a,this):f,a.fillRect(f.offsetX||0,f.offsetY||0,this.width,this.height));if(f=
this[b+"Image"])this[b+"Vpt"]&&(a.save(),a.transform.apply(a,this.viewportTransform)),f.render(a),this[b+"Vpt"]&&a.restore()},_renderBackground:function(a){this._renderBackgroundOrOverlay(a,"background")},_renderOverlay:function(a){this._renderBackgroundOrOverlay(a,"overlay")},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(a){return this._centerObject(a,new fabric.Point(this.getCenter().left,a.getCenterPoint().y))},centerObjectV:function(a){return this._centerObject(a,
new fabric.Point(a.getCenterPoint().x,this.getCenter().top))},centerObject:function(a){var b=this.getCenter();return this._centerObject(a,new fabric.Point(b.left,b.top))},viewportCenterObject:function(a){var b=this.getVpCenter();return this._centerObject(a,b)},viewportCenterObjectH:function(a){var b=this.getVpCenter();this._centerObject(a,new fabric.Point(b.x,a.getCenterPoint().y));return this},viewportCenterObjectV:function(a){var b=this.getVpCenter();return this._centerObject(a,new fabric.Point(a.getCenterPoint().x,
b.y))},getVpCenter:function(){var b=this.getCenter(),c=g(this.viewportTransform);return a({x:b.left,y:b.top},c)},_centerObject:function(a,b){a.setPositionByOrigin(b,"center","center");this.renderAll();return this},toDatalessJSON:function(a){return this.toDatalessObject(a)},toObject:function(a){return this._toObjectMethod("toObject",a)},toDatalessObject:function(a){return this._toObjectMethod("toDatalessObject",a)},_toObjectMethod:function(a,b){var c={objects:this._toObjects(a,b)};e(c,this.__serializeBgOverlay(a,
b));fabric.util.populateWithProperties(this,c,b);return c},_toObjects:function(a,b){return this.getObjects().filter(function(a){return!a.excludeFromExport}).map(function(c){return this._toObject(c,a,b)},this)},_toObject:function(a,b,c){if(!this.includeDefaultValues){var f=a.includeDefaultValues;a.includeDefaultValues=!1}b=a[b](c);this.includeDefaultValues||(a.includeDefaultValues=f);return b},__serializeBgOverlay:function(a,b){var c={},f=this.backgroundImage,d=this.overlayImage;this.backgroundColor&&
(c.background=this.backgroundColor.toObject?this.backgroundColor.toObject(b):this.backgroundColor);this.overlayColor&&(c.overlay=this.overlayColor.toObject?this.overlayColor.toObject(b):this.overlayColor);f&&!f.excludeFromExport&&(c.backgroundImage=this._toObject(f,a,b));d&&!d.excludeFromExport&&(c.overlayImage=this._toObject(d,a,b));return c},svgViewportTransformation:!0,toSVG:function(a,b){a||(a={});var c=[];this._setSVGPreamble(c,a);this._setSVGHeader(c,a);this._setSVGBgOverlayColor(c,"backgroundColor");
this._setSVGBgOverlayImage(c,"backgroundImage",b);this._setSVGObjects(c,b);this._setSVGBgOverlayColor(c,"overlayColor");this._setSVGBgOverlayImage(c,"overlayImage",b);c.push("</svg>");return c.join("")},_setSVGPreamble:function(a,b){b.suppressPreamble||a.push('<?xml version="1.0" encoding="',b.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(a,b){var c=b.width||this.width,f=
b.height||this.height,g='viewBox="0 0 '+this.width+" "+this.height+'" ',e=fabric.Object.NUM_FRACTION_DIGITS;b.viewBox?g='viewBox="'+b.viewBox.x+" "+b.viewBox.y+" "+b.viewBox.width+" "+b.viewBox.height+'" ':this.svgViewportTransformation&&(b=this.viewportTransform,g='viewBox="'+d(-b[4]/b[0],e)+" "+d(-b[5]/b[3],e)+" "+d(this.width/b[0],e)+" "+d(this.height/b[3],e)+'" ');a.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',c,'" ',
'height="',f,'" ',g,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",fabric.version,"</desc>\n","<defs>\n",this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),"</defs>\n")},createSVGRefElementsMarkup:function(){var a=this;return["backgroundColor","overlayColor"].map(function(b){if((b=a[b])&&b.toLive)return b.toSVG(a,!1)}).join("")},createSVGFontFacesMarkup:function(){for(var a="",b={},c,d,g,e,h,t=fabric.fontPaths,r=this.getObjects(),w=0,z=r.length;w<z;w++)if(c=r[w],d=c.fontFamily,
-1!==c.type.indexOf("text")&&!b[d]&&t[d]&&(b[d]=!0,c.styles))for(e in c=c.styles,c)for(h in g=c[e],g)d=g[h],d=d.fontFamily,!b[d]&&t[d]&&(b[d]=!0);for(var v in b)a+=["\t\t@font-face {\n\t\t\tfont-family: '",v,"';\n\t\t\tsrc: url('",t[v],"');\n\t\t}\n"].join("");a&&(a=['\t<style type="text/css"><![CDATA[\n',a,"]]\x3e</style>\n"].join(""));return a},_setSVGObjects:function(a,b){for(var c,f=0,d=this.getObjects(),g=d.length;f<g;f++)c=d[f],c.excludeFromExport||this._setSVGObject(a,c,b)},_setSVGObject:function(a,
b,c){a.push(b.toSVG(c))},_setSVGBgOverlayImage:function(a,b,c){this[b]&&this[b].toSVG&&a.push(this[b].toSVG(c))},_setSVGBgOverlayColor:function(a,b){var c=this[b];c&&(c.toLive?(b=c.repeat,a.push('<rect transform="translate(',this.width/2,",",this.height/2,')"',' x="',c.offsetX-this.width/2,'" y="',c.offsetY-this.height/2,'" ','width="',"repeat-y"===b||"no-repeat"===b?c.source.width:this.width,'" height="',"repeat-x"===b||"no-repeat"===b?c.source.height:this.height,'" fill="url(#SVGID_'+c.id+')"',
"></rect>\n")):a.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[b],'"',"></rect>\n"))},sendToBack:function(a){if(!a)return this;var b=this._activeGroup;if(a===b){var f=b._objects;for(a=f.length;a--;)b=f[a],c(this._objects,b),this._objects.unshift(b)}else c(this._objects,a),this._objects.unshift(a);return this.renderAll&&this.renderAll()},bringToFront:function(a){if(!a)return this;var b=this._activeGroup;if(a===b){var f=b._objects;for(a=0;a<f.length;a++)b=f[a],
c(this._objects,b),this._objects.push(b)}else c(this._objects,a),this._objects.push(a);return this.renderAll&&this.renderAll()},sendBackwards:function(a,b){if(!a)return this;var f=this._activeGroup,d=0;if(a===f){var g=f._objects;for(a=0;a<g.length;a++)b=g[a],f=this._objects.indexOf(b),f>0+d&&(--f,c(this._objects,b),this._objects.splice(f,0,b)),d++}else f=this._objects.indexOf(a),0!==f&&(f=this._findNewLowerIndex(a,f,b),c(this._objects,a),this._objects.splice(f,0,a));this.renderAll&&this.renderAll();
return this},_findNewLowerIndex:function(a,b,c){if(c)for(c=b,--b;0<=b;--b){if(a.intersectsWithObject(this._objects[b])||a.isContainedWithinObject(this._objects[b])||this._objects[b].isContainedWithinObject(a)){c=b;break}}else c=b-1;return c},bringForward:function(a,b){if(!a)return this;var f=this._activeGroup,d=0;if(a===f){var g=f._objects;for(a=g.length;a--;)b=g[a],f=this._objects.indexOf(b),f<this._objects.length-1-d&&(f+=1,c(this._objects,b),this._objects.splice(f,0,b)),d++}else f=this._objects.indexOf(a),
f!==this._objects.length-1&&(f=this._findNewUpperIndex(a,f,b),c(this._objects,a),this._objects.splice(f,0,a));this.renderAll&&this.renderAll();return this},_findNewUpperIndex:function(a,b,c){if(c)for(c=b,b+=1;b<this._objects.length;++b){if(a.intersectsWithObject(this._objects[b])||a.isContainedWithinObject(this._objects[b])||this._objects[b].isContainedWithinObject(a)){c=b;break}}else c=b+1;return c},moveTo:function(a,b){c(this._objects,a);this._objects.splice(b,0,a);return this.renderAll&&this.renderAll()},
dispose:function(){this.clear();return this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"}});e(fabric.StaticCanvas.prototype,fabric.Observable);e(fabric.StaticCanvas.prototype,fabric.Collection);e(fabric.StaticCanvas.prototype,fabric.DataURLExporter);e(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(a){var b=fabric.util.createCanvasElement();if(!b||!b.getContext)return null;var c=b.getContext("2d");
if(!c)return null;switch(a){case "getImageData":return"undefined"!==typeof c.getImageData;case "setLineDash":return"undefined"!==typeof c.setLineDash;case "toDataURL":return"undefined"!==typeof b.toDataURL;case "toDataURLWithQuality":try{return b.toDataURL("image/jpeg",0),!0}catch(m){}return!1;default:return null}}});fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject}})();
fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeDashArray:null,setShadow:function(e){this.shadow=new fabric.Shadow(e);return this},_setBrushStyles:function(){var e=this.canvas.contextTop;e.strokeStyle=this.color;e.lineWidth=this.width;e.lineCap=this.strokeLineCap;e.lineJoin=this.strokeLineJoin;this.strokeDashArray&&fabric.StaticCanvas.supports("setLineDash")&&e.setLineDash(this.strokeDashArray)},_setShadow:function(){if(this.shadow){var e=
this.canvas.contextTop,b=this.canvas.getZoom();e.shadowColor=this.shadow.color;e.shadowBlur=this.shadow.blur*b;e.shadowOffsetX=this.shadow.offsetX*b;e.shadowOffsetY=this.shadow.offsetY*b}},_resetShadow:function(){var e=this.canvas.contextTop;e.shadowColor="";e.shadowBlur=e.shadowOffsetX=e.shadowOffsetY=0}});
(function(){fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(e){this.canvas=e;this._points=[]},onMouseDown:function(e){this._prepareForDrawing(e);this._captureDrawingPath(e);this._render()},onMouseMove:function(e){this._captureDrawingPath(e);this.canvas.clearContext(this.canvas.contextTop);this._render()},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(e){e=new fabric.Point(e.x,e.y);this._reset();this._addPoint(e);this.canvas.contextTop.moveTo(e.x,
e.y)},_addPoint:function(e){1<this._points.length&&e.eq(this._points[this._points.length-1])||this._points.push(e)},_reset:function(){this._points.length=0;this._setBrushStyles();this._setShadow()},_captureDrawingPath:function(e){e=new fabric.Point(e.x,e.y);this._addPoint(e)},_render:function(){var e=this.canvas.contextTop,b;var c=this.canvas.viewportTransform;var d=this._points[0],a=this._points[1];e.save();e.transform(c[0],c[1],c[2],c[3],c[4],c[5]);e.beginPath();2===this._points.length&&d.x===a.x&&
d.y===a.y&&(c=this.width/1E3,d=new fabric.Point(d.x,d.y),a=new fabric.Point(a.x,a.y),d.x-=c,a.x+=c);e.moveTo(d.x,d.y);c=1;for(b=this._points.length;c<b;c++)a=d.midPointFrom(a),e.quadraticCurveTo(d.x,d.y,a.x,a.y),d=this._points[c],a=this._points[c+1];e.lineTo(d.x,d.y);e.stroke();e.restore()},convertPointsToSVGPath:function(e){var b=[],c,d=this.width/1E3,a=new fabric.Point(e[0].x,e[0].y),g=new fabric.Point(e[1].x,e[1].y),h=e.length,f=1,l=1,k=2<h;k&&(f=e[2].x<g.x?-1:e[2].x===g.x?0:1,l=e[2].y<g.y?-1:
e[2].y===g.y?0:1);b.push("M ",a.x-f*d," ",a.y-l*d," ");for(c=1;c<h;c++){if(!a.eq(g)){var m=a.midPointFrom(g);b.push("Q ",a.x," ",a.y," ",m.x," ",m.y," ")}a=e[c];c+1<e.length&&(g=e[c+1])}k&&(f=a.x>e[c-2].x?1:a.x===e[c-2].x?0:-1,l=a.y>e[c-2].y?1:a.y===e[c-2].y?0:-1);b.push("L ",a.x+f*d," ",a.y+l*d);return b},createPath:function(e){e=new fabric.Path(e,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray,
originX:"center",originY:"center"});var b=new fabric.Point(e.left,e.top);e.originX=fabric.Object.prototype.originX;e.originY=fabric.Object.prototype.originY;b=e.translateToGivenOrigin(b,"center","center",e.originX,e.originY);e.top=b.y;e.left=b.x;this.shadow&&(this.shadow.affectStroke=!0,e.setShadow(this.shadow));return e},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath();var e=this.convertPointsToSVGPath(this._points).join("");"M 0 0 Q 0 0 0 0 L 0 0"===e?this.canvas.renderAll():(e=
this.createPath(e),this.canvas.add(e),e.setCoords(),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderAll(),this.canvas.fire("path:created",{path:e}))}})})();
fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(e){this.canvas=e;this.points=[]},drawDot:function(e){e=this.addPoint(e);var b=this.canvas.contextTop,c=this.canvas.viewportTransform;b.save();b.transform(c[0],c[1],c[2],c[3],c[4],c[5]);b.fillStyle=e.fill;b.beginPath();b.arc(e.x,e.y,e.radius,0,2*Math.PI,!1);b.closePath();b.fill();b.restore()},onMouseDown:function(e){this.points.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.drawDot(e)},
onMouseMove:function(e){this.drawDot(e)},onMouseUp:function(){var e=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var b=[],c=0,d=this.points.length;c<d;c++){var a=this.points[c];a=new fabric.Circle({radius:a.radius,left:a.x,top:a.y,originX:"center",originY:"center",fill:a.fill});this.shadow&&a.setShadow(this.shadow);b.push(a)}b=new fabric.Group(b,{originX:"center",originY:"center"});b.canvas=this.canvas;this.canvas.add(b);this.canvas.fire("path:created",{path:b});this.canvas.clearContext(this.canvas.contextTop);
this._resetShadow();this.canvas.renderOnAddRemove=e;this.canvas.renderAll()},addPoint:function(e){e=new fabric.Point(e.x,e.y);var b=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,c=(new fabric.Color(this.color)).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();e.radius=b;e.fill=c;this.points.push(e);return e}});
fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(e){this.canvas=e;this.sprayChunks=[]},onMouseDown:function(e){this.sprayChunks.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.addSprayChunk(e);this.render()},onMouseMove:function(e){this.addSprayChunk(e);this.render()},onMouseUp:function(){var e=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=
!1;for(var b=[],c=0,d=this.sprayChunks.length;c<d;c++)for(var a=this.sprayChunks[c],g=0,h=a.length;g<h;g++){var f=new fabric.Rect({width:a[g].width,height:a[g].width,left:a[g].x+1,top:a[g].y+1,originX:"center",originY:"center",fill:this.color});this.shadow&&f.setShadow(this.shadow);b.push(f)}this.optimizeOverlapping&&(b=this._getOptimizedRects(b));b=new fabric.Group(b,{originX:"center",originY:"center"});b.canvas=this.canvas;this.canvas.add(b);this.canvas.fire("path:created",{path:b});this.canvas.clearContext(this.canvas.contextTop);
this._resetShadow();this.canvas.renderOnAddRemove=e;this.canvas.renderAll()},_getOptimizedRects:function(e){for(var b={},c,d=0,a=e.length;d<a;d++)c=e[d].left+""+e[d].top,b[c]||(b[c]=e[d]);e=[];for(c in b)e.push(b[c]);return e},render:function(){var e=this.canvas.contextTop;e.fillStyle=this.color;var b=this.canvas.viewportTransform;e.save();e.transform(b[0],b[1],b[2],b[3],b[4],b[5]);b=0;for(var c=this.sprayChunkPoints.length;b<c;b++){var d=this.sprayChunkPoints[b];"undefined"!==typeof d.opacity&&(e.globalAlpha=
d.opacity);e.fillRect(d.x,d.y,d.width,d.width)}e.restore()},addSprayChunk:function(e){this.sprayChunkPoints=[];for(var b,c,d,a=this.width/2,g=0;g<this.density;g++)b=fabric.util.getRandomInt(e.x-a,e.x+a),c=fabric.util.getRandomInt(e.y-a,e.y+a),d=this.dotWidthVariance?fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth,b=new fabric.Point(b,c),b.width=d,this.randomOpacity&&(b.opacity=fabric.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(b);
this.sprayChunks.push(this.sprayChunkPoints)}});
fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var e=fabric.document.createElement("canvas"),b=e.getContext("2d");e.width=e.height=25;b.fillStyle=this.color;b.beginPath();b.arc(10,10,10,0,2*Math.PI,!1);b.closePath();b.fill();return e},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles");
this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(e){e=this.callSuper("createPath",e);var b=e._getLeftTopCoords().scalarAdd(e.strokeWidth/2);e.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-b.x,offsetY:-b.y});return e}});
(function(){var e=fabric.util.getPointer,b=fabric.util.degreesToRadians,c=fabric.util.radiansToDegrees,d=Math.atan2,a=Math.abs,g=fabric.StaticCanvas.supports("setLineDash");fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(a,b){b||(b={});this._initStatic(a,b);this._initInteractive();this._createCacheCanvas()},uniScaleTransform:!1,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",
altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,_initInteractive:function(){this._groupSelector=
this._currentTransform=null;this._initWrapperElement();this._createUpperCanvas();this._initEventListeners();this._initRetinaScaling();this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this);this.calcOffset()},_chooseObjectsToRender:function(){var a=this.getActiveGroup(),b=this.getActiveObject(),c=[],d=[];if(!a&&!b||this.preserveObjectStacking)c=this._objects;else{for(var g=0,e=this._objects.length;g<e;g++){var h=this._objects[g];a&&a.contains(h)||h===b?d.push(h):c.push(h)}a&&(a._set("_objects",
d),c.push(a));b&&c.push(b)}return c},renderAll:function(){!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1);this.renderCanvas(this.contextContainer,this._chooseObjectsToRender());return this},renderTop:function(){var a=this.contextTop;this.clearContext(a);this.selection&&this._groupSelector&&this._drawSelection(a);this.fire("after:render");this.contextTopDirty=!0;return this},_resetCurrentTransform:function(){var a=this._currentTransform;
a.target.set({scaleX:a.original.scaleX,scaleY:a.original.scaleY,skewX:a.original.skewX,skewY:a.original.skewY,left:a.original.left,top:a.original.top});this._shouldCenterTransform(a.target)?"rotate"===a.action?this._setOriginToCenter(a.target):("center"!==a.originX&&(a.mouseXSign="right"===a.originX?-1:1),"center"!==a.originY&&(a.mouseYSign="bottom"===a.originY?-1:1),a.originX="center",a.originY="center"):(a.originX=a.original.originX,a.originY=a.original.originY)},containsPoint:function(a,b,c){a=
c||this.getPointer(a,!0);c=b.group&&b.group===this.getActiveGroup()?this._normalizePointer(b.group,a):{x:a.x,y:a.y};return b.containsPoint(c)||b._findTargetCorner(a)},_normalizePointer:function(a,b){a=a.calcTransformMatrix();a=fabric.util.invertTransform(a);b=this.restorePointerVpt(b);return fabric.util.transformPoint(b,a)},isTargetTransparent:function(a,b,c){var f=a.hasBorders,d=a.transparentCorners,g=this.contextCache,e=a.selectionBackgroundColor;a.hasBorders=a.transparentCorners=!1;a.selectionBackgroundColor=
"";g.save();g.transform.apply(g,this.viewportTransform);a.render(g);g.restore();a.active&&a._renderControls(g);a.hasBorders=f;a.transparentCorners=d;a.selectionBackgroundColor=e;a=fabric.util.isTransparent(g,b,c,this.targetFindTolerance);this.clearContext(g);return a},_shouldClearSelection:function(a,b){var c=this.getActiveGroup(),f=this.getActiveObject();return!b||b&&c&&!c.contains(b)&&c!==b&&!a[this.selectionKey]||b&&!b.evented||b&&!b.selectable&&f&&f!==b},_shouldCenterTransform:function(a){if(a){var b=
this._currentTransform,c;"scale"===b.action||"scaleX"===b.action||"scaleY"===b.action?c=this.centeredScaling||a.centeredScaling:"rotate"===b.action&&(c=this.centeredRotation||a.centeredRotation);return c?!b.altKey:b.altKey}},_getOriginFromCorner:function(a,b){a={x:a.originX,y:a.originY};if("ml"===b||"tl"===b||"bl"===b)a.x="right";else if("mr"===b||"tr"===b||"br"===b)a.x="left";if("tl"===b||"mt"===b||"tr"===b)a.y="bottom";else if("bl"===b||"mb"===b||"br"===b)a.y="top";return a},_getActionFromCorner:function(a,
b,c){if(!b)return"drag";switch(b){case "mtr":return"rotate";case "ml":case "mr":return c[this.altActionKey]?"skewY":"scaleX";case "mt":case "mb":return c[this.altActionKey]?"skewX":"scaleY";default:return"scale"}},_setupCurrentTransform:function(a,c){if(c){var f=this.getPointer(a),d=c._findTargetCorner(this.getPointer(a,!0)),g=this._getActionFromCorner(c,d,a),e=this._getOriginFromCorner(c,d);this._currentTransform={target:c,action:g,corner:d,scaleX:c.scaleX,scaleY:c.scaleY,skewX:c.skewX,skewY:c.skewY,
offsetX:f.x-c.left,offsetY:f.y-c.top,originX:e.x,originY:e.y,ex:f.x,ey:f.y,lastX:f.x,lastY:f.y,left:c.left,top:c.top,theta:b(c.angle),width:c.width*c.scaleX,mouseXSign:1,mouseYSign:1,shiftKey:a.shiftKey,altKey:a[this.centeredKey]};this._currentTransform.original={left:c.left,top:c.top,scaleX:c.scaleX,scaleY:c.scaleY,skewX:c.skewX,skewY:c.skewY,originX:e.x,originY:e.y};this._resetCurrentTransform()}},_translateObject:function(a,b){var c=this._currentTransform,f=c.target;a-=c.offsetX;b-=c.offsetY;c=
!f.get("lockMovementX")&&f.left!==a;var d=!f.get("lockMovementY")&&f.top!==b;c&&f.set("left",a);d&&f.set("top",b);return c||d},_changeSkewTransformOrigin:function(a,b,c){var f="originX",d={0:"center"},g=b.target.skewX,e="left",l="right",h="mt"===b.corner||"ml"===b.corner?1:-1,k=1;a=0<a?1:-1;"y"===c&&(g=b.target.skewY,e="top",l="bottom",f="originY");d[-1]=e;d[1]=l;b.target.flipX&&(k*=-1);b.target.flipY&&(k*=-1);0===g?(b.skewSign=-h*a*k,b[f]=d[-a]):(g=0<g?1:-1,b.skewSign=g,b[f]=d[g*h*k])},_skewObject:function(a,
b,c){var f=this._currentTransform,d=f.target,g=d.get("lockSkewingX"),e=d.get("lockSkewingY");if(g&&"x"===c||e&&"y"===c)return!1;e=d.getCenterPoint();var l=d.toLocalPoint(new fabric.Point(a,b),"center","center")[c],h=d.toLocalPoint(new fabric.Point(f.lastX,f.lastY),"center","center")[c];g=d._getTransformedDimensions();this._changeSkewTransformOrigin(l-h,f,c);l=d.toLocalPoint(new fabric.Point(a,b),f.originX,f.originY)[c];e=d.translateToOriginPoint(e,f.originX,f.originY);c=this._setObjectSkew(l,f,c,
g);f.lastX=a;f.lastY=b;d.setPositionByOrigin(e,f.originX,f.originY);return c},_setObjectSkew:function(a,b,c,d){var f=b.target,g=b.skewSign;if("x"===c){b="y";var e="Y";var l="X";var h=0;var k=f.skewY}else b="x",e="X",l="Y",h=f.skewX,k=0;h=f._getTransformedDimensions(h,k);a=2*Math.abs(a)-h[c];2>=a?c=0:(c=g*Math.atan(a/f["scale"+l]/(h[b]/f["scale"+e])),c=fabric.util.radiansToDegrees(c));a=f["skew"+l]!==c;f.set("skew"+l,c);0!==f["skew"+e]&&(l=f._getTransformedDimensions(),c=d[b]/l[b]*f["scale"+e],f.set("scale"+
e,c));return a},_scaleObject:function(a,b,c){var f=this._currentTransform,d=f.target,g=d.get("lockScalingX"),e=d.get("lockScalingY"),l=d.get("lockScalingFlip");if(g&&e)return!1;var h=d.translateToOriginPoint(d.getCenterPoint(),f.originX,f.originY);a=d.toLocalPoint(new fabric.Point(a,b),f.originX,f.originY);b=d._getTransformedDimensions();this._setLocalMouse(a,f);c=this._setObjectScale(a,f,g,e,c,l,b);d.setPositionByOrigin(h,f.originX,f.originY);return c},_setObjectScale:function(a,b,c,d,g,e,h){var f=
b.target,l=!1,k=!1,m=!1;var n=a.x*f.scaleX/h.x;var p=a.y*f.scaleY/h.y;var q=f.scaleX!==n;var u=f.scaleY!==p;e&&0>=n&&n<f.scaleX&&(l=!0);e&&0>=p&&p<f.scaleY&&(k=!0);"equally"!==g||c||d?g?"x"!==g||f.get("lockUniScaling")?"y"!==g||f.get("lockUniScaling")||k||d||f.set("scaleY",p)&&(m=m||u):l||c||f.set("scaleX",n)&&(m=m||q):(l||c||f.set("scaleX",n)&&(m=m||q),k||d||f.set("scaleY",p)&&(m=m||u)):l||k||(m=this._scaleObjectEqually(a,f,b,h));b.newScaleX=n;b.newScaleY=p;l||k||this._flipObject(b,g);return m},
_scaleObjectEqually:function(a,b,c,d){var f=a.y+a.x;d=d.y*c.original.scaleY/b.scaleY+d.x*c.original.scaleX/b.scaleX;var g=a.y/Math.abs(a.y);c.newScaleX=a.x/Math.abs(a.x)*Math.abs(c.original.scaleX*f/d);c.newScaleY=g*Math.abs(c.original.scaleY*f/d);a=c.newScaleX!==b.scaleX||c.newScaleY!==b.scaleY;b.set("scaleX",c.newScaleX);b.set("scaleY",c.newScaleY);return a},_flipObject:function(a,b){0>a.newScaleX&&"y"!==b&&("left"===a.originX?a.originX="right":"right"===a.originX&&(a.originX="left"));0>a.newScaleY&&
"x"!==b&&("top"===a.originY?a.originY="bottom":"bottom"===a.originY&&(a.originY="top"))},_setLocalMouse:function(b,c){var f=c.target,d=this.getZoom();f=f.padding/d;"right"===c.originX?b.x*=-1:"center"===c.originX&&(b.x=2*b.x*c.mouseXSign,0>b.x&&(c.mouseXSign=-c.mouseXSign));"bottom"===c.originY?b.y*=-1:"center"===c.originY&&(b.y=2*b.y*c.mouseYSign,0>b.y&&(c.mouseYSign=-c.mouseYSign));a(b.x)>f?b.x=0>b.x?b.x+f:b.x-f:b.x=0;a(b.y)>f?b.y=0>b.y?b.y+f:b.y-f:b.y=0},_rotateObject:function(a,b){var f=this._currentTransform;
if(f.target.get("lockRotation"))return!1;var g=d(f.ey-f.top,f.ex-f.left);a=d(b-f.top,a-f.left);g=c(a-g+f.theta);a=!0;if(0<f.target.snapAngle){var e=f.target.snapAngle;b=f.target.snapThreshold||e;var h=Math.ceil(g/e)*e;e*=Math.floor(g/e);Math.abs(g-e)<b?g=e:Math.abs(g-h)<b&&(g=h)}0>g&&(g=360+g);g%=360;f.target.angle===g?a=!1:f.target.angle=g;return a},setCursor:function(a){this.upperCanvasEl.style.cursor=a},_resetObjectTransform:function(a){a.scaleX=1;a.scaleY=1;a.skewX=0;a.skewY=0;a.setAngle(0)},
_drawSelection:function(b){var c=this._groupSelector,f=c.left,d=c.top,e=a(f),h=a(d);this.selectionColor&&(b.fillStyle=this.selectionColor,b.fillRect(c.ex-(0<f?0:-f),c.ey-(0<d?0:-d),e,h));this.selectionLineWidth&&this.selectionBorderColor&&(b.lineWidth=this.selectionLineWidth,b.strokeStyle=this.selectionBorderColor,1<this.selectionDashArray.length&&!g?(f=c.ex+.5-(0<f?0:e),c=c.ey+.5-(0<d?0:h),b.beginPath(),fabric.util.drawDashedLine(b,f,c,f+e,c,this.selectionDashArray),fabric.util.drawDashedLine(b,
f,c+h-1,f+e,c+h-1,this.selectionDashArray),fabric.util.drawDashedLine(b,f,c,f,c+h,this.selectionDashArray),fabric.util.drawDashedLine(b,f+e-1,c,f+e-1,c+h,this.selectionDashArray),b.closePath(),b.stroke()):(fabric.Object.prototype._setLineDash.call(this,b,this.selectionDashArray),b.strokeRect(c.ex+.5-(0<f?0:e),c.ey+.5-(0<d?0:h),e,h)))},findTarget:function(a,b){if(!this.skipTargetFind){var c=this.getPointer(a,!0),f=this.getActiveGroup(),d=this.getActiveObject();this.targets=[];if(f&&!b&&f===this._searchPossibleTargets([f],
c))return this._fireOverOutEvents(f,a),f;if(d&&d._findTargetCorner(c))return this._fireOverOutEvents(d,a),d;if(d&&d===this._searchPossibleTargets([d],c))if(this.preserveObjectStacking){var g=d;var e=this.targets;this.targets=[]}else return this._fireOverOutEvents(d,a),d;b=this._searchPossibleTargets(this._objects,c);a[this.altSelectionKey]&&b&&g&&b!==g&&(b=g,this.targets=e);this._fireOverOutEvents(b,a);return b}},_fireOverOutEvents:function(a,b){var c=this._hoveredTarget;if(c!==a){var f={e:b,target:a,
previousTarget:this._hoveredTarget};var d={e:b,target:this._hoveredTarget,nextTarget:a};this._hoveredTarget=a}a?c!==a&&(c&&(this.fire("mouse:out",d),c.fire("mouseout",d)),this.fire("mouse:over",f),a.fire("mouseover",f)):c&&(this.fire("mouse:out",d),c.fire("mouseout",d))},_checkTarget:function(a,b){if(b&&b.visible&&b.evented&&this.containsPoint(null,b,a)&&(!this.perPixelTargetFind&&!b.perPixelTargetFind||b.isEditing||!this.isTargetTransparent(b,a.x,a.y)))return!0},_searchPossibleTargets:function(a,
b){for(var c,f=a.length;f--;)if(this._checkTarget(b,a[f])){c=a[f];"group"===c.type&&c.subTargetCheck&&(a=this._normalizePointer(c,b),(a=this._searchPossibleTargets(c._objects,a))&&this.targets.push(a));break}return c},restorePointerVpt:function(a){return fabric.util.transformPoint(a,fabric.util.invertTransform(this.viewportTransform))},getPointer:function(a,b,c){var f,d;c||(c=this.upperCanvasEl);a=e(a);var g=c.getBoundingClientRect(),h=g.width||0,l=g.height||0;h&&l||("top"in g&&"bottom"in g&&(l=Math.abs(g.top-
g.bottom)),"right"in g&&"left"in g&&(h=Math.abs(g.right-g.left)));this.calcOffset();a.x-=this._offset.left;a.y-=this._offset.top;b||(a=this.restorePointerVpt(a));0===h||0===l?(f=1,d=1):(f=c.width/h,d=c.height/l);return{x:a.x*f,y:a.y*d}},_createUpperCanvas:function(){var a=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl?this.upperCanvasEl.className="":this.upperCanvasEl=this._createCanvasElement();fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+a);this.wrapperEl.appendChild(this.upperCanvasEl);
this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl);this._applyCanvasStyle(this.upperCanvasEl);this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement();this.cacheCanvasEl.setAttribute("width",this.width);this.cacheCanvasEl.setAttribute("height",this.height);this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass});
fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"});fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(a){var b=this.getWidth()||a.width,c=this.getHeight()||a.height;fabric.util.setStyle(a,{position:"absolute",width:b+"px",height:c+"px",left:0,top:0,"touch-action":"none"});a.width=b;a.height=c;fabric.util.makeElementUnselectable(a)},_copyCanvasStyle:function(a,b){b.style.cssText=a.style.cssText},getSelectionContext:function(){return this.contextTop},
getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(a){var b=this._activeObject;if(b&&(b.set("active",!1),a!==b&&b.onDeselect&&"function"===typeof b.onDeselect))b.onDeselect();this._activeObject=a;a.set("active",!0)},setActiveObject:function(a,b){var c=this.getActiveObject();c&&c!==a&&c.fire("deselected",{e:b});this._setActiveObject(a);this.fire("object:selected",{target:a,e:b});a.fire("selected",{e:b});this.renderAll();return this},getActiveObject:function(){return this._activeObject},
_onObjectRemoved:function(a){this.getActiveObject()===a&&(this.fire("before:selection:cleared",{target:a}),this._discardActiveObject(),this.fire("selection:cleared",{target:a}),a.fire("deselected"));this._hoveredTarget===a&&(this._hoveredTarget=null);this.callSuper("_onObjectRemoved",a)},_discardActiveObject:function(){var a=this._activeObject;if(a&&(a.set("active",!1),a.onDeselect&&"function"===typeof a.onDeselect))a.onDeselect();this._activeObject=null},discardActiveObject:function(a){var b=this._activeObject;
b&&(this.fire("before:selection:cleared",{target:b,e:a}),this._discardActiveObject(),this.fire("selection:cleared",{e:a}),b.fire("deselected",{e:a}));return this},_setActiveGroup:function(a){(this._activeGroup=a)&&a.set("active",!0)},setActiveGroup:function(a,b){this._setActiveGroup(a);a&&(this.fire("object:selected",{target:a,e:b}),a.fire("selected",{e:b}));return this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var a=this.getActiveGroup();a&&a.destroy();this.setActiveGroup(null)},
discardActiveGroup:function(a){var b=this.getActiveGroup();b&&(this.fire("before:selection:cleared",{e:a,target:b}),this._discardActiveGroup(),this.fire("selection:cleared",{e:a}));return this},deactivateAll:function(){for(var a=this.getObjects(),b=0,c=a.length,d;b<c;b++)(d=a[b])&&d.set("active",!1);this._discardActiveGroup();this._discardActiveObject();return this},deactivateAllWithDispatch:function(a){for(var b=this.getObjects(),c=0,d=b.length,f;c<d;c++)(f=b[c])&&f.set("active",!1);this.discardActiveGroup(a);
this.discardActiveObject(a);return this},dispose:function(){fabric.StaticCanvas.prototype.dispose.call(this);var a=this.wrapperEl;this.removeListeners();a.removeChild(this.upperCanvasEl);a.removeChild(this.lowerCanvasEl);delete this.upperCanvasEl;a.parentNode&&a.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl);delete this.wrapperEl;return this},clear:function(){this.discardActiveGroup();this.discardActiveObject();this.clearContext(this.contextTop);return this.callSuper("clear")},drawControls:function(a){var b=
this.getActiveGroup();b?b._renderControls(a):this._drawObjectsControls(a)},_drawObjectsControls:function(a){for(var b=0,c=this._objects.length;b<c;++b)this._objects[b]&&this._objects[b].active&&this._objects[b]._renderControls(a)},_toObject:function(a,b,c){var d=this._realizeGroupTransformOnObject(a);b=this.callSuper("_toObject",a,b,c);this._unwindGroupTransformOnObject(a,d);return b},_realizeGroupTransformOnObject:function(a){if(a.group&&a.group===this.getActiveGroup()){var b={};"angle flipX flipY left scaleX scaleY skewX skewY top".split(" ").forEach(function(c){b[c]=
a[c]});this.getActiveGroup().realizeTransform(a);return b}return null},_unwindGroupTransformOnObject:function(a,b){b&&a.set(b)},_setSVGObject:function(a,b,c){var d=this._realizeGroupTransformOnObject(b);this.callSuper("_setSVGObject",a,b,c);this._unwindGroupTransformOnObject(b,d)}});for(var h in fabric.StaticCanvas)"prototype"!==h&&(fabric.Canvas[h]=fabric.StaticCanvas[h]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){});fabric.Element=fabric.Canvas})();
(function(){function e(a,b){return"which"in a?a.which===b:a.button===b-1}var b={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},c=fabric.util.addListener,d=fabric.util.removeListener;fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:"n-resize ne-resize e-resize se-resize s-resize sw-resize w-resize nw-resize".split(" "),_initEventListeners:function(){this.removeListeners();this._bindEvents();c(fabric.window,"resize",this._onResize);c(this.upperCanvasEl,"mousedown",this._onMouseDown);c(this.upperCanvasEl,
"mousemove",this._onMouseMove);c(this.upperCanvasEl,"mouseout",this._onMouseOut);c(this.upperCanvasEl,"mouseenter",this._onMouseEnter);c(this.upperCanvasEl,"wheel",this._onMouseWheel);c(this.upperCanvasEl,"contextmenu",this._onContextMenu);c(this.upperCanvasEl,"touchstart",this._onMouseDown,{passive:!1});c(this.upperCanvasEl,"touchmove",this._onMouseMove,{passive:!1});"undefined"!==typeof eventjs&&"add"in eventjs&&(eventjs.add(this.upperCanvasEl,"gesture",this._onGesture),eventjs.add(this.upperCanvasEl,
"drag",this._onDrag),eventjs.add(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.add(this.upperCanvasEl,"shake",this._onShake),eventjs.add(this.upperCanvasEl,"longpress",this._onLongPress))},_bindEvents:function(){this.eventsBinded||(this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),
this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this.eventsBinded=!0)},removeListeners:function(){d(fabric.window,"resize",this._onResize);d(this.upperCanvasEl,"mousedown",this._onMouseDown);d(this.upperCanvasEl,
"mousemove",this._onMouseMove);d(this.upperCanvasEl,"mouseout",this._onMouseOut);d(this.upperCanvasEl,"mouseenter",this._onMouseEnter);d(this.upperCanvasEl,"wheel",this._onMouseWheel);d(this.upperCanvasEl,"contextmenu",this._onContextMenu);d(this.upperCanvasEl,"touchstart",this._onMouseDown);d(this.upperCanvasEl,"touchmove",this._onMouseMove);"undefined"!==typeof eventjs&&"remove"in eventjs&&(eventjs.remove(this.upperCanvasEl,"gesture",this._onGesture),eventjs.remove(this.upperCanvasEl,"drag",this._onDrag),
eventjs.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.remove(this.upperCanvasEl,"shake",this._onShake),eventjs.remove(this.upperCanvasEl,"longpress",this._onLongPress))},_onGesture:function(a,b){this.__onTransformGesture&&this.__onTransformGesture(a,b)},_onDrag:function(a,b){this.__onDrag&&this.__onDrag(a,b)},_onMouseWheel:function(a){this.__onMouseWheel(a)},_onMouseOut:function(a){var b=this._hoveredTarget;this.fire("mouse:out",{target:b,e:a});this._hoveredTarget=null;
b&&b.fire("mouseout",{e:a});this._iTextInstances&&this._iTextInstances.forEach(function(a){a.isEditing&&a.hiddenTextarea.focus()})},_onMouseEnter:function(a){this.findTarget(a)||(this.fire("mouse:over",{target:null,e:a}),this._hoveredTarget=null)},_onOrientationChange:function(a,b){this.__onOrientationChange&&this.__onOrientationChange(a,b)},_onShake:function(a,b){this.__onShake&&this.__onShake(a,b)},_onLongPress:function(a,b){this.__onLongPress&&this.__onLongPress(a,b)},_onContextMenu:function(a){this.stopContextMenu&&
(a.stopPropagation(),a.preventDefault());return!1},_onMouseDown:function(a){this.__onMouseDown(a);c(fabric.document,"touchend",this._onMouseUp,{passive:!1});c(fabric.document,"touchmove",this._onMouseMove,{passive:!1});d(this.upperCanvasEl,"mousemove",this._onMouseMove);d(this.upperCanvasEl,"touchmove",this._onMouseMove);"touchstart"===a.type?d(this.upperCanvasEl,"mousedown",this._onMouseDown):(c(fabric.document,"mouseup",this._onMouseUp),c(fabric.document,"mousemove",this._onMouseMove))},_onMouseUp:function(a){this.__onMouseUp(a);
d(fabric.document,"mouseup",this._onMouseUp);d(fabric.document,"touchend",this._onMouseUp);d(fabric.document,"mousemove",this._onMouseMove);d(fabric.document,"touchmove",this._onMouseMove);c(this.upperCanvasEl,"mousemove",this._onMouseMove);c(this.upperCanvasEl,"touchmove",this._onMouseMove,{passive:!1});if("touchend"===a.type){var b=this;setTimeout(function(){c(b.upperCanvasEl,"mousedown",b._onMouseDown)},400)}},_onMouseMove:function(a){!this.allowTouchScrolling&&a.preventDefault&&a.preventDefault();
this.__onMouseMove(a)},_onResize:function(){this.calcOffset()},_shouldRender:function(a,b){var c=this.getActiveGroup()||this.getActiveObject();return c&&c.isEditing&&a===c?!1:!!(a&&(a.isMoving||a!==c)||!a&&c||!a&&!c&&!this._groupSelector||b&&this._previousPointer&&this.selection&&(b.x!==this._previousPointer.x||b.y!==this._previousPointer.y))},__onMouseUp:function(a){if(e(a,3))this.fireRightClick&&this._handleEvent(a,"up",b,3);else if(e(a,2))this.fireMiddleClick&&this._handleEvent(a,"up",b,2);else if(this.isDrawingMode&&
this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(a);else{var b=!0;var c=this._currentTransform,d=this._groupSelector;d=!d||0===d.left&&0===d.top;c&&(this._finalizeCurrentTransform(a),b=!c.actionPerformed);b=b?this.findTarget(a,!0):c.target;c=this._shouldRender(b,this.getPointer(a));b||!d?this._maybeGroupObjects(a):this._currentTransform=this._groupSelector=null;b&&(b.isMoving=!1);this._setCursorFromEvent(a,b);this._handleEvent(a,"up",b?b:null,1,d);b&&(b.__corner=0);c&&this.renderAll()}},_handleEvent:function(a,
b,c,d,e){var f="undefined"===typeof c?this.findTarget(a):c;c=this.targets||[];a={e:a,target:f,subTargets:c,button:d||1,isClick:e||!1};this.fire("mouse:"+b,a);f&&f.fire("mouse"+b,a);for(d=0;d<c.length;d++)c[d].fire("mouse"+b,a)},_finalizeCurrentTransform:function(a){var b=this._currentTransform,c=b.target;c._scaling&&(c._scaling=!1);c.setCoords();this._restoreOriginXY(c);if(b.actionPerformed||this.stateful&&c.hasStateChanged())this.fire("object:modified",{target:c,e:a}),c.fire("modified",{e:a})},_restoreOriginXY:function(a){if(this._previousOriginX&&
this._previousOriginY){var b=a.translateToOriginPoint(a.getCenterPoint(),this._previousOriginX,this._previousOriginY);a.originX=this._previousOriginX;a.originY=this._previousOriginY;a.left=b.x;a.top=b.y;this._previousOriginY=this._previousOriginX=null}},_onMouseDownInDrawingMode:function(a){this._isCurrentlyDrawing=!0;this.discardActiveObject(a).renderAll();this.clipTo&&fabric.util.clipContext(this,this.contextTop);var b=this.getPointer(a);this.freeDrawingBrush.onMouseDown(b);this._handleEvent(a,
"down")},_onMouseMoveInDrawingMode:function(a){if(this._isCurrentlyDrawing){var b=this.getPointer(a);this.freeDrawingBrush.onMouseMove(b)}this.setCursor(this.freeDrawingCursor);this._handleEvent(a,"move")},_onMouseUpInDrawingMode:function(a){this._isCurrentlyDrawing=!1;this.clipTo&&this.contextTop.restore();this.freeDrawingBrush.onMouseUp();this._handleEvent(a,"up")},__onMouseDown:function(a){var b=this.findTarget(a);if(e(a,3))this.fireRightClick&&this._handleEvent(a,"down",b?b:null,3);else if(e(a,
2))this.fireMiddleClick&&this._handleEvent(a,"down",b?b:null,2);else if(this.isDrawingMode)this._onMouseDownInDrawingMode(a);else if(!this._currentTransform){var c=this.getPointer(a,!0);this._previousPointer=c;var d=this._shouldRender(b,c),l=this._shouldGroup(a,b);this._shouldClearSelection(a,b)?this.deactivateAllWithDispatch(a):l&&(this._handleGrouping(a,b),b=this.getActiveGroup());!this.selection||b&&(b.selectable||b.isEditing)||(this._groupSelector={ex:c.x,ey:c.y,top:0,left:0});b&&(!b.selectable||
!b.__corner&&l||(this._beforeTransform(a,b),this._setupCurrentTransform(a,b)),c=this.getActiveObject(),b!==this.getActiveGroup()&&b!==c&&(this.deactivateAll(),b.selectable&&(c&&c.fire("deselected",{e:a}),this.setActiveObject(b,a))));this._handleEvent(a,"down",b?b:null);d&&this.renderAll()}},_beforeTransform:function(a,b){this.stateful&&b.saveState();if(b._findTargetCorner(this.getPointer(a)))this.onBeforeScaleRotate(b)},_setOriginToCenter:function(a){this._previousOriginX=this._currentTransform.target.originX;
this._previousOriginY=this._currentTransform.target.originY;var b=a.getCenterPoint();a.originX="center";a.originY="center";a.left=b.x;a.top=b.y;this._currentTransform.left=a.left;this._currentTransform.top=a.top},_setCenterToOrigin:function(a){var b=a.translateToOriginPoint(a.getCenterPoint(),this._previousOriginX,this._previousOriginY);a.originX=this._previousOriginX;a.originY=this._previousOriginY;a.left=b.x;a.top=b.y;this._previousOriginY=this._previousOriginX=null},__onMouseMove:function(a){if(this.isDrawingMode)this._onMouseMoveInDrawingMode(a);
else if(!("undefined"!==typeof a.touches&&1<a.touches.length)){var b=this._groupSelector;if(b){var c=this.getPointer(a,!0);b.left=c.x-b.ex;b.top=c.y-b.ey;this.renderTop()}else if(this._currentTransform)this._transformObject(a);else{var d=this.findTarget(a);this._setCursorFromEvent(a,d)}this._handleEvent(a,"move",d?d:null)}},__onMouseWheel:function(a){this._handleEvent(a,"wheel")},_transformObject:function(a){var b=this.getPointer(a),c=this._currentTransform;c.reset=!1;c.target.isMoving=!0;c.shiftKey=
a.shiftKey;c.altKey=a[this.centeredKey];this._beforeScaleTransform(a,c);this._performTransformAction(a,c,b);c.actionPerformed&&this.renderAll()},_performTransformAction:function(a,b,c){var d=c.x,e=c.y;c=b.target;var g=b.action;if("rotate"===g)(d=this._rotateObject(d,e))&&this._fire("rotating",c,a);else if("scale"===g)(d=this._onScale(a,b,d,e))&&this._fire("scaling",c,a);else if("scaleX"===g)(d=this._scaleObject(d,e,"x"))&&this._fire("scaling",c,a);else if("scaleY"===g)(d=this._scaleObject(d,e,"y"))&&
this._fire("scaling",c,a);else if("skewX"===g)(d=this._skewObject(d,e,"x"))&&this._fire("skewing",c,a);else if("skewY"===g)(d=this._skewObject(d,e,"y"))&&this._fire("skewing",c,a);else if(d=this._translateObject(d,e))this._fire("moving",c,a),this.setCursor(c.moveCursor||this.moveCursor);b.actionPerformed=b.actionPerformed||d},_fire:function(a,b,c){this.fire("object:"+a,{target:b,e:c});b.fire(a,{e:c})},_beforeScaleTransform:function(a,b){if("scale"===b.action||"scaleX"===b.action||"scaleY"===b.action)if((a=
this._shouldCenterTransform(b.target))&&("center"!==b.originX||"center"!==b.originY)||!a&&"center"===b.originX&&"center"===b.originY)this._resetCurrentTransform(),b.reset=!0},_onScale:function(a,b,c,d){if(!a[this.uniScaleKey]&&!this.uniScaleTransform||b.target.get("lockUniScaling"))return b.reset||"scale"!==b.currentAction||this._resetCurrentTransform(),b.currentAction="scaleEqually",this._scaleObject(c,d,"equally");b.currentAction="scale";return this._scaleObject(c,d)},_setCursorFromEvent:function(a,
b){if(!b)return this.setCursor(this.defaultCursor),!1;var c=b.hoverCursor||this.hoverCursor,d=this.getActiveGroup();(d=b._findTargetCorner&&(!d||!d.contains(b))&&b._findTargetCorner(this.getPointer(a,!0)))?this._setCornerCursor(d,b,a):this.setCursor(c);return!0},_setCornerCursor:function(a,c,d){if(a in b)this.setCursor(this._getRotatedCornerCursor(a,c,d));else if("mtr"===a&&c.hasRotatingPoint)this.setCursor(this.rotationCursor);else return this.setCursor(this.defaultCursor),!1},_getRotatedCornerCursor:function(a,
c,d){c=Math.round(c.getAngle()%360/45);0>c&&(c+=8);c+=b[a];d[this.altActionKey]&&0===b[a]%2&&(c+=2);return this.cursorMap[c%8]}})})();
(function(){var e=Math.min,b=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(b,d){var a=this.getActiveObject();return b[this.selectionKey]&&d&&d.selectable&&(this.getActiveGroup()||a&&a!==d)&&this.selection},_handleGrouping:function(b,d){var a=this.getActiveGroup();if(d===a&&(d=this.findTarget(b,!0),!d))return;a?this._updateActiveGroup(d,b):this._createActiveGroup(d,b);this._activeGroup&&this._activeGroup.saveCoords()},_updateActiveGroup:function(b,d){var a=this.getActiveGroup();
if(a.contains(b)){if(a.removeWithUpdate(b),b.set("active",!1),1===a.size()){this.discardActiveGroup(d);this.setActiveObject(a.item(0),d);return}}else a.addWithUpdate(b);this.fire("selection:created",{target:a,e:d});a.set("active",!0)},_createActiveGroup:function(b,d){if(this._activeObject&&b!==this._activeObject){var a=this._createGroup(b);a.addWithUpdate();this.setActiveGroup(a,d);this._activeObject=null;this.fire("selection:created",{target:a,e:d})}b.set("active",!0)},_createGroup:function(b){var c=
this.getObjects();b=c.indexOf(this._activeObject)<c.indexOf(b)?[this._activeObject,b]:[b,this._activeObject];this._activeObject.isEditing&&this._activeObject.exitEditing();return new fabric.Group(b,{canvas:this})},_groupSelectedObjects:function(b){var c=this._collectObjects();1===c.length?this.setActiveObject(c[0],b):1<c.length&&(c=new fabric.Group(c.reverse(),{canvas:this}),c.addWithUpdate(),this.setActiveGroup(c,b),c.saveCoords(),this.fire("selection:created",{target:c,e:b}),this.renderAll())},
_collectObjects:function(){var c=[];var d=this._groupSelector.ex;var a=this._groupSelector.ey,g=d+this._groupSelector.left,h=a+this._groupSelector.top,f=new fabric.Point(e(d,g),e(a,h)),l=new fabric.Point(b(d,g),b(a,h));a=d===g&&a===h;for(g=this._objects.length;g--&&!((d=this._objects[g])&&d.selectable&&d.visible&&(d.intersectsWithRect(f,l)||d.isContainedWithinRect(f,l)||d.containsPoint(f)||d.containsPoint(l))&&(d.set("active",!0),c.push(d),a)););return c},_maybeGroupObjects:function(b){this.selection&&
this._groupSelector&&this._groupSelectedObjects(b);if(b=this.getActiveGroup())b.setObjectsCoords().setCoords(),b.isMoving=!1,this.setCursor(this.defaultCursor);this._currentTransform=this._groupSelector=null}})})();
(function(){var e=fabric.StaticCanvas.supports("toDataURLWithQuality");fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(b){b||(b={});return this.__toDataURLWithMultiplier(b.format||"png",b.quality||1,{left:b.left||0,top:b.top||0,width:b.width||0,height:b.height||0},b.multiplier||1)},__toDataURLWithMultiplier:function(b,c,d,a){var e=this.getWidth(),h=this.getHeight(),f=(d.width||this.getWidth())*a,l=(d.height||this.getHeight())*a,k=this.getZoom()*a,m=this.viewportTransform,
n=this.interactive;this.viewportTransform=[k,0,0,k,(m[4]-d.left)*a,(m[5]-d.top)*a];this.interactive&&(this.interactive=!1);e!==f||h!==l?this.setDimensions({width:f,height:l},{backstoreOnly:!0}):this.renderAll();b=this.__toDataURL(b,c,d);n&&(this.interactive=n);this.viewportTransform=m;this.setDimensions({width:e,height:h},{backstoreOnly:!0});return b},__toDataURL:function(b,c){var d=this.contextContainer.canvas;"jpg"===b&&(b="jpeg");return e?d.toDataURL("image/"+b,c):d.toDataURL("image/"+b)},toDataURLWithMultiplier:function(b,
c,d){return this.toDataURL({format:b,multiplier:c,quality:d})}})})();
fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(e,b,c){return this.loadFromJSON(e,b,c)},loadFromJSON:function(e,b,c){if(e){var d="string"===typeof e?JSON.parse(e):fabric.util.object.clone(e),a=this,g=this.renderOnAddRemove;this.renderOnAddRemove=!1;this._enlivenObjects(d.objects,function(c){a.clear();a._setBgOverlay(d,function(){c.forEach(function(b,c){a.insertAt(b,c)});a.renderOnAddRemove=g;delete d.objects;delete d.backgroundImage;delete d.overlayImage;delete d.background;
delete d.overlay;a._setOptions(d);a.renderAll();b&&b()})},c);return this}},_setBgOverlay:function(e,b){var c={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(e.backgroundImage||e.overlayImage||e.background||e.overlay){var d=function(){c.backgroundImage&&c.overlayImage&&c.backgroundColor&&c.overlayColor&&b&&b()};this.__setBgOverlay("backgroundImage",e.backgroundImage,c,d);this.__setBgOverlay("overlayImage",e.overlayImage,c,d);this.__setBgOverlay("backgroundColor",e.background,
c,d);this.__setBgOverlay("overlayColor",e.overlay,c,d)}else b&&b()},__setBgOverlay:function(e,b,c,d){var a=this;if(b)if("backgroundImage"===e||"overlayImage"===e)fabric.util.enlivenObjects([b],function(b){a[e]=b[0];c[e]=!0;d&&d()});else this["set"+fabric.util.string.capitalize(e,!0)](b,function(){c[e]=!0;d&&d()});else c[e]=!0,d&&d()},_enlivenObjects:function(e,b,c){e&&0!==e.length?fabric.util.enlivenObjects(e,function(c){b&&b(c)},null,c):b&&b([])},_toDataURL:function(e,b){this.clone(function(c){b(c.toDataURL(e))})},
_toDataURLWithMultiplier:function(e,b,c){this.clone(function(d){c(d.toDataURLWithMultiplier(e,b))})},clone:function(e,b){var c=JSON.stringify(this.toJSON(b));this.cloneWithoutData(function(b){b.loadFromJSON(c,function(){e&&e(b)})})},cloneWithoutData:function(e){var b=fabric.document.createElement("canvas");b.width=this.getWidth();b.height=this.getHeight();var c=new fabric.Canvas(b);c.clipTo=this.clipTo;this.backgroundImage?(c.setBackgroundImage(this.backgroundImage.src,function(){c.renderAll();e&&
e(c)}),c.backgroundImageOpacity=this.backgroundImageOpacity,c.backgroundImageStretch=this.backgroundImageStretch):e&&e(c)}});
(function(e){var b=e.fabric||(e.fabric={});e=b.util.object.extend;var c=b.util.object.clone,d=b.util.toFixed,a=b.util.string.capitalize,g=b.util.degreesToRadians,h=b.StaticCanvas.supports("setLineDash");b.Object||(b.Object=b.util.createClass(b.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",
borderDashArray:null,cornerColor:"rgba(102,153,255,0.5)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:.01,selectable:!0,
evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:!b.isLikelyNode,statefullCache:!1,noScaleCache:!0,dirty:!0,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow clipTo visible backgroundColor skewX skewY fillRule".split(" "),
cacheProperties:"fill stroke strokeWidth strokeDashArray width height strokeLineCap strokeLineJoin strokeMiterLimit backgroundColor".split(" "),initialize:function(a){a=a||{};this.setOptions(a)},_createCacheCanvas:function(){this._cacheProperties={};this._cacheCanvas=b.document.createElement("canvas");this._cacheContext=this._cacheCanvas.getContext("2d");this._updateCacheCanvas()},_limitCacheSize:function(a){var c=b.perfLimitSizeTotal,d=a.width,f=a.height,e=b.maxCacheSideLimit,g=b.minCacheSideLimit;
if(d<=e&&f<=e&&d*f<=c)return d<g&&(a.width=g),f<g&&(a.height=g),a;var h=b.util.limitDimsByArea(d/f,c),t=b.util.capValue;c=t(g,h.x,e);e=t(g,h.y,e);d>c&&(a.zoomX/=d/c,a.width=c,a.capped=!0);f>e&&(a.zoomY/=f/e,a.height=e,a.capped=!0);return a},_getCacheCanvasDimensions:function(){var a=this.canvas&&this.canvas.getZoom()||1,c=this.getObjectScaling(),d=this.canvas&&this.canvas._isRetinaScaling()?b.devicePixelRatio:1,e=this._getNonTransformedDimensions(),g=c.scaleX*a*d;a=c.scaleY*a*d;return{width:e.x*g+
2,height:e.y*a+2,zoomX:g,zoomY:a,x:e.x,y:e.y}},_updateCacheCanvas:function(){if(this.noScaleCache&&this.canvas&&this.canvas._currentTransform){var a=this.canvas._currentTransform.action;if(this===this.canvas._currentTransform.target&&a.slice&&"scale"===a.slice(0,5))return!1}a=this._cacheCanvas;var c=this._limitCacheSize(this._getCacheCanvasDimensions()),d=b.minCacheSideLimit,e=c.width,g=c.height,h=c.zoomX,q=c.zoomY,t=e!==this.cacheWidth||g!==this.cacheHeight,r=this.zoomX!==h||this.zoomY!==q,w=0,z=
0,v=!1;if(t){v=this._cacheCanvas.width;var A=this._cacheCanvas.height,D=e>v||g>A;v=D||(e<.9*v||g<.9*A)&&v>d&&A>d;D&&!c.capped&&(e>d||g>d)&&(w=.1*e,z=.1*g)}return t||r?(v?(a.width=Math.ceil(e+w),a.height=Math.ceil(g+z)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,a.width,a.height)),d=c.x*h/2,c=c.y*q/2,this.cacheTranslationX=Math.round(a.width/2-d)+d,this.cacheTranslationY=Math.round(a.height/2-c)+c,this.cacheWidth=e,this.cacheHeight=g,this._cacheContext.translate(this.cacheTranslationX,
this.cacheTranslationY),this._cacheContext.scale(h,q),this.zoomX=h,this.zoomY=q,!0):!1},setOptions:function(a){this._setOptions(a);this._initGradient(a.fill,"fill");this._initGradient(a.stroke,"stroke");this._initClipping(a);this._initPattern(a.fill,"fill");this._initPattern(a.stroke,"stroke")},transform:function(a,b){this.group&&!this.group._transformDone&&this.group===this.canvas._activeGroup&&this.group.transform(a);b=b?this._getLeftTopCoords():this.getCenterPoint();a.translate(b.x,b.y);this.angle&&
a.rotate(g(this.angle));a.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1));this.skewX&&a.transform(1,0,Math.tan(g(this.skewX)),1,0,0);this.skewY&&a.transform(1,Math.tan(g(this.skewY)),0,1,0,0)},toObject:function(a){var c=b.Object.NUM_FRACTION_DIGITS;c={type:this.type,originX:this.originX,originY:this.originY,left:d(this.left,c),top:d(this.top,c),width:d(this.width,c),height:d(this.height,c),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?
this.stroke.toObject():this.stroke,strokeWidth:d(this.strokeWidth,c),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:d(this.strokeMiterLimit,c),scaleX:d(this.scaleX,c),scaleY:d(this.scaleY,c),angle:d(this.getAngle(),c),flipX:this.flipX,flipY:this.flipY,opacity:d(this.opacity,c),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,
clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,globalCompositeOperation:this.globalCompositeOperation,transformMatrix:this.transformMatrix?this.transformMatrix.concat():null,skewX:d(this.skewX,c),skewY:d(this.skewY,c)};b.util.populateWithProperties(this,c,a);this.includeDefaultValues||(c=this._removeDefaultValues(c));return c},toDatalessObject:function(a){return this.toObject(a)},_removeDefaultValues:function(a){var c=b.util.getKlass(a.type).prototype;
c.stateProperties.forEach(function(b){a[b]===c[b]&&delete a[b];"[object Array]"===Object.prototype.toString.call(a[b])&&"[object Array]"===Object.prototype.toString.call(c[b])&&0===a[b].length&&0===c[b].length&&delete a[b]});return a},toString:function(){return"#<fabric."+a(this.type)+">"},getObjectScaling:function(){var a=this.scaleX,b=this.scaleY;if(this.group){var c=this.group.getObjectScaling();a*=c.scaleX;b*=c.scaleY}return{scaleX:a,scaleY:b}},_set:function(a,c){var d=this[a]!==c;if("scaleX"===
a||"scaleY"===a)c=this._constrainScale(c);"scaleX"===a&&0>c?(this.flipX=!this.flipX,c*=-1):"scaleY"===a&&0>c?(this.flipY=!this.flipY,c*=-1):"shadow"!==a||!c||c instanceof b.Shadow?"dirty"===a&&this.group&&this.group.set("dirty",c):c=new b.Shadow(c);this[a]=c;d&&-1<this.cacheProperties.indexOf(a)&&(this.group&&this.group.set("dirty",!0),this.dirty=!0);d&&this.group&&-1<this.stateProperties.indexOf(a)&&this.group.set("dirty",!0);if("width"===a||"height"===a)this.minScaleLimit=Math.min(.1,1/Math.max(this.width,
this.height));return this},setOnGroup:function(){},setSourcePath:function(a){this.sourcePath=a;return this},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:b.iMatrix.concat()},isNotVisible:function(){return 0===this.opacity||0===this.width&&0===this.height||!this.visible},render:function(a,c){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(a.save(),this._setupCompositeOperation(a),this.drawSelectionBackground(a),
c||this.transform(a),this._setOpacity(a),this._setShadow(a),this.transformMatrix&&a.transform.apply(a,this.transformMatrix),this.clipTo&&b.util.clipContext(this,a),this.shouldCache(c)?(this._cacheCanvas||this._createCacheCanvas(),this.isCacheDirty(c)&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,c),this.dirty=!1),this.drawCacheOnCanvas(a)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(a,c),c&&this.objectCaching&&this.statefullCache&&
this.saveState({propertySet:"cacheProperties"})),this.clipTo&&a.restore(),a.restore())},_removeCacheCanvas:function(){this._cacheCanvas=null;this.cacheHeight=this.cacheWidth=0},needsItsOwnCache:function(){return!1},shouldCache:function(a){return!a&&this.objectCaching&&(!this.group||this.needsItsOwnCache()||!this.group.isCaching())},willDrawShadow:function(){return!!this.shadow&&(0!==this.shadow.offsetX||0!==this.shadow.offsetY)},drawObject:function(a,b){this._renderBackground(a);this._setStrokeStyles(a);
this._setFillStyles(a);this._render(a,b)},drawCacheOnCanvas:function(a){a.scale(1/this.zoomX,1/this.zoomY);a.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(a){if(this.isNotVisible())return!1;if(this._cacheCanvas&&!a&&this._updateCacheCanvas())return!0;if(this.dirty||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&!a){a=this.cacheWidth/this.zoomX;var b=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-a/
2,-b/2,a,b)}return!0}return!1},_renderBackground:function(a){if(this.backgroundColor){var b=this._getNonTransformedDimensions();a.fillStyle=this.backgroundColor;a.fillRect(-b.x/2,-b.y/2,b.x,b.y);this._removeShadow(a)}},_setOpacity:function(a){a.globalAlpha*=this.opacity},_setStrokeStyles:function(a){this.stroke&&(a.lineWidth=this.strokeWidth,a.lineCap=this.strokeLineCap,a.lineJoin=this.strokeLineJoin,a.miterLimit=this.strokeMiterLimit,a.strokeStyle=this.stroke.toLive?this.stroke.toLive(a,this):this.stroke)},
_setFillStyles:function(a){this.fill&&(a.fillStyle=this.fill.toLive?this.fill.toLive(a,this):this.fill)},_setLineDash:function(a,b,c){b&&(1&b.length&&b.push.apply(b,b),h?a.setLineDash(b):c&&c(a))},_renderControls:function(a){if(this.active&&(!this.group||this.group===this.canvas.getActiveGroup())){var c=this.getViewportTransform(),d=this.calcTransformMatrix();d=b.util.multiplyTransformMatrices(c,d);c=b.util.qrDecompose(d);a.save();a.translate(c.translateX,c.translateY);a.lineWidth=1*this.borderScaleFactor;
this.group||(a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1);this.group&&this.group===this.canvas.getActiveGroup()?(a.rotate(g(c.angle)),this.drawBordersInGroup(a,c)):(a.rotate(g(this.angle)),this.drawBorders(a));this.drawControls(a);a.restore()}},_setShadow:function(a){if(this.shadow){var c=this.canvas&&this.canvas.viewportTransform[0]||1,d=this.canvas&&this.canvas.viewportTransform[3]||1,f=this.getObjectScaling();this.canvas&&this.canvas._isRetinaScaling()&&(c*=b.devicePixelRatio,d*=
b.devicePixelRatio);a.shadowColor=this.shadow.color;a.shadowBlur=this.shadow.blur*(c+d)*(f.scaleX+f.scaleY)/4;a.shadowOffsetX=this.shadow.offsetX*c*f.scaleX;a.shadowOffsetY=this.shadow.offsetY*d*f.scaleY}},_removeShadow:function(a){this.shadow&&(a.shadowColor="",a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0)},_applyPatternGradientTransform:function(a,b){if(b.toLive){var c=b.gradientTransform||b.patternTransform;c&&a.transform.apply(a,c);a.translate(-this.width/2+b.offsetX||0,-this.height/2+b.offsetY||
0)}},_renderFill:function(a){this.fill&&(a.save(),this._applyPatternGradientTransform(a,this.fill),"evenodd"===this.fillRule?a.fill("evenodd"):a.fill(),a.restore())},_renderStroke:function(a){this.stroke&&0!==this.strokeWidth&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a),a.save(),this._setLineDash(a,this.strokeDashArray,this._renderDashedStroke),this._applyPatternGradientTransform(a,this.stroke),a.stroke(),a.restore())},clone:function(a,c){return this.constructor.fromObject?this.constructor.fromObject(this.toObject(c),
a):new b.Object(this.toObject(c))},cloneAsImage:function(a,c){c=this.toDataURL(c);b.util.loadImage(c,function(c){a&&a(new b.Image(c))});return this},toDataURL:function(a){a||(a={});var c=b.util.createCanvasElement(),d=this.getBoundingRect();c.width=d.width;c.height=d.height;b.util.wrapElement(c,"div");c=new b.StaticCanvas(c,{enableRetinaScaling:a.enableRetinaScaling});"jpg"===a.format&&(a.format="jpeg");"jpeg"===a.format&&(c.backgroundColor="#fff");d={active:this.get("active"),left:this.getLeft(),
top:this.getTop()};this.set("active",!1);this.setPositionByOrigin(new b.Point(c.getWidth()/2,c.getHeight()/2),"center","center");var f=this.canvas;c.add(this);a=c.toDataURL(a);this.set(d).setCoords();this.canvas=f;c.dispose();return a},isType:function(a){return this.type===a},complexity:function(){return 1},toJSON:function(a){return this.toObject(a)},setGradient:function(a,c){c||(c={});var d={colorStops:[]};d.type=c.type||(c.r1||c.r2?"radial":"linear");d.coords={x1:c.x1,y1:c.y1,x2:c.x2,y2:c.y2};if(c.r1||
c.r2)d.coords.r1=c.r1,d.coords.r2=c.r2;d.gradientTransform=c.gradientTransform;b.Gradient.prototype.addColorStop.call(d,c.colorStops);return this.set(a,b.Gradient.forObject(this,d))},setPatternFill:function(a){return this.set("fill",new b.Pattern(a))},setShadow:function(a){return this.set("shadow",a?new b.Shadow(a):null)},setColor:function(a){this.set("fill",a);return this},setAngle:function(a){var b=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;b&&this._setOriginToCenter();
this.set("angle",a);b&&this._resetOrigin();return this},centerH:function(){this.canvas&&this.canvas.centerObjectH(this);return this},viewportCenterH:function(){this.canvas&&this.canvas.viewportCenterObjectH(this);return this},centerV:function(){this.canvas&&this.canvas.centerObjectV(this);return this},viewportCenterV:function(){this.canvas&&this.canvas.viewportCenterObjectV(this);return this},center:function(){this.canvas&&this.canvas.centerObject(this);return this},viewportCenter:function(){this.canvas&&
this.canvas.viewportCenterObject(this);return this},remove:function(){this.canvas&&(this.group&&this.group===this.canvas._activeGroup&&this.group.remove(this),this.canvas.remove(this));return this},getLocalPointer:function(a,c){c=c||this.canvas.getPointer(a);a=new b.Point(c.x,c.y);c=this._getLeftTopCoords();this.angle&&(a=b.util.rotatePoint(a,c,g(-this.angle)));return{x:a.x-c.x,y:a.y-c.y}},_setupCompositeOperation:function(a){this.globalCompositeOperation&&(a.globalCompositeOperation=this.globalCompositeOperation)}}),
b.util.createAccessors(b.Object),b.Object.prototype.rotate=b.Object.prototype.setAngle,e(b.Object.prototype,b.Observable),b.Object.NUM_FRACTION_DIGITS=2,b.Object._fromObject=function(a,d,e,g,h){var f=b[a];d=c(d,!0);if(g)b.util.enlivenPatterns([d.fill,d.stroke],function(a){"undefined"!==typeof a[0]&&(d.fill=a[0]);"undefined"!==typeof a[1]&&(d.stroke=a[1]);a=h?new f(d[h],d):new f(d);e&&e(a)});else return a=h?new f(d[h],d):new f(d),e&&e(a),a},b.Object.__uid=0)})("undefined"!==typeof exports?exports:
this);
(function(){var e=fabric.util.degreesToRadians,b={left:-.5,center:0,right:.5},c={top:-.5,center:0,bottom:.5};fabric.util.object.extend(fabric.Object.prototype,{translateToGivenOrigin:function(d,a,e,h,f){var g=d.x,k=d.y;a="string"===typeof a?b[a]:a-.5;h="string"===typeof h?b[h]:h-.5;a=h-a;e="string"===typeof e?c[e]:e-.5;f="string"===typeof f?c[f]:f-.5;e=f-e;if(a||e)k=this._getTransformedDimensions(),g=d.x+a*k.x,k=d.y+e*k.y;return new fabric.Point(g,k)},translateToCenterPoint:function(b,a,c){a=this.translateToGivenOrigin(b,
a,c,"center","center");return this.angle?fabric.util.rotatePoint(a,b,e(this.angle)):a},translateToOriginPoint:function(b,a,c){a=this.translateToGivenOrigin(b,"center","center",a,c);return this.angle?fabric.util.rotatePoint(a,b,e(this.angle)):a},getCenterPoint:function(){var b=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(b,this.originX,this.originY)},getPointByOrigin:function(b,a){var c=this.getCenterPoint();return this.translateToOriginPoint(c,b,a)},toLocalPoint:function(b,
a,c){var d=this.getCenterPoint();a="undefined"!==typeof a&&"undefined"!==typeof c?this.translateToGivenOrigin(d,"center","center",a,c):new fabric.Point(this.left,this.top);b=new fabric.Point(b.x,b.y);this.angle&&(b=fabric.util.rotatePoint(b,d,-e(this.angle)));return b.subtractEquals(a)},setPositionByOrigin:function(b,a,c){b=this.translateToCenterPoint(b,a,c);b=this.translateToOriginPoint(b,this.originX,this.originY);this.set("left",b.x);this.set("top",b.y)},adjustPosition:function(c){var a=e(this.angle),
d=this.getWidth(),h=Math.cos(a)*d;a=Math.sin(a)*d;d="string"===typeof this.originX?b[this.originX]:this.originX-.5;var f="string"===typeof c?b[c]:c-.5;this.left+=h*(f-d);this.top+=a*(f-d);this.setCoords();this.originX=c},_setOriginToCenter:function(){this._originalOriginX=this.originX;this._originalOriginY=this.originY;var b=this.getCenterPoint();this.originY=this.originX="center";this.left=b.x;this.top=b.y},_resetOrigin:function(){var b=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,
this._originalOriginY);this.originX=this._originalOriginX;this.originY=this._originalOriginY;this.left=b.x;this.top=b.y;this._originalOriginY=this._originalOriginX=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")},onDeselect:function(){}})})();
(function(){var e=fabric.util.degreesToRadians,b=fabric.util.multiplyTransformMatrices;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,aCoords:null,getCoords:function(b,d){this.oCoords||this.setCoords();var a=b?this.aCoords:this.oCoords;b=d?this.calcCoords(b):a;return[new fabric.Point(b.tl.x,b.tl.y),new fabric.Point(b.tr.x,b.tr.y),new fabric.Point(b.br.x,b.br.y),new fabric.Point(b.bl.x,b.bl.y)]},intersectsWithRect:function(b,d,a,e){a=this.getCoords(a,e);return"Intersection"===fabric.Intersection.intersectPolygonRectangle(a,
b,d).status},intersectsWithObject:function(b,d,a){return"Intersection"===fabric.Intersection.intersectPolygonPolygon(this.getCoords(d,a),b.getCoords(d,a)).status||b.isContainedWithinObject(this,d,a)||this.isContainedWithinObject(b,d,a)},isContainedWithinObject:function(b,d,a){var c=this.getCoords(d,a),e=0;for(d=b._getImageLines(a?b.calcCoords(d):d?b.aCoords:b.oCoords);4>e;e++)if(!b.containsPoint(c[e],d))return!1;return!0},isContainedWithinRect:function(b,d,a,e){a=this.getBoundingRect(a,e);return a.left>=
b.x&&a.left+a.width<=d.x&&a.top>=b.y&&a.top+a.height<=d.y},containsPoint:function(b,d,a,e){d=d||this._getImageLines(e?this.calcCoords(a):a?this.aCoords:this.oCoords);b=this._findCrossPoints(b,d);return 0!==b&&1===b%2},isOnScreen:function(b){if(!this.canvas)return!1;var c=this.canvas.vptCoords.tl,a=this.canvas.vptCoords.br;b=this.getCoords(!0,b);for(var e,h=0;4>h;h++)if(e=b[h],e.x<=a.x&&e.x>=c.x&&e.y<=a.y&&e.y>=c.y)return!0;return this.intersectsWithRect(c,a,!0)||this.containsPoint({x:(c.x+a.x)/2,
y:(c.y+a.y)/2},null,!0)?!0:!1},_getImageLines:function(b){return{topline:{o:b.tl,d:b.tr},rightline:{o:b.tr,d:b.br},bottomline:{o:b.br,d:b.bl},leftline:{o:b.bl,d:b.tl}}},_findCrossPoints:function(b,d){var a=0,c;for(c in d){var e=d[c];if(!(e.o.y<b.y&&e.d.y<b.y||e.o.y>=b.y&&e.d.y>=b.y)){if(e.o.x===e.d.x&&e.o.x>=b.x)var f=e.o.x;else{f=(e.d.y-e.o.y)/(e.d.x-e.o.x);var l=b.y-0*b.x;e=e.o.y-f*e.o.x;f=-(l-e)/(0-f)}f>=b.x&&(a+=1);if(2===a)break}}return a},getBoundingRectWidth:function(){return this.getBoundingRect().width},
getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(b,d){b=this.getCoords(b,d);return fabric.util.makeBoundingBoxFromPoints(b)},getWidth:function(){return this._getTransformedDimensions().x},getHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(b){return Math.abs(b)<this.minScaleLimit?0>b?-this.minScaleLimit:this.minScaleLimit:b!==b?this.minScaleLimit:0===b?1E-4:b},scale:function(b){b=this._constrainScale(b);0>b&&(this.flipX=
!this.flipX,this.flipY=!this.flipY,b*=-1);this.scaleY=this.scaleX=b;return this.setCoords()},scaleToWidth:function(b){var c=this.getBoundingRect().width/this.getWidth();return this.scale(b/this.width/c)},scaleToHeight:function(b){var c=this.getBoundingRect().height/this.getHeight();return this.scale(b/this.height/c)},calcCoords:function(b){var c=e(this.angle),a=this.getViewportTransform(),g=b?this._getTransformedDimensions():this._calculateCurrentDimensions(),h=g.x,f=g.y;g=Math.sin(c);var l=Math.cos(c),
k=0<h?Math.atan(f/h):0,m=h/Math.cos(k)/2,n=Math.cos(k+c)*m;c=Math.sin(k+c)*m;k=this.getCenterPoint();k=b?k:fabric.util.transformPoint(k,a);a=new fabric.Point(k.x-n,k.y-c);h=new fabric.Point(a.x+h*l,a.y+h*g);f=new fabric.Point(a.x-f*g,a.y+f*l);n=new fabric.Point(k.x+n,k.y+c);if(!b)var p=new fabric.Point((a.x+f.x)/2,(a.y+f.y)/2),q=new fabric.Point((h.x+a.x)/2,(h.y+a.y)/2),t=new fabric.Point((n.x+h.x)/2,(n.y+h.y)/2),r=new fabric.Point((n.x+f.x)/2,(n.y+f.y)/2),w=new fabric.Point(q.x+g*this.rotatingPointOffset,
q.y-l*this.rotatingPointOffset);k={tl:a,tr:h,br:n,bl:f};b||(k.ml=p,k.mt=q,k.mr=t,k.mb=r,k.mtr=w);return k},setCoords:function(b,d){this.oCoords=this.calcCoords(b);d||(this.aCoords=this.calcCoords(!0));b||this._setCornerCoords&&this._setCornerCoords();return this},_calcRotateMatrix:function(){if(this.angle){var b=e(this.angle),d=Math.cos(b);b=Math.sin(b);if(6.123233995736766E-17===d||-1.8369701987210297E-16===d)d=0;return[d,b,-b,d,0,0]}return fabric.iMatrix.concat()},calcTransformMatrix:function(c){var d=
this.getCenterPoint(),a=[1,0,0,1,d.x,d.y];d=this._calcDimensionsTransformMatrix(this.skewX,this.skewY,!0);a=this.group&&!c?b(this.group.calcTransformMatrix(),a):a;this.angle&&(c=this._calcRotateMatrix(),a=b(a,c));return a=b(a,d)},_calcDimensionsTransformMatrix:function(c,d,a){a=[this.scaleX*(a&&this.flipX?-1:1),0,0,this.scaleY*(a&&this.flipY?-1:1),0,0];c&&(c=[1,0,Math.tan(e(c)),1],a=b(a,c,!0));d&&(c=[1,Math.tan(e(d)),0,1],a=b(a,c,!0));return a},_getNonTransformedDimensions:function(){var b=this.strokeWidth;
return{x:this.width+b,y:this.height+b}},_getTransformedDimensions:function(b,d){"undefined"===typeof b&&(b=this.skewX);"undefined"===typeof d&&(d=this.skewY);var a=this._getNonTransformedDimensions(),c=a.x/2;a=a.y/2;c=[{x:-c,y:-a},{x:c,y:-a},{x:-c,y:a},{x:c,y:a}];d=this._calcDimensionsTransformMatrix(b,d,!1);for(b=0;b<c.length;b++)c[b]=fabric.util.transformPoint(c[b],d);b=fabric.util.makeBoundingBoxFromPoints(c);return{x:b.width,y:b.height}},_calculateCurrentDimensions:function(){var b=this.getViewportTransform(),
d=this._getTransformedDimensions();return fabric.util.transformPoint(d,b,!0).scalarAdd(2*this.padding)}})})();
fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){this.group?fabric.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this);return this},bringToFront:function(){this.group?fabric.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this);return this},sendBackwards:function(e){this.group?fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,e):this.canvas.sendBackwards(this,e);return this},bringForward:function(e){this.group?
fabric.StaticCanvas.prototype.bringForward.call(this.group,this,e):this.canvas.bringForward(this,e);return this},moveTo:function(e){this.group?fabric.StaticCanvas.prototype.moveTo.call(this.group,this,e):this.canvas.moveTo(this,e);return this}});
(function(){function e(b,c){if(c){if(c.toLive)return b+": url(#SVGID_"+c.id+"); ";var d=new fabric.Color(c);c=b+": "+d.toRgb()+"; ";d=d.getAlpha();1!==d&&(c+=b+"-opacity: "+d.toString()+"; ");return c}return b+": none; "}fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(b){var c=this.fillRule,d=this.strokeWidth?this.strokeWidth:"0",a=this.strokeDashArray?this.strokeDashArray.join(" "):"none",g=this.strokeLineCap?this.strokeLineCap:"butt",h=this.strokeLineJoin?this.strokeLineJoin:
"miter",f=this.strokeMiterLimit?this.strokeMiterLimit:"4",l="undefined"!==typeof this.opacity?this.opacity:"1",k=this.visible?"":" visibility: hidden;";b=b?"":this.getSvgFilter();var m=e("fill",this.fill);return[e("stroke",this.stroke),"stroke-width: ",d,"; stroke-dasharray: ",a,"; stroke-linecap: ",g,"; stroke-linejoin: ",h,"; stroke-miterlimit: ",f,"; ",m,"fill-rule: ",c,"; opacity: ",l,";",b,k].join("")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgId:function(){return this.id?
'id="'+this.id+'" ':""},getSvgTransform:function(){if(this.group&&"path-group"===this.group.type)return"";var b=fabric.util.toFixed,c=this.getAngle(),d=this.getSkewX()%360,a=this.getSkewY()%360,e=this.getCenterPoint(),h=fabric.Object.NUM_FRACTION_DIGITS;e="path-group"===this.type?"":"translate("+b(e.x,h)+" "+b(e.y,h)+")";c=0!==c?" rotate("+b(c,h)+")":"";var f=1===this.scaleX&&1===this.scaleY?"":" scale("+b(this.scaleX,h)+" "+b(this.scaleY,h)+")";d=0!==d?" skewX("+b(d,h)+")":"";b=0!==a?" skewY("+b(a,
h)+")":"";a="path-group"===this.type?this.width:0;h="path-group"===this.type?this.height:0;return[e,c,f,this.flipX?" matrix(-1 0 0 1 "+a+" 0) ":"",this.flipY?" matrix(1 0 0 -1 0 "+h+")":"",d,b].join("")},getSvgTransformMatrix:function(){return this.transformMatrix?" matrix("+this.transformMatrix.join(" ")+") ":""},_createBaseSVGMarkup:function(){var b=[];this.fill&&this.fill.toLive&&b.push(this.fill.toSVG(this,!1));this.stroke&&this.stroke.toLive&&b.push(this.stroke.toSVG(this,!1));this.shadow&&b.push(this.shadow.toSVG(this));
return b}})})();
(function(){function e(b,a,e){var d={};e.forEach(function(a){d[a]=b[a]});c(b[a],d,!0)}function b(c,a,e){if(c===a)return!0;if(Array.isArray(c)){if(c.length!==a.length)return!1;e=0;for(var d=c.length;e<d;e++)if(!b(c[e],a[e]))return!1;return!0}if(c&&"object"===typeof c){var f=Object.keys(c);if(!e&&f.length!==Object.keys(a).length)return!1;e=0;for(d=f.length;e<d;e++){var g=f[e];if(!b(c[g],a[g]))return!1}return!0}}var c=fabric.util.object.extend;fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(c){c=
c||"stateProperties";var a="_"+c;return Object.keys(this[a]).length<this[c].length?!0:!b(this[a],this,!0)},saveState:function(b){var a=b&&b.propertySet||"stateProperties",c="_"+a;if(!this[c])return this.setupState(b);e(this,c,this[a]);b&&b.stateProperties&&e(this,c,b.stateProperties);return this},setupState:function(b){b=b||{};var a=b.propertySet||"stateProperties";b.propertySet=a;this["_"+a]={};this.saveState(b);return this}})})();
(function(){var e=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(b){if(!this.hasControls||!this.active)return!1;var c=b.x;b=b.y;this.__corner=0;for(var d in this.oCoords)if(this.isControlVisible(d)&&("mtr"!==d||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==d&&"mr"!==d&&"mb"!==d&&"ml"!==d)){var a=this._getImageLines(this.oCoords[d].corner);a=this._findCrossPoints({x:c,y:b},a);if(0!==a&&1===a%2)return this.__corner=
d}return!1},_setCornerCoords:function(){var b=this.oCoords,c=e(45-this.angle),d=.707106*this.cornerSize,a=d*Math.cos(c);c=d*Math.sin(c);var g;for(g in b){d=b[g].x;var h=b[g].y;b[g].corner={tl:{x:d-c,y:h-a},tr:{x:d+a,y:h-c},bl:{x:d-a,y:h+c},br:{x:d+c,y:h+a}}}},drawSelectionBackground:function(b){if(!this.selectionBackgroundColor||this.group||!this.active||this.canvas&&!this.canvas.interactive)return this;b.save();var c=this.getCenterPoint(),d=this._calculateCurrentDimensions(),a=this.canvas.viewportTransform;
b.translate(c.x,c.y);b.scale(1/a[0],1/a[3]);b.rotate(e(this.angle));b.fillStyle=this.selectionBackgroundColor;b.fillRect(-d.x/2,-d.y/2,d.x,d.y);b.restore();return this},drawBorders:function(b){if(!this.hasBorders)return this;var c=this._calculateCurrentDimensions(),d=1/this.borderScaleFactor,a=c.x+d;c=c.y+d;b.save();b.strokeStyle=this.borderColor;this._setLineDash(b,this.borderDashArray,null);b.strokeRect(-a/2,-c/2,a,c);this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&
this.hasControls&&(a=-c/2,b.beginPath(),b.moveTo(0,a),b.lineTo(0,a-this.rotatingPointOffset),b.closePath(),b.stroke());b.restore();return this},drawBordersInGroup:function(b,c){if(!this.hasBorders)return this;var d=this._getNonTransformedDimensions();c=fabric.util.customTransformMatrix(c.scaleX,c.scaleY,c.skewX);c=fabric.util.transformPoint(d,c);var a=1/this.borderScaleFactor;d=c.x+a;c=c.y+a;b.save();this._setLineDash(b,this.borderDashArray,null);b.strokeStyle=this.borderColor;b.strokeRect(-d/2,-c/
2,d,c);b.restore();return this},drawControls:function(b){if(!this.hasControls)return this;var c=this._calculateCurrentDimensions(),d=c.x;c=c.y;var a=this.cornerSize,e=-(d+a)/2;a=-(c+a)/2;var h=this.transparentCorners?"stroke":"fill";b.save();b.strokeStyle=b.fillStyle=this.cornerColor;this.transparentCorners||(b.strokeStyle=this.cornerStrokeColor);this._setLineDash(b,this.cornerDashArray,null);this._drawControl("tl",b,h,e,a);this._drawControl("tr",b,h,e+d,a);this._drawControl("bl",b,h,e,a+c);this._drawControl("br",
b,h,e+d,a+c);this.get("lockUniScaling")||(this._drawControl("mt",b,h,e+d/2,a),this._drawControl("mb",b,h,e+d/2,a+c),this._drawControl("mr",b,h,e+d,a+c/2),this._drawControl("ml",b,h,e,a+c/2));this.hasRotatingPoint&&this._drawControl("mtr",b,h,e+d/2,a-this.rotatingPointOffset);b.restore();return this},_drawControl:function(b,c,d,a,e){if(this.isControlVisible(b)){b=this.cornerSize;var g=!this.transparentCorners&&this.cornerStrokeColor;switch(this.cornerStyle){case "circle":c.beginPath();c.arc(a+b/2,
e+b/2,b/2,0,2*Math.PI,!1);c[d]();g&&c.stroke();break;default:"undefined"!==typeof G_vmlCanvasManager||this.transparentCorners||c.clearRect(a,e,b,b),c[d+"Rect"](a,e,b,b),g&&c.strokeRect(a,e,b,b)}}},isControlVisible:function(b){return this._getControlsVisibility()[b]},setControlVisible:function(b,c){this._getControlsVisibility()[b]=c;return this},setControlsVisibility:function(b){b||(b={});for(var c in b)this.setControlVisible(c,b[c]);return this},_getControlsVisibility:function(){this._controlsVisibility||
(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0});return this._controlsVisibility}})})();
fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(e,b){b=b||{};var c=function(){},d=b.onComplete||c,a=b.onChange||c,g=this;fabric.util.animate({startValue:e.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(b){e.set("left",b);g.renderAll();a()},onComplete:function(){e.setCoords();d()}});return this},fxCenterObjectV:function(e,b){b=b||{};var c=function(){},d=b.onComplete||c,a=b.onChange||c,g=this;fabric.util.animate({startValue:e.get("top"),
endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(b){e.set("top",b);g.renderAll();a()},onComplete:function(){e.setCoords();d()}});return this},fxRemove:function(e,b){b=b||{};var c=function(){},d=b.onComplete||c,a=b.onChange||c,g=this;fabric.util.animate({startValue:e.get("opacity"),endValue:0,duration:this.FX_DURATION,onStart:function(){e.set("active",!1)},onChange:function(b){e.set("opacity",b);g.renderAll();a()},onComplete:function(){g.remove(e);d()}});return this}});
fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&"object"===typeof arguments[0]){var e=[];for(d in arguments[0])e.push(d);for(var b=0,c=e.length;b<c;b++){var d=e[b];var a=b!==c-1;this._animate(d,arguments[0][d],arguments[1],a)}}else this._animate.apply(this,arguments);return this},_animate:function(e,b,c,d){var a=this,g;b=b.toString();c=c?fabric.util.object.clone(c):{};~e.indexOf(".")&&(g=e.split("."));var h=g?this.get(g[0])[g[1]]:this.get(e);"from"in c||(c.from=
h);b=~b.indexOf("=")?h+parseFloat(b.replace("=","")):parseFloat(b);fabric.util.animate({startValue:c.from,endValue:b,byValue:c.by,easing:c.easing,duration:c.duration,abort:c.abort&&function(){return c.abort.call(a)},onChange:function(b,h,k){g?a[g[0]][g[1]]=b:a.set(e,b);d||c.onChange&&c.onChange(b,h,k)},onComplete:function(b,e,g){d||(a.setCoords(),c.onComplete&&c.onComplete(b,e,g))}})}});
(function(e){function b(a,b){var c=a.origin,d=a.axis1,f=a.axis2,e=a.dimension,g=b.nearest,h=b.center,l=b.farthest;return function(){switch(this.get(c)){case g:return Math.min(this.get(d),this.get(f));case h:return Math.min(this.get(d),this.get(f))+.5*this.get(e);case l:return Math.max(this.get(d),this.get(f))}}}var c=e.fabric||(e.fabric={}),d=c.util.object.extend,a=c.util.object.clone,g={x1:1,x2:1,y1:1,y2:1},h=c.StaticCanvas.supports("setLineDash");c.Line?c.warn("fabric.Line is already defined"):
(c.Line=c.util.createClass(c.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:c.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(a,b){a||(a=[0,0,0,0]);this.callSuper("initialize",b);this.set("x1",a[0]);this.set("y1",a[1]);this.set("x2",a[2]);this.set("y2",a[3]);this._setWidthHeight(b)},_setWidthHeight:function(a){a||(a={});this.width=Math.abs(this.x2-this.x1);this.height=Math.abs(this.y2-this.y1);this.left="left"in a?a.left:this._getLeftToOriginX();this.top=
"top"in a?a.top:this._getTopToOriginY()},_set:function(a,b){this.callSuper("_set",a,b);"undefined"!==typeof g[a]&&this._setWidthHeight();return this},_getLeftToOriginX:b({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:b({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(a,b){a.beginPath();if(b){b=this.getCenterPoint();var c=this.strokeWidth/2;
a.translate(b.x-("butt"===this.strokeLineCap&&0===this.height?0:c),b.y-("butt"===this.strokeLineCap&&0===this.width?0:c))}if(!this.strokeDashArray||this.strokeDashArray&&h)b=this.calcLinePoints(),a.moveTo(b.x1,b.y1),a.lineTo(b.x2,b.y2);a.lineWidth=this.strokeWidth;b=a.strokeStyle;a.strokeStyle=this.stroke||a.fillStyle;this.stroke&&this._renderStroke(a);a.strokeStyle=b},_renderDashedStroke:function(a){var b=this.calcLinePoints();a.beginPath();c.util.drawDashedLine(a,b.x1,b.y1,b.x2,b.y2,this.strokeDashArray);
a.closePath()},toObject:function(a){return d(this.callSuper("toObject",a),this.calcLinePoints())},_getNonTransformedDimensions:function(){var a=this.callSuper("_getNonTransformedDimensions");"butt"===this.strokeLineCap&&(0===this.width&&(a.y-=this.strokeWidth),0===this.height&&(a.x-=this.strokeWidth));return a},calcLinePoints:function(){var a=this.x1<=this.x2?-1:1,b=this.y1<=this.y2?-1:1;return{x1:a*this.width*.5,x2:a*this.width*-.5,y1:b*this.height*.5,y2:b*this.height*-.5}},toSVG:function(a){var b=
this._createBaseSVGMarkup(),c={x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};this.group&&"path-group"===this.group.type||(c=this.calcLinePoints());b.push("<line ",this.getSvgId(),'x1="',c.x1,'" y1="',c.y1,'" x2="',c.x2,'" y2="',c.y2,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return a?a(b.join("")):b.join("")}}),c.Line.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat(["x1","y1","x2","y2"]),c.Line.fromElement=function(a,b){b=b||{};a=c.parseAttributes(a,
c.Line.ATTRIBUTE_NAMES);var f=[a.x1||0,a.y1||0,a.x2||0,a.y2||0];b.originX="left";b.originY="top";return new c.Line(f,d(a,b))},c.Line.fromObject=function(b,d,e){var f=a(b,!0);f.points=[b.x1,b.y1,b.x2,b.y2];(b=c.Object._fromObject("Line",f,function(a){delete a.points;d&&d(a)},e,"points"))&&delete b.points;return b})})("undefined"!==typeof exports?exports:this);
(function(e){var b=e.fabric||(e.fabric={}),c=Math.PI,d=b.util.object.extend;b.Circle?b.warn("fabric.Circle is already defined."):(b.Circle=b.util.createClass(b.Object,{type:"circle",radius:0,startAngle:0,endAngle:2*c,cacheProperties:b.Object.prototype.cacheProperties.concat("radius"),initialize:function(a){this.callSuper("initialize",a);this.set("radius",a&&a.radius||0)},_set:function(a,b){this.callSuper("_set",a,b);"radius"===a&&this.setRadius(b);return this},toObject:function(a){return this.callSuper("toObject",
["radius","startAngle","endAngle"].concat(a))},toSVG:function(a){var b=this._createBaseSVGMarkup(),d=0,f=0,e=(this.endAngle-this.startAngle)%(2*c);0===e?(this.group&&"path-group"===this.group.type&&(d=this.left+this.radius,f=this.top+this.radius),b.push("<circle ",this.getSvgId(),'cx="'+d+'" cy="'+f+'" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n')):b.push('<path d="M '+Math.cos(this.startAngle)*this.radius+" "+
Math.sin(this.startAngle)*this.radius," A "+this.radius+" "+this.radius," 0 ",+(e>c?1:0)+" 1"," "+Math.cos(this.endAngle)*this.radius+" "+Math.sin(this.endAngle)*this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n');return a?a(b.join("")):b.join("")},_render:function(a,b){a.beginPath();a.arc(b?this.left+this.radius:0,b?this.top+this.radius:0,this.radius,this.startAngle,this.endAngle,!1);this._renderFill(a);this._renderStroke(a)},
getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(a){this.radius=a;return this.set("width",2*a).set("height",2*a)}}),b.Circle.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat(["cx","cy","r"]),b.Circle.fromElement=function(a,c){c||(c={});a=b.parseAttributes(a,b.Circle.ATTRIBUTE_NAMES);if(!("radius"in a&&0<=a.radius))throw Error("value of `r` attribute is required and can not be negative");a.left=a.left||
0;a.top=a.top||0;c=new b.Circle(d(a,c));c.left-=c.radius;c.top-=c.radius;return c},b.Circle.fromObject=function(a,c,d){return b.Object._fromObject("Circle",a,c,d)})})("undefined"!==typeof exports?exports:this);
(function(e){var b=e.fabric||(e.fabric={});b.Triangle?b.warn("fabric.Triangle is already defined"):(b.Triangle=b.util.createClass(b.Object,{type:"triangle",initialize:function(b){this.callSuper("initialize",b);this.set("width",b&&b.width||100).set("height",b&&b.height||100)},_render:function(b){var c=this.width/2,a=this.height/2;b.beginPath();b.moveTo(-c,a);b.lineTo(0,-a);b.lineTo(c,a);b.closePath();this._renderFill(b);this._renderStroke(b)},_renderDashedStroke:function(c){var d=this.width/2,a=this.height/
2;c.beginPath();b.util.drawDashedLine(c,-d,a,0,-a,this.strokeDashArray);b.util.drawDashedLine(c,0,-a,d,a,this.strokeDashArray);b.util.drawDashedLine(c,d,a,-d,a,this.strokeDashArray);c.closePath()},toSVG:function(b){var c=this._createBaseSVGMarkup(),a=this.width/2,e=this.height/2;a=[-a+" "+e,"0 "+-e,a+" "+e].join();c.push("<polygon ",this.getSvgId(),'points="',a,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return b?b(c.join("")):c.join("")}}),b.Triangle.fromObject=
function(c,d,a){return b.Object._fromObject("Triangle",c,d,a)})})("undefined"!==typeof exports?exports:this);
(function(e){var b=e.fabric||(e.fabric={}),c=2*Math.PI,d=b.util.object.extend;b.Ellipse?b.warn("fabric.Ellipse is already defined."):(b.Ellipse=b.util.createClass(b.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:b.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(a){this.callSuper("initialize",a);this.set("rx",a&&a.rx||0);this.set("ry",a&&a.ry||0)},_set:function(a,b){this.callSuper("_set",a,b);switch(a){case "rx":this.rx=b;this.set("width",2*b);break;case "ry":this.ry=b,this.set("height",
2*b)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(a){return this.callSuper("toObject",["rx","ry"].concat(a))},toSVG:function(a){var b=this._createBaseSVGMarkup(),c=0,d=0;this.group&&"path-group"===this.group.type&&(c=this.left+this.rx,d=this.top+this.ry);b.push("<ellipse ",this.getSvgId(),'cx="',c,'" cy="',d,'" ','rx="',this.rx,'" ry="',this.ry,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),
this.getSvgTransformMatrix(),'"/>\n');return a?a(b.join("")):b.join("")},_render:function(a,b){a.beginPath();a.save();a.transform(1,0,0,this.ry/this.rx,0,0);a.arc(b?this.left+this.rx:0,b?(this.top+this.ry)*this.rx/this.ry:0,this.rx,0,c,!1);a.restore();this._renderFill(a);this._renderStroke(a)}}),b.Ellipse.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat(["cx","cy","rx","ry"]),b.Ellipse.fromElement=function(a,c){c||(c={});a=b.parseAttributes(a,b.Ellipse.ATTRIBUTE_NAMES);a.left=a.left||0;a.top=a.top||0;c=
new b.Ellipse(d(a,c));c.top-=c.ry;c.left-=c.rx;return c},b.Ellipse.fromObject=function(a,c,d){return b.Object._fromObject("Ellipse",a,c,d)})})("undefined"!==typeof exports?exports:this);
(function(e){var b=e.fabric||(e.fabric={}),c=b.util.object.extend;b.Rect?b.warn("fabric.Rect is already defined"):(b.Rect=b.util.createClass(b.Object,{stateProperties:b.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:b.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(b){this.callSuper("initialize",b);this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(b,a){if(1===
this.width&&1===this.height)b.fillRect(-.5,-.5,1,1);else{var c=this.rx?Math.min(this.rx,this.width/2):0,d=this.ry?Math.min(this.ry,this.height/2):0,f=this.width,e=this.height,k=a?this.left:-this.width/2;a=a?this.top:-this.height/2;var m=0!==c||0!==d;b.beginPath();b.moveTo(k+c,a);b.lineTo(k+f-c,a);m&&b.bezierCurveTo(k+f-.4477152502*c,a,k+f,a+.4477152502*d,k+f,a+d);b.lineTo(k+f,a+e-d);m&&b.bezierCurveTo(k+f,a+e-.4477152502*d,k+f-.4477152502*c,a+e,k+f-c,a+e);b.lineTo(k+c,a+e);m&&b.bezierCurveTo(k+.4477152502*
c,a+e,k,a+e-.4477152502*d,k,a+e-d);b.lineTo(k,a+d);m&&b.bezierCurveTo(k,a+.4477152502*d,k+.4477152502*c,a,k+c,a);b.closePath();this._renderFill(b);this._renderStroke(b)}},_renderDashedStroke:function(c){var a=-this.width/2,d=-this.height/2,e=this.width,f=this.height;c.beginPath();b.util.drawDashedLine(c,a,d,a+e,d,this.strokeDashArray);b.util.drawDashedLine(c,a+e,d,a+e,d+f,this.strokeDashArray);b.util.drawDashedLine(c,a+e,d+f,a,d+f,this.strokeDashArray);b.util.drawDashedLine(c,a,d+f,a,d,this.strokeDashArray);
c.closePath()},toObject:function(b){return this.callSuper("toObject",["rx","ry"].concat(b))},toSVG:function(b){var a=this._createBaseSVGMarkup(),c=this.left,d=this.top;this.group&&"path-group"===this.group.type||(c=-this.width/2,d=-this.height/2);a.push("<rect ",this.getSvgId(),'x="',c,'" y="',d,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');
return b?b(a.join("")):a.join("")}}),b.Rect.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),b.Rect.fromElement=function(d,a){if(!d)return null;a=a||{};d=b.parseAttributes(d,b.Rect.ATTRIBUTE_NAMES);d.left=d.left||0;d.top=d.top||0;a=new b.Rect(c(a?b.util.object.clone(a):{},d));a.visible=a.visible&&0<a.width&&0<a.height;return a},b.Rect.fromObject=function(c,a,e){return b.Object._fromObject("Rect",c,a,e)})})("undefined"!==typeof exports?exports:this);
(function(e){var b=e.fabric||(e.fabric={}),c=b.util.object.extend,d=b.util.array.min,a=b.util.array.max,g=b.util.toFixed,h=b.Object.NUM_FRACTION_DIGITS;b.Polyline?b.warn("fabric.Polyline is already defined"):(b.Polyline=b.util.createClass(b.Object,{type:"polyline",points:null,minX:0,minY:0,cacheProperties:b.Object.prototype.cacheProperties.concat("points"),initialize:function(a,b){b=b||{};this.points=a||[];this.callSuper("initialize",b);this._calcDimensions();"top"in b||(this.top=this.minY);"left"in
b||(this.left=this.minX);this.pathOffset={x:this.minX+this.width/2,y:this.minY+this.height/2}},_calcDimensions:function(){var b=this.points,c=d(b,"x"),e=d(b,"y"),g=a(b,"x");b=a(b,"y");this.width=g-c||0;this.height=b-e||0;this.minX=c||0;this.minY=e||0},toObject:function(a){return c(this.callSuper("toObject",a),{points:this.points.concat()})},toSVG:function(a){var b=[],c=0,d=0,f=this._createBaseSVGMarkup();this.group&&"path-group"===this.group.type||(c=this.pathOffset.x,d=this.pathOffset.y);for(var e=
0,q=this.points.length;e<q;e++)b.push(g(this.points[e].x-c,h),",",g(this.points[e].y-d,h)," ");f.push("<",this.type," ",this.getSvgId(),'points="',b.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n');return a?a(f.join("")):f.join("")},commonRender:function(a,b){var c=this.points.length,d=b?0:this.pathOffset.x,f=b?0:this.pathOffset.y;if(!c||isNaN(this.points[c-1].y))return!1;a.beginPath();a.moveTo(this.points[0].x-d,this.points[0].y-
f);for(var e=0;e<c;e++)b=this.points[e],a.lineTo(b.x-d,b.y-f);return!0},_render:function(a,b){this.commonRender(a,b)&&(this._renderFill(a),this._renderStroke(a))},_renderDashedStroke:function(a){a.beginPath();for(var c=0,d=this.points.length;c<d;c++){var e=this.points[c];var f=this.points[c+1]||e;b.util.drawDashedLine(a,e.x,e.y,f.x,f.y,this.strokeDashArray)}},complexity:function(){return this.get("points").length}}),b.Polyline.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat(),b.Polyline.fromElement=function(a,
c){if(!a)return null;c||(c={});var d=b.parsePointsAttribute(a.getAttribute("points"));a=b.parseAttributes(a,b.Polyline.ATTRIBUTE_NAMES);return new b.Polyline(d,b.util.object.extend(a,c))},b.Polyline.fromObject=function(a,c,d){return b.Object._fromObject("Polyline",a,c,d,"points")})})("undefined"!==typeof exports?exports:this);
(function(e){var b=e.fabric||(e.fabric={}),c=b.util.object.extend;b.Polygon?b.warn("fabric.Polygon is already defined"):(b.Polygon=b.util.createClass(b.Polyline,{type:"polygon",_render:function(b,a){this.commonRender(b,a)&&(b.closePath(),this._renderFill(b),this._renderStroke(b))},_renderDashedStroke:function(b){this.callSuper("_renderDashedStroke",b);b.closePath()}}),b.Polygon.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat(),b.Polygon.fromElement=function(d,a){if(!d)return null;a||(a={});var e=b.parsePointsAttribute(d.getAttribute("points"));
d=b.parseAttributes(d,b.Polygon.ATTRIBUTE_NAMES);return new b.Polygon(e,c(d,a))},b.Polygon.fromObject=function(c,a,e){return b.Object._fromObject("Polygon",c,a,e,"points")})})("undefined"!==typeof exports?exports:this);
(function(e){var b=e.fabric||(e.fabric={}),c=b.util.array.min,d=b.util.array.max,a=b.util.object.extend,g=Object.prototype.toString,h=b.util.drawArc,f={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},l={m:"l",M:"L"};b.Path?b.warn("fabric.Path is already defined"):(b.Path=b.util.createClass(b.Object,{type:"path",path:null,minX:0,minY:0,cacheProperties:b.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:b.Object.prototype.stateProperties.concat("path"),initialize:function(a,b){b=b||{};
this.callSuper("initialize",b);a||(a=[]);var c="[object Array]"===g.call(a);if(this.path=c?a:a.match&&a.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi))c||(this.path=this._parsePath()),this._setPositionDimensions(b)},_setPositionDimensions:function(a){var b=this._parseDimensions();this.minX=b.left;this.minY=b.top;this.width=b.width;this.height=b.height;"undefined"===typeof a.left&&(this.left=b.left+("center"===this.originX?this.width/2:"right"===this.originX?this.width:0));"undefined"===typeof a.top&&(this.top=
b.top+("center"===this.originY?this.height/2:"bottom"===this.originY?this.height:0));this.pathOffset=this.pathOffset||{x:this.minX+this.width/2,y:this.minY+this.height/2}},_renderPathCommands:function(a){var b=null,c=0,d=0,e=0,f=0,g=0,l=0,k=-this.pathOffset.x,v=-this.pathOffset.y;this.group&&"path-group"===this.group.type&&(v=k=0);a.beginPath();for(var A=0,D=this.path.length;A<D;++A){var u=this.path[A];switch(u[0]){case "l":e+=u[1];f+=u[2];a.lineTo(e+k,f+v);break;case "L":e=u[1];f=u[2];a.lineTo(e+
k,f+v);break;case "h":e+=u[1];a.lineTo(e+k,f+v);break;case "H":e=u[1];a.lineTo(e+k,f+v);break;case "v":f+=u[1];a.lineTo(e+k,f+v);break;case "V":f=u[1];a.lineTo(e+k,f+v);break;case "m":e+=u[1];f+=u[2];c=e;d=f;a.moveTo(e+k,f+v);break;case "M":e=u[1];f=u[2];c=e;d=f;a.moveTo(e+k,f+v);break;case "c":var y=e+u[5];var x=f+u[6];g=e+u[3];l=f+u[4];a.bezierCurveTo(e+u[1]+k,f+u[2]+v,g+k,l+v,y+k,x+v);e=y;f=x;break;case "C":e=u[5];f=u[6];g=u[3];l=u[4];a.bezierCurveTo(u[1]+k,u[2]+v,g+k,l+v,e+k,f+v);break;case "s":y=
e+u[3];x=f+u[4];null===b[0].match(/[CcSs]/)?(g=e,l=f):(g=2*e-g,l=2*f-l);a.bezierCurveTo(g+k,l+v,e+u[1]+k,f+u[2]+v,y+k,x+v);g=e+u[1];l=f+u[2];e=y;f=x;break;case "S":y=u[3];x=u[4];null===b[0].match(/[CcSs]/)?(g=e,l=f):(g=2*e-g,l=2*f-l);a.bezierCurveTo(g+k,l+v,u[1]+k,u[2]+v,y+k,x+v);e=y;f=x;g=u[1];l=u[2];break;case "q":y=e+u[3];x=f+u[4];g=e+u[1];l=f+u[2];a.quadraticCurveTo(g+k,l+v,y+k,x+v);e=y;f=x;break;case "Q":y=u[3];x=u[4];a.quadraticCurveTo(u[1]+k,u[2]+v,y+k,x+v);e=y;f=x;g=u[1];l=u[2];break;case "t":y=
e+u[1];x=f+u[2];null===b[0].match(/[QqTt]/)?(g=e,l=f):(g=2*e-g,l=2*f-l);a.quadraticCurveTo(g+k,l+v,y+k,x+v);e=y;f=x;break;case "T":y=u[1];x=u[2];null===b[0].match(/[QqTt]/)?(g=e,l=f):(g=2*e-g,l=2*f-l);a.quadraticCurveTo(g+k,l+v,y+k,x+v);e=y;f=x;break;case "a":h(a,e+k,f+v,[u[1],u[2],u[3],u[4],u[5],u[6]+e+k,u[7]+f+v]);e+=u[6];f+=u[7];break;case "A":h(a,e+k,f+v,[u[1],u[2],u[3],u[4],u[5],u[6]+k,u[7]+v]);e=u[6];f=u[7];break;case "z":case "Z":e=c,f=d,a.closePath()}b=u}},_render:function(a){this._renderPathCommands(a);
this._renderFill(a);this._renderStroke(a)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(b){return a(this.callSuper("toObject",["sourcePath","pathOffset"].concat(b)),{path:this.path.map(function(a){return a.slice()}),top:this.top,left:this.left})},toDatalessObject:function(a){a=this.toObject(a);this.sourcePath&&(a.path=this.sourcePath);delete a.sourcePath;return a},toSVG:function(a){for(var b=[],c=this._createBaseSVGMarkup(),
d="",e=0,f=this.path.length;e<f;e++)b.push(this.path[e].join(" "));b=b.join(" ");this.group&&"path-group"===this.group.type||(d=" translate("+-this.pathOffset.x+", "+-this.pathOffset.y+") ");c.push("<path ",this.getSvgId(),'d="',b,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),d,this.getSvgTransformMatrix(),'" stroke-linecap="round" ',"/>\n");return a?a(c.join("")):c.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var a=[],b=[],c,d,e=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/ig,
g,h=0,w=this.path.length;h<w;h++){c=this.path[h];g=c.slice(1).trim();for(b.length=0;d=e.exec(g);)b.push(d[0]);c=[c.charAt(0)];g=0;for(var z=b.length;g<z;g++)d=parseFloat(b[g]),isNaN(d)||c.push(d);d=c[0];g=f[d.toLowerCase()];z=l[d]||d;if(c.length-1>g)for(var v=1,A=c.length;v<A;v+=g)a.push([d].concat(c.slice(v,v+g))),d=z;else a.push(c)}return a},_parseDimensions:function(){for(var a=[],e=[],f,g=null,h=0,l=0,r=0,w=0,z=0,v=0,A,D,u,y=0,x=this.path.length;y<x;++y){f=this.path[y];switch(f[0]){case "l":r+=
f[1];w+=f[2];u=[];break;case "L":r=f[1];w=f[2];u=[];break;case "h":r+=f[1];u=[];break;case "H":r=f[1];u=[];break;case "v":w+=f[1];u=[];break;case "V":w=f[1];u=[];break;case "m":r+=f[1];w+=f[2];h=r;l=w;u=[];break;case "M":r=f[1];w=f[2];h=r;l=w;u=[];break;case "c":A=r+f[5];D=w+f[6];z=r+f[3];v=w+f[4];u=b.util.getBoundsOfCurve(r,w,r+f[1],w+f[2],z,v,A,D);r=A;w=D;break;case "C":z=f[3];v=f[4];u=b.util.getBoundsOfCurve(r,w,f[1],f[2],z,v,f[5],f[6]);r=f[5];w=f[6];break;case "s":A=r+f[3];D=w+f[4];null===g[0].match(/[CcSs]/)?
(z=r,v=w):(z=2*r-z,v=2*w-v);u=b.util.getBoundsOfCurve(r,w,z,v,r+f[1],w+f[2],A,D);z=r+f[1];v=w+f[2];r=A;w=D;break;case "S":A=f[3];D=f[4];null===g[0].match(/[CcSs]/)?(z=r,v=w):(z=2*r-z,v=2*w-v);u=b.util.getBoundsOfCurve(r,w,z,v,f[1],f[2],A,D);r=A;w=D;z=f[1];v=f[2];break;case "q":A=r+f[3];D=w+f[4];z=r+f[1];v=w+f[2];u=b.util.getBoundsOfCurve(r,w,z,v,z,v,A,D);r=A;w=D;break;case "Q":z=f[1];v=f[2];u=b.util.getBoundsOfCurve(r,w,z,v,z,v,f[3],f[4]);r=f[3];w=f[4];break;case "t":A=r+f[1];D=w+f[2];null===g[0].match(/[QqTt]/)?
(z=r,v=w):(z=2*r-z,v=2*w-v);u=b.util.getBoundsOfCurve(r,w,z,v,z,v,A,D);r=A;w=D;break;case "T":A=f[1];D=f[2];null===g[0].match(/[QqTt]/)?(z=r,v=w):(z=2*r-z,v=2*w-v);u=b.util.getBoundsOfCurve(r,w,z,v,z,v,A,D);r=A;w=D;break;case "a":u=b.util.getBoundsOfArc(r,w,f[1],f[2],f[3],f[4],f[5],f[6]+r,f[7]+w);r+=f[6];w+=f[7];break;case "A":u=b.util.getBoundsOfArc(r,w,f[1],f[2],f[3],f[4],f[5],f[6],f[7]);r=f[6];w=f[7];break;case "z":case "Z":r=h,w=l}g=f;u.forEach(function(b){a.push(b.x);e.push(b.y)});a.push(r);
e.push(w)}f=c(a)||0;g=c(e)||0;h=d(a)||0;l=d(e)||0;return{left:f,top:g,width:h-f,height:l-g}}}),b.Path.fromObject=function(a,c,d){var f;if("string"===typeof a.path)b.loadSVGFromURL(a.path,function(b){var d=a.path;f=b[0];delete a.path;f.setOptions(a);f.setSourcePath(d);c&&c(f)});else return b.Object._fromObject("Path",a,c,d,"path")},b.Path.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat(["d"]),b.Path.fromElement=function(c,d,f){c=b.parseAttributes(c,b.Path.ATTRIBUTE_NAMES);d&&d(new b.Path(c.d,a(c,f)))},
b.Path.async=!0)})("undefined"!==typeof exports?exports:this);
(function(e){var b=e.fabric||(e.fabric={}),c=b.util.object.extend;b.PathGroup?b.warn("fabric.PathGroup is already defined"):(b.PathGroup=b.util.createClass(b.Object,{type:"path-group",fill:"",cacheProperties:[],initialize:function(b,a){a=a||{};this.paths=b||[];for(b=this.paths.length;b--;)this.paths[b].group=this;a.toBeParsed&&(this.parseDimensionsFromPaths(a),delete a.toBeParsed);this.setOptions(a);this.setCoords()},parseDimensionsFromPaths:function(c){for(var a,d,e=[],f=[],l,k=this.paths.length;k--;){a=
this.paths[k];d=a.height+a.strokeWidth;l=a.width+a.strokeWidth;a=[{x:a.left,y:a.top},{x:a.left+l,y:a.top},{x:a.left,y:a.top+d},{x:a.left+l,y:a.top+d}];l=this.paths[k].transformMatrix;for(var m=0;m<a.length;m++)d=a[m],l&&(d=b.util.transformPoint(d,l,!1)),e.push(d.x),f.push(d.y)}c.width=Math.max.apply(null,e);c.height=Math.max.apply(null,f)},drawObject:function(b){b.save();b.translate(-this.width/2,-this.height/2);for(var a=0,c=this.paths.length;a<c;++a)this.paths[a].render(b,!0);b.restore()},shouldCache:function(){var b=
this.objectCaching&&(!this.group||this.needsItsOwnCache()||!this.group.isCaching());if(this.caching=b)for(var a=0,c=this.paths.length;a<c;a++)if(this.paths[a].willDrawShadow())return this.caching=!1;return b},willDrawShadow:function(){if(this.shadow)return!0;for(var b=0,a=this.paths.length;b<a;b++)if(this.paths[b].willDrawShadow())return!0;return!1},isCaching:function(){return this.caching||this.group&&this.group.isCaching()},isCacheDirty:function(){if(this.callSuper("isCacheDirty"))return!0;if(!this.statefullCache)return!1;
for(var b=0,a=this.paths.length;b<a;b++)if(this.paths[b].isCacheDirty(!0))return this._cacheCanvas&&(b=this.cacheWidth/this.zoomX,a=this.cacheHeight/this.zoomY,this._cacheContext.clearRect(-b/2,-a/2,b,a)),!0;return!1},_set:function(b,a){if("fill"===b&&a&&this.isSameColor())for(var c=this.paths.length;c--;)this.paths[c]._set(b,a);return this.callSuper("_set",b,a)},toObject:function(b){var a=this.paths.map(function(a){var c=a.includeDefaultValues;a.includeDefaultValues=a.group.includeDefaultValues;
var d=a.toObject(b);a.includeDefaultValues=c;return d});return c(this.callSuper("toObject",["sourcePath"].concat(b)),{paths:a})},toDatalessObject:function(b){b=this.toObject(b);this.sourcePath&&(b.paths=this.sourcePath);return b},toSVG:function(b){var a=this.getObjects(),c=this.getPointByOrigin("left","top"),d="translate("+c.x+" "+c.y+")";c=this._createBaseSVGMarkup();c.push("<g ",this.getSvgId(),'style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransformMatrix(),d,this.getSvgTransform(),
'" ',">\n");d=0;for(var f=a.length;d<f;d++)c.push("\t",a[d].toSVG(b));c.push("</g>\n");return b?b(c.join("")):c.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var b=this.getObjects()[0].get("fill")||"";if("string"!==typeof b)return!1;b=b.toLowerCase();return this.getObjects().every(function(a){a=a.get("fill")||"";return"string"===typeof a&&a.toLowerCase()===b})},complexity:function(){return this.paths.reduce(function(b,
a){return b+(a&&a.complexity?a.complexity():0)},0)},getObjects:function(){return this.paths}}),b.PathGroup.fromObject=function(c,a){var d=c.paths;delete c.paths;"string"===typeof d?b.loadSVGFromURL(d,function(e){e=b.util.groupSVGElements(e,c,d);c.paths=d;a(e)}):b.util.enlivenObjects(d,function(e){e=new b.PathGroup(e,c);c.paths=d;a(e)})},b.PathGroup.async=!0)})("undefined"!==typeof exports?exports:this);
(function(e){var b=e.fabric||(e.fabric={}),c=b.util.object.extend,d=b.util.array.min,a=b.util.array.max;if(!b.Group){var g={lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0};b.Group=b.util.createClass(b.Object,b.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],initialize:function(a,b,c){b=b||{};this._objects=[];c&&this.callSuper("initialize",b);this._objects=a||[];for(a=this._objects.length;a--;)this._objects[a].group=this;
b.originX&&(this.originX=b.originX);b.originY&&(this.originY=b.originY);c?(this._updateObjectsCoords(!0),this._updateObjectsACoords()):(this._calcBounds(),this._updateObjectsCoords(),this.callSuper("initialize",b));this.setCoords();this.saveCoords()},_updateObjectsACoords:function(){for(var a=this._objects.length;a--;)this._objects[a].setCoords(!0,!0)},_updateObjectsCoords:function(a){for(var b=this.getCenterPoint(),c=this._objects.length;c--;)this._updateObjectCoords(this._objects[c],b,a)},_updateObjectCoords:function(a,
b,c){a.__origHasControls=a.hasControls;a.hasControls=!1;if(!c){c=a.getLeft();var d=a.getTop();a.set({left:c-b.x,top:d-b.y});a.setCoords(!0,!0)}},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(a){this._restoreObjectsState();b.util.resetObjectTransform(this);a&&(this._objects.push(a),a.group=this,a._set("canvas",this.canvas));this.forEachObject(this._setObjectActive,this);this._calcBounds();this._updateObjectsCoords();this.setCoords();this.dirty=!0;return this},
_setObjectActive:function(a){a.set("active",!0);a.group=this},removeWithUpdate:function(a){this._restoreObjectsState();b.util.resetObjectTransform(this);this.forEachObject(this._setObjectActive,this);this.remove(a);this._calcBounds();this._updateObjectsCoords();this.setCoords();this.dirty=!0;return this},_onObjectAdded:function(a){this.dirty=!0;a.group=this;a._set("canvas",this.canvas)},_onObjectRemoved:function(a){this.dirty=!0;delete a.group;a.set("active",!1)},delegatedProperties:{fill:!0,stroke:!0,
strokeWidth:!0,fontFamily:!0,fontWeight:!0,fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,textAlign:!0,backgroundColor:!0},_set:function(a,b){var c=this._objects.length;if(this.delegatedProperties[a]||"canvas"===a)for(;c--;)this._objects[c].set(a,b);else for(;c--;)this._objects[c].setOnGroup(a,b);this.callSuper("_set",a,b)},toObject:function(a){var b=this.getObjects().map(function(b){var c=b.includeDefaultValues;b.includeDefaultValues=b.group.includeDefaultValues;var d=b.toObject(a);b.includeDefaultValues=
c;return d});return c(this.callSuper("toObject",a),{objects:b})},toDatalessObject:function(a){var b=this.getObjects().map(function(b){var c=b.includeDefaultValues;b.includeDefaultValues=b.group.includeDefaultValues;var d=b.toDatalessObject(a);b.includeDefaultValues=c;return d});return c(this.callSuper("toDatalessObject",a),{objects:b})},render:function(a){this._transformDone=!0;this.callSuper("render",a);this._transformDone=!1},shouldCache:function(){var a=this.objectCaching&&(!this.group||this.needsItsOwnCache()||
!this.group.isCaching());if(this.caching=a)for(var b=0,c=this._objects.length;b<c;b++)if(this._objects[b].willDrawShadow())return this.caching=!1;return a},willDrawShadow:function(){if(this.callSuper("willDrawShadow"))return!0;for(var a=0,b=this._objects.length;a<b;a++)if(this._objects[a].willDrawShadow())return!0;return!1},isCaching:function(){return this.caching||this.group&&this.group.isCaching()},drawObject:function(a){for(var b=0,c=this._objects.length;b<c;b++)this._renderObject(this._objects[b],
a)},isCacheDirty:function(){if(this.callSuper("isCacheDirty"))return!0;if(!this.statefullCache)return!1;for(var a=0,b=this._objects.length;a<b;a++)if(this._objects[a].isCacheDirty(!0))return this._cacheCanvas&&(a=this.cacheWidth/this.zoomX,b=this.cacheHeight/this.zoomY,this._cacheContext.clearRect(-a/2,-b/2,a,b)),!0;return!1},_renderControls:function(a,b){a.save();a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;this.callSuper("_renderControls",a,b);b=0;for(var c=this._objects.length;b<
c;b++)this._objects[b]._renderControls(a);a.restore()},_renderObject:function(a,b){if(a.visible){var c=a.hasRotatingPoint;a.hasRotatingPoint=!1;a.render(b);a.hasRotatingPoint=c}},_restoreObjectsState:function(){this._objects.forEach(this._restoreObjectState,this);return this},realizeTransform:function(a){var c=a.calcTransformMatrix();c=b.util.qrDecompose(c);var d=new b.Point(c.translateX,c.translateY);a.flipX=!1;a.flipY=!1;a.set("scaleX",c.scaleX);a.set("scaleY",c.scaleY);a.skewX=c.skewX;a.skewY=
c.skewY;a.angle=c.angle;a.setPositionByOrigin(d,"center","center");return a},_restoreObjectState:function(a){this.realizeTransform(a);a.setCoords();a.hasControls=a.__origHasControls;delete a.__origHasControls;a.set("active",!1);delete a.group;return this},destroy:function(){this._objects.forEach(function(a){a.set("dirty",!0)});return this._restoreObjectsState()},saveCoords:function(){this._originalLeft=this.get("left");this._originalTop=this.get("top");return this},hasMoved:function(){return this._originalLeft!==
this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){this.forEachObject(function(a){a.setCoords(!0,!0)});return this},_calcBounds:function(a){for(var b=[],c=[],d,e,g=["tr","br","bl","tl"],h=0,q=this._objects.length,t,r=g.length;h<q;++h)for(d=this._objects[h],d.setCoords(!0),t=0;t<r;t++)e=g[t],b.push(d.oCoords[e].x),c.push(d.oCoords[e].y);this.set(this._getBounds(b,c,a))},_getBounds:function(c,e,g){var f=new b.Point(d(c),d(e));c=new b.Point(a(c),a(e));c={width:c.x-f.x||
0,height:c.y-f.y||0};g||(c.left=f.x||0,c.top=f.y||0,"center"===this.originX&&(c.left+=c.width/2),"right"===this.originX&&(c.left+=c.width),"center"===this.originY&&(c.top+=c.height/2),"bottom"===this.originY&&(c.top+=c.height));return c},toSVG:function(a){var b=this._createBaseSVGMarkup();b.push("<g ",this.getSvgId(),'transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'" style="',this.getSvgFilter(),'">\n');for(var c=0,d=this._objects.length;c<d;c++)b.push("\t",this._objects[c].toSVG(a));
b.push("</g>\n");return a?a(b.join("")):b.join("")},get:function(a){if(a in g){if(this[a])return this[a];for(var b=0,c=this._objects.length;b<c;b++)if(this._objects[b][a])return!0;return!1}return a in this.delegatedProperties?this._objects[0]&&this._objects[0].get(a):this[a]}});b.Group.fromObject=function(a,c){b.util.enlivenObjects(a.objects,function(d){var e=b.util.object.clone(a,!0);delete e.objects;c&&c(new b.Group(d,e,!0))})};b.Group.async=!0}})("undefined"!==typeof exports?exports:this);
(function(e){var b=fabric.util.object.extend;e.fabric||(e.fabric={});e.fabric.Image?fabric.warn("fabric.Image is already defined."):(fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",alignX:"none",alignY:"none",meetOrSlice:"meet",strokeWidth:0,_lastScaleX:1,_lastScaleY:1,minimumScaleTrigger:.5,stateProperties:fabric.Object.prototype.stateProperties.concat("alignX","alignY","meetOrSlice"),objectCaching:!1,initialize:function(b,d,a){d||(d={});this.filters=[];this.resizeFilters=
[];this.callSuper("initialize",d);this._initElement(b,d,a)},getElement:function(){return this._element},setElement:function(b,d,a){this._originalElement=this._element=b;this._initConfig(a);if(0===this.resizeFilters.length)b=d;else{var c=this;b=function(){c.applyFilters(d,c.resizeFilters,c._filteredEl||c._originalElement,!0)}}0!==this.filters.length?this.applyFilters(b):b&&b(this);return this},setCrossOrigin:function(b){this.crossOrigin=b;this._element.crossOrigin=b;return this},getOriginalSize:function(){var b=
this.getElement();return{width:b.width,height:b.height}},_stroke:function(b){if(this.stroke&&0!==this.strokeWidth){var c=this.width/2,a=this.height/2;b.beginPath();b.moveTo(-c,-a);b.lineTo(c,-a);b.lineTo(c,a);b.lineTo(-c,a);b.lineTo(-c,-a);b.closePath()}},_renderDashedStroke:function(b){var c=-this.width/2,a=-this.height/2,e=this.width,h=this.height;b.save();this._setStrokeStyles(b);b.beginPath();fabric.util.drawDashedLine(b,c,a,c+e,a,this.strokeDashArray);fabric.util.drawDashedLine(b,c+e,a,c+e,a+
h,this.strokeDashArray);fabric.util.drawDashedLine(b,c+e,a+h,c,a+h,this.strokeDashArray);fabric.util.drawDashedLine(b,c,a+h,c,a,this.strokeDashArray);b.closePath();b.restore()},toObject:function(c){var d=[],a=[],e=1,h=1;this.filters.forEach(function(a){a&&("Resize"===a.type&&(e*=a.scaleX,h*=a.scaleY),d.push(a.toObject()))});this.resizeFilters.forEach(function(b){b&&a.push(b.toObject())});c=b(this.callSuper("toObject",["crossOrigin","alignX","alignY","meetOrSlice"].concat(c)),{src:this.getSrc(),filters:d,
resizeFilters:a});c.width/=e;c.height/=h;return c},toSVG:function(b){var c=this._createBaseSVGMarkup(),a=-this.width/2,e=-this.height/2,h="none";this.group&&"path-group"===this.group.type&&(a=this.left,e=this.top);"none"!==this.alignX&&"none"!==this.alignY&&(h="x"+this.alignX+"Y"+this.alignY+" "+this.meetOrSlice);c.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n',"<image ",this.getSvgId(),'xlink:href="',this.getSvgSrc(!0),'" x="',a,'" y="',e,'" style="',this.getSvgStyles(),
'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="',h,'"',"></image>\n");if(this.stroke||this.strokeDashArray)h=this.fill,this.fill=null,c.push("<rect ",'x="',a,'" y="',e,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'),this.fill=h;c.push("</g>\n");return b?b(c.join("")):c.join("")},getSrc:function(b){return(b=b?this._element:this._originalElement)?fabric.isLikelyNode?b._src:b.src:this.src||""},setSrc:function(b,d,a){fabric.util.loadImage(b,
function(b){return this.setElement(b,d,a)},this,a&&a.crossOrigin)},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyFilters:function(b,d,a,e){d=d||this.filters;if(a=a||this._originalElement){var c=fabric.util.createImage(),f=this.canvas?this.canvas.getRetinaScaling():fabric.devicePixelRatio,g=this.minimumScaleTrigger/f,k=this,m,n;if(0===d.length)return this._element=a,b&&b(this),a;var p=fabric.util.createCanvasElement();p.width=a.width;p.height=a.height;p.getContext("2d").drawImage(a,
0,0,a.width,a.height);d.forEach(function(a){a&&(e?(m=k.scaleX<g?k.scaleX:1,n=k.scaleY<g?k.scaleY:1,1>m*f&&(m*=f),1>n*f&&(n*=f)):(m=a.scaleX,n=a.scaleY),a.applyTo(p,m,n),e||"Resize"!==a.type||(k.width*=a.scaleX,k.height*=a.scaleY))});c.width=p.width;c.height=p.height;fabric.isLikelyNode?(c.src=p.toBuffer(void 0,fabric.Image.pngCompression),k._element=c,!e&&(k._filteredEl=c),b&&b(k)):(c.onload=function(){k._element=c;!e&&(k._filteredEl=c);b&&b(k);c.onload=p=null},c.src=p.toDataURL("image/png"));return p}},
_render:function(b,d){var a=this._findMargins();var c=d?this.left:-this.width/2;d=d?this.top:-this.height/2;"slice"===this.meetOrSlice&&(b.beginPath(),b.rect(c,d,this.width,this.height),b.clip());if(!1===this.isMoving&&this.resizeFilters.length&&this._needsResize()){this._lastScaleX=this.scaleX;this._lastScaleY=this.scaleY;var e=this.applyFilters(null,this.resizeFilters,this._filteredEl||this._originalElement,!0)}else e=this._element;e&&b.drawImage(e,c+a.marginX,d+a.marginY,a.width,a.height);this._stroke(b);
this._renderStroke(b)},_needsResize:function(){return this.scaleX!==this._lastScaleX||this.scaleY!==this._lastScaleY},_findMargins:function(){var b=this.width,d=this.height,a=0,e=0;if("none"!==this.alignX||"none"!==this.alignY)b=[this.width/this._element.width,this.height/this._element.height],d="meet"===this.meetOrSlice?Math.min.apply(null,b):Math.max.apply(null,b),b=this._element.width*d,d*=this._element.height,"Mid"===this.alignX&&(a=(this.width-b)/2),"Max"===this.alignX&&(a=this.width-b),"Mid"===
this.alignY&&(e=(this.height-d)/2),"Max"===this.alignY&&(e=this.height-d);return{width:b,height:d,marginX:a,marginY:e}},_resetWidthHeight:function(){var b=this.getElement();this.set("width",b.width);this.set("height",b.height)},_initElement:function(b,d,a){this.setElement(fabric.util.getById(b),a,d);fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(b){b||(b={});this.setOptions(b);this._setWidthHeight(b);this._element&&this.crossOrigin&&(this._element.crossOrigin=
this.crossOrigin)},_initFilters:function(b,d){b&&b.length?fabric.util.enlivenObjects(b,function(a){d&&d(a)},"fabric.Image.filters"):d&&d()},_setWidthHeight:function(b){this.width="width"in b?b.width:this.getElement()?this.getElement().width||0:0;this.height="height"in b?b.height:this.getElement()?this.getElement().height||0:0}}),fabric.Image.CSS_CANVAS="canvas-img",fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc,fabric.Image.fromObject=function(b,d){fabric.util.loadImage(b.src,function(a,
c){c?d&&d(null,c):fabric.Image.prototype._initFilters.call(b,b.filters,function(c){b.filters=c||[];fabric.Image.prototype._initFilters.call(b,b.resizeFilters,function(c){b.resizeFilters=c||[];return new fabric.Image(a,b,d)})})},null,b.crossOrigin)},fabric.Image.fromURL=function(b,d,a){fabric.util.loadImage(b,function(b){d&&d(new fabric.Image(b,a))},null,a&&a.crossOrigin)},fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin".split(" ")),
fabric.Image.fromElement=function(c,d,a){c=fabric.parseAttributes(c,fabric.Image.ATTRIBUTE_NAMES);if(c.preserveAspectRatio){var e=fabric.util.parsePreserveAspectRatioAttribute(c.preserveAspectRatio);b(c,e)}fabric.Image.fromURL(c["xlink:href"],d,b(a?fabric.util.object.clone(a):{},c))},fabric.Image.async=!0,fabric.Image.pngCompression=1)})("undefined"!==typeof exports?exports:this);
fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var e=this.getAngle()%360;return 0<e?90*Math.round((e-1)/90):90*Math.round(e/90)},straighten:function(){this.setAngle(this._getAngleValueForStraighten());return this},fxStraighten:function(e){e=e||{};var b=function(){},c=e.onComplete||b,d=e.onChange||b,a=this;fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(b){a.setAngle(b);
d()},onComplete:function(){a.setCoords();c()},onStart:function(){a.set("active",!1)}});return this}});fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(e){e.straighten();this.renderAll();return this},fxStraightenObject:function(e){e.fxStraighten({onChange:this.renderAll.bind(this)});return this}});fabric.Image.filters=fabric.Image.filters||{};
fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",initialize:function(e){e&&this.setOptions(e)},setOptions:function(e){for(var b in e)this[b]=e[b]},toObject:function(){return{type:this.type}},toJSON:function(){return this.toObject()}});fabric.Image.filters.BaseFilter.fromObject=function(e,b){e=new fabric.Image.filters[e.type](e);b&&b(e);return e};
(function(e){e=e.fabric||(e.fabric={});var b=e.util.object.extend,c=e.Image.filters,d=e.util.createClass;c.Brightness=d(c.BaseFilter,{type:"Brightness",initialize:function(a){a=a||{};this.brightness=a.brightness||0},applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);for(var c=a.data,d=this.brightness,e=0,k=c.length;e<k;e+=4)c[e]+=d,c[e+1]+=d,c[e+2]+=d;b.putImageData(a,0,0)},toObject:function(){return b(this.callSuper("toObject"),{brightness:this.brightness})}});e.Image.filters.Brightness.fromObject=
e.Image.filters.BaseFilter.fromObject})("undefined"!==typeof exports?exports:this);
(function(e){e=e.fabric||(e.fabric={});var b=e.util.object.extend,c=e.Image.filters,d=e.util.createClass;c.Convolute=d(c.BaseFilter,{type:"Convolute",initialize:function(a){a=a||{};this.opaque=a.opaque;this.matrix=a.matrix||[0,0,0,0,1,0,0,0,0]},applyTo:function(a){var b=this.matrix,c=a.getContext("2d"),d=c.getImageData(0,0,a.width,a.height);a=Math.round(Math.sqrt(b.length));var e=Math.floor(a/2),k=d.data,m=d.width;d=d.height;for(var n=c.createImageData(m,d),p=n.data,q=this.opaque?1:0,t,r,w,z,v,A,
D,u=0;u<d;u++)for(var y=0;y<m;y++){v=4*(u*m+y);for(var x=z=w=r=t=0;x<a;x++)for(var B=0;B<a;B++)D=u+x-e,A=y+B-e,0>D||D>d||0>A||A>m||(A=4*(D*m+A),D=b[x*a+B],t+=k[A]*D,r+=k[A+1]*D,w+=k[A+2]*D,z+=k[A+3]*D);p[v]=t;p[v+1]=r;p[v+2]=w;p[v+3]=z+q*(255-z)}c.putImageData(n,0,0)},toObject:function(){return b(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}});e.Image.filters.Convolute.fromObject=e.Image.filters.BaseFilter.fromObject})("undefined"!==typeof exports?exports:this);
(function(e){e=e.fabric||(e.fabric={});var b=e.util.object.extend,c=e.Image.filters,d=e.util.createClass;c.GradientTransparency=d(c.BaseFilter,{type:"GradientTransparency",initialize:function(a){a=a||{};this.threshold=a.threshold||100},applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);for(var c=a.data,d=this.threshold,e=c.length,k=0,m=c.length;k<m;k+=4)c[k+3]=d+255*(e-k)/e;b.putImageData(a,0,0)},toObject:function(){return b(this.callSuper("toObject"),{threshold:this.threshold})}});
e.Image.filters.GradientTransparency.fromObject=e.Image.filters.BaseFilter.fromObject})("undefined"!==typeof exports?exports:this);
(function(e){var b=e.fabric||(e.fabric={});e=b.Image.filters;var c=b.util.createClass;e.Grayscale=c(e.BaseFilter,{type:"Grayscale",applyTo:function(b){var a=b.getContext("2d");b=a.getImageData(0,0,b.width,b.height);for(var c=b.data,d=b.width*b.height*4,e=0,l;e<d;)l=(c[e]+c[e+1]+c[e+2])/3,c[e]=l,c[e+1]=l,c[e+2]=l,e+=4;a.putImageData(b,0,0)}});b.Image.filters.Grayscale.fromObject=function(c,a){c=c||{};c.type="Grayscale";return b.Image.filters.BaseFilter.fromObject(c,a)}})("undefined"!==typeof exports?
exports:this);
(function(e){var b=e.fabric||(e.fabric={});e=b.Image.filters;var c=b.util.createClass;e.Invert=c(e.BaseFilter,{type:"Invert",applyTo:function(b){var a=b.getContext("2d");b=a.getImageData(0,0,b.width,b.height);var c=b.data,d=c.length,e;for(e=0;e<d;e+=4)c[e]=255-c[e],c[e+1]=255-c[e+1],c[e+2]=255-c[e+2];a.putImageData(b,0,0)}});b.Image.filters.Invert.fromObject=function(c,a){c=c||{};c.type="Invert";return b.Image.filters.BaseFilter.fromObject(c,a)}})("undefined"!==typeof exports?exports:this);
(function(e){var b=e.fabric||(e.fabric={}),c=b.util.object.extend;e=b.Image.filters;var d=b.util.createClass;e.Mask=d(e.BaseFilter,{type:"Mask",initialize:function(a){a=a||{};this.mask=a.mask;this.channel=-1<[0,1,2,3].indexOf(a.channel)?a.channel:0},applyTo:function(a){if(this.mask){var c=a.getContext("2d"),d=c.getImageData(0,0,a.width,a.height),e=d.data,l=this.mask.getElement(),k=b.util.createCanvasElement(),m=this.channel,n=d.width*d.height*4;k.width=a.width;k.height=a.height;k.getContext("2d").drawImage(l,
0,0,a.width,a.height);l=k.getContext("2d").getImageData(0,0,a.width,a.height).data;for(a=0;a<n;a+=4)e[a+3]=l[a+m];c.putImageData(d,0,0)}},toObject:function(){return c(this.callSuper("toObject"),{mask:this.mask.toObject(),channel:this.channel})}});b.Image.filters.Mask.fromObject=function(a,c){b.util.loadImage(a.mask.src,function(d){a.mask=new b.Image(d,a.mask);return b.Image.filters.BaseFilter.fromObject(a,c)})};b.Image.filters.Mask.async=!0})("undefined"!==typeof exports?exports:this);
(function(e){e=e.fabric||(e.fabric={});var b=e.util.object.extend,c=e.Image.filters,d=e.util.createClass;c.Noise=d(c.BaseFilter,{type:"Noise",initialize:function(a){a=a||{};this.noise=a.noise||0},applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);for(var c=a.data,d=this.noise,e,k=0,m=c.length;k<m;k+=4)e=(.5-Math.random())*d,c[k]+=e,c[k+1]+=e,c[k+2]+=e;b.putImageData(a,0,0)},toObject:function(){return b(this.callSuper("toObject"),{noise:this.noise})}});e.Image.filters.Noise.fromObject=
e.Image.filters.BaseFilter.fromObject})("undefined"!==typeof exports?exports:this);
(function(e){e=e.fabric||(e.fabric={});var b=e.util.object.extend,c=e.Image.filters,d=e.util.createClass;c.Pixelate=d(c.BaseFilter,{type:"Pixelate",initialize:function(a){a=a||{};this.blocksize=a.blocksize||4},applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);var c=a.data,d=a.height,e=a.width,k,m;for(k=0;k<d;k+=this.blocksize)for(m=0;m<e;m+=this.blocksize){var n=4*k*e+4*m;var p=c[n];var q=c[n+1];var t=c[n+2];var r=c[n+3];for(var w=k,z=k+this.blocksize;w<z;w++)for(var v=
m,A=m+this.blocksize;v<A;v++)n=4*w*e+4*v,c[n]=p,c[n+1]=q,c[n+2]=t,c[n+3]=r}b.putImageData(a,0,0)},toObject:function(){return b(this.callSuper("toObject"),{blocksize:this.blocksize})}});e.Image.filters.Pixelate.fromObject=e.Image.filters.BaseFilter.fromObject})("undefined"!==typeof exports?exports:this);
(function(e){e=e.fabric||(e.fabric={});var b=e.util.object.extend,c=e.Image.filters,d=e.util.createClass;c.RemoveWhite=d(c.BaseFilter,{type:"RemoveWhite",initialize:function(a){a=a||{};this.threshold=a.threshold||30;this.distance=a.distance||20},applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);for(var c=a.data,d=this.distance,e=255-this.threshold,k=Math.abs,m,n,p,q=0,t=c.length;q<t;q+=4)m=c[q],n=c[q+1],p=c[q+2],m>e&&n>e&&p>e&&k(m-n)<d&&k(m-p)<d&&k(n-p)<d&&(c[q+3]=
0);b.putImageData(a,0,0)},toObject:function(){return b(this.callSuper("toObject"),{threshold:this.threshold,distance:this.distance})}});e.Image.filters.RemoveWhite.fromObject=e.Image.filters.BaseFilter.fromObject})("undefined"!==typeof exports?exports:this);
(function(e){var b=e.fabric||(e.fabric={});e=b.Image.filters;var c=b.util.createClass;e.Sepia=c(e.BaseFilter,{type:"Sepia",applyTo:function(b){var a=b.getContext("2d");b=a.getImageData(0,0,b.width,b.height);var c=b.data,d=c.length,e;for(e=0;e<d;e+=4){var l=.3*c[e]+.59*c[e+1]+.11*c[e+2];c[e]=l+100;c[e+1]=l+50;c[e+2]=l+255}a.putImageData(b,0,0)}});b.Image.filters.Sepia.fromObject=function(c,a){c=c||{};c.type="Sepia";return new b.Image.filters.BaseFilter.fromObject(c,a)}})("undefined"!==typeof exports?
exports:this);
(function(e){var b=e.fabric||(e.fabric={});e=b.Image.filters;var c=b.util.createClass;e.Sepia2=c(e.BaseFilter,{type:"Sepia2",applyTo:function(b){var a=b.getContext("2d");b=a.getImageData(0,0,b.width,b.height);var c=b.data,d=c.length,e;for(e=0;e<d;e+=4){var l=c[e];var k=c[e+1];var m=c[e+2];c[e]=(.393*l+.769*k+.189*m)/1.351;c[e+1]=(.349*l+.686*k+.168*m)/1.203;c[e+2]=(.272*l+.534*k+.131*m)/2.14}a.putImageData(b,0,0)}});b.Image.filters.Sepia2.fromObject=function(c,a){c=c||{};c.type="Sepia2";return new b.Image.filters.BaseFilter.fromObject(c,
a)}})("undefined"!==typeof exports?exports:this);
(function(e){var b=e.fabric||(e.fabric={}),c=b.util.object.extend;e=b.Image.filters;var d=b.util.createClass;e.Tint=d(e.BaseFilter,{type:"Tint",initialize:function(a){a=a||{};this.color=a.color||"#000000";this.opacity="undefined"!==typeof a.opacity?a.opacity:(new b.Color(this.color)).getAlpha()},applyTo:function(a){var c=a.getContext("2d");a=c.getImageData(0,0,a.width,a.height);var d=a.data,e=d.length;var l=(new b.Color(this.color)).getSource();var k=l[0]*this.opacity;var m=l[1]*this.opacity;var n=
l[2]*this.opacity;var p=1-this.opacity;for(l=0;l<e;l+=4){var q=d[l];var t=d[l+1];var r=d[l+2];d[l]=k+q*p;d[l+1]=m+t*p;d[l+2]=n+r*p}c.putImageData(a,0,0)},toObject:function(){return c(this.callSuper("toObject"),{color:this.color,opacity:this.opacity})}});b.Image.filters.Tint.fromObject=b.Image.filters.BaseFilter.fromObject})("undefined"!==typeof exports?exports:this);
(function(e){var b=e.fabric||(e.fabric={}),c=b.util.object.extend;e=b.Image.filters;var d=b.util.createClass;e.Multiply=d(e.BaseFilter,{type:"Multiply",initialize:function(a){a=a||{};this.color=a.color||"#000000"},applyTo:function(a){var c=a.getContext("2d");a=c.getImageData(0,0,a.width,a.height);var d=a.data,e=d.length,l;var k=(new b.Color(this.color)).getSource();for(l=0;l<e;l+=4)d[l]*=k[0]/255,d[l+1]*=k[1]/255,d[l+2]*=k[2]/255;c.putImageData(a,0,0)},toObject:function(){return c(this.callSuper("toObject"),
{color:this.color})}});b.Image.filters.Multiply.fromObject=b.Image.filters.BaseFilter.fromObject})("undefined"!==typeof exports?exports:this);
(function(e){var b=e.fabric;e=b.Image.filters;var c=b.util.createClass;e.Blend=c(e.BaseFilter,{type:"Blend",initialize:function(b){b=b||{};this.color=b.color||"#000";this.image=b.image||!1;this.mode=b.mode||"multiply";this.alpha=b.alpha||1},applyTo:function(c){var a=c.getContext("2d");c=a.getImageData(0,0,c.width,c.height);var d=c.data,e=!1;if(this.image){e=!0;var f=b.util.createCanvasElement();f.width=this.image.width;f.height=this.image.height;f=new b.StaticCanvas(f);f.add(this.image);f=f.getContext("2d").getImageData(0,
0,f.width,f.height).data}else{f=(new b.Color(this.color)).getSource();var l=f[0]*this.alpha;var k=f[1]*this.alpha;var m=f[2]*this.alpha}for(var n=0,p=d.length;n<p;n+=4){var q=d[n];var t=d[n+1];var r=d[n+2];e&&(l=f[n]*this.alpha,k=f[n+1]*this.alpha,m=f[n+2]*this.alpha);switch(this.mode){case "multiply":d[n]=q*l/255;d[n+1]=t*k/255;d[n+2]=r*m/255;break;case "screen":d[n]=1-(1-q)*(1-l);d[n+1]=1-(1-t)*(1-k);d[n+2]=1-(1-r)*(1-m);break;case "add":d[n]=Math.min(255,q+l);d[n+1]=Math.min(255,t+k);d[n+2]=Math.min(255,
r+m);break;case "diff":case "difference":d[n]=Math.abs(q-l);d[n+1]=Math.abs(t-k);d[n+2]=Math.abs(r-m);break;case "subtract":q-=l;t-=k;r-=m;d[n]=0>q?0:q;d[n+1]=0>t?0:t;d[n+2]=0>r?0:r;break;case "darken":d[n]=Math.min(q,l);d[n+1]=Math.min(t,k);d[n+2]=Math.min(r,m);break;case "lighten":d[n]=Math.max(q,l),d[n+1]=Math.max(t,k),d[n+2]=Math.max(r,m)}}a.putImageData(c,0,0)},toObject:function(){return{color:this.color,image:this.image,mode:this.mode,alpha:this.alpha}}});b.Image.filters.Blend.fromObject=b.Image.filters.BaseFilter.fromObject})("undefined"!==
typeof exports?exports:this);
(function(e){var b=e.fabric||(e.fabric={}),c=Math.pow,d=Math.floor,a=Math.sqrt,g=Math.abs,h=Math.max,f=Math.round,l=Math.sin,k=Math.ceil;e=b.Image.filters;var m=b.util.createClass;e.Resize=m(e.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:0,scaleY:0,lanczosLobes:3,applyTo:function(a,b,c){if(1!==b||1!==c){this.rcpScaleX=1/b;this.rcpScaleY=1/c;var d=a.width,e=a.height;b=f(d*b);c=f(e*c);var g;"sliceHack"===this.resizeType&&(g=this.sliceByTwo(a,d,e,b,c));"hermite"===this.resizeType&&(g=this.hermiteFastResize(a,
d,e,b,c));"bilinear"===this.resizeType&&(g=this.bilinearFiltering(a,d,e,b,c));"lanczos"===this.resizeType&&(g=this.lanczosResize(a,d,e,b,c));a.width=b;a.height=c;a.getContext("2d").putImageData(g,0,0)}},sliceByTwo:function(a,c,e,f,g){var l=a.getContext("2d"),k=.5,m=.5,n=1,p=1,q=!1,r=!1,t=c,B=e,E=b.util.createCanvasElement(),F=E.getContext("2d");f=d(f);g=d(g);E.width=h(f,c);E.height=h(g,e);f>c&&(k=2,n=-1);g>e&&(m=2,p=-1);var C=l.getImageData(0,0,c,e);a.width=h(f,c);a.height=h(g,e);for(l.putImageData(C,
0,0);!q||!r;)c=t,e=B,f*n<d(t*k*n)?t=d(t*k):(t=f,q=!0),g*p<d(B*m*p)?B=d(B*m):(B=g,r=!0),C=l.getImageData(0,0,c,e),F.putImageData(C,0,0),l.clearRect(0,0,t,B),l.drawImage(E,0,0,c,e,0,0,t,B);return l.getImageData(0,0,f,g)},lanczosResize:function(b,e,f,h,m){var n,p,q;function r(b){var l,k,t,v,w,z;p=(b+.5)*E;n=d(p);for(l=0;l<m;l++){q=(l+.5)*F;L=d(q);var D=z=w=v=t=0;for(k=n-M;k<=n+M;k++)if(!(0>k||k>=e)){var A=d(1E3*g(k-p));O[A]||(O[A]={});for(var I=L-N;I<=L+N;I++)if(!(0>I||I>=f)){var H=d(1E3*g(I-q));O[A][H]||
(O[A][H]=B(a(c(A*C,2)+c(H*G,2))/1E3));H=O[A][H];if(0<H){var K=4*(I*e+k);t+=H;v+=H*y[K];w+=H*y[K+1];z+=H*y[K+2];D+=H*y[K+3]}}}K=4*(l*h+b);x[K]=v/t;x[K+1]=w/t;x[K+2]=z/t;x[K+3]=D/t}return++b<h?r(b):u}b=b.getContext("2d");var t=b.getImageData(0,0,e,f),u=b.getImageData(0,0,h,m),y=t.data,x=u.data,B=function(a){return function(b){if(b>a)return 0;b*=Math.PI;if(1E-16>g(b))return 1;var c=b/a;return l(b)*l(c)/b/c}}(this.lanczosLobes),E=this.rcpScaleX,F=this.rcpScaleY,C=2/this.rcpScaleX,G=2/this.rcpScaleY,M=
k(E*this.lanczosLobes/2),N=k(F*this.lanczosLobes/2),O={};var L=n=q=p=void 0;return r(0)},bilinearFiltering:function(a,b,c,e,f){var g,h=0,l=this.rcpScaleX,k=this.rcpScaleY;var m=a.getContext("2d");a=4*(b-1);c=m.getImageData(0,0,b,c).data;var n=m.getImageData(0,0,e,f),p=n.data;for(m=0;m<f;m++)for(g=0;g<e;g++){var q=d(l*g);var r=d(k*m);var t=l*g-q;var F=k*m-r;r=4*(r*b+q);for(q=0;4>q;q++){var C=c[r+q];var G=c[r+4+q];var M=c[r+a+q];var N=c[r+a+4+q];C=C*(1-t)*(1-F)+G*t*(1-F)+M*F*(1-t)+N*t*F;p[h++]=C}}return n},
hermiteFastResize:function(b,c,e,f,h){var l=this.rcpScaleX,m=this.rcpScaleY,n=k(l/2),p=k(m/2);b=b.getContext("2d");e=b.getImageData(0,0,c,e).data;b=b.getImageData(0,0,f,h);for(var q=b.data,r=0;r<h;r++)for(var t=0;t<f;t++){for(var x=4*(t+r*f),B,E=0,F=0,C=0,G=0,M=0,N=0,O=(r+.5)*m,L=d(r*m);L<(r+1)*m;L++){var I=g(O-(L+.5))/p,Q=(t+.5)*l;I*=I;for(var P=d(t*l);P<(t+1)*l;P++){var J=g(Q-(P+.5))/n;B=a(I+J*J);1<B&&-1>B||(B=2*B*B*B-3*B*B+1,0<B&&(J=4*(P+L*c),N+=B*e[J+3],F+=B,255>e[J+3]&&(B=B*e[J+3]/250),C+=B*
e[J],G+=B*e[J+1],M+=B*e[J+2],E+=B))}}q[x]=C/E;q[x+1]=G/E;q[x+2]=M/E;q[x+3]=N/F}return b},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}});b.Image.filters.Resize.fromObject=b.Image.filters.BaseFilter.fromObject})("undefined"!==typeof exports?exports:this);
(function(e){e=e.fabric||(e.fabric={});var b=e.util.object.extend,c=e.Image.filters,d=e.util.createClass;c.ColorMatrix=d(c.BaseFilter,{type:"ColorMatrix",initialize:function(a){a||(a={});this.matrix=a.matrix||[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]},applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);var c=a.data,d=c.length,e,k=this.matrix;for(e=0;e<d;e+=4){var m=c[e];var n=c[e+1];var p=c[e+2];var q=c[e+3];c[e]=m*k[0]+n*k[1]+p*k[2]+q*k[3]+k[4];c[e+1]=m*k[5]+n*k[6]+
p*k[7]+q*k[8]+k[9];c[e+2]=m*k[10]+n*k[11]+p*k[12]+q*k[13]+k[14];c[e+3]=m*k[15]+n*k[16]+p*k[17]+q*k[18]+k[19]}b.putImageData(a,0,0)},toObject:function(){return b(this.callSuper("toObject"),{type:this.type,matrix:this.matrix})}});e.Image.filters.ColorMatrix.fromObject=e.Image.filters.BaseFilter.fromObject})("undefined"!==typeof exports?exports:this);
(function(e){e=e.fabric||(e.fabric={});var b=e.util.object.extend,c=e.Image.filters,d=e.util.createClass;c.Contrast=d(c.BaseFilter,{type:"Contrast",initialize:function(a){a=a||{};this.contrast=a.contrast||0},applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);for(var c=a.data,d=259*(this.contrast+255)/(255*(259-this.contrast)),e=0,k=c.length;e<k;e+=4)c[e]=d*(c[e]-128)+128,c[e+1]=d*(c[e+1]-128)+128,c[e+2]=d*(c[e+2]-128)+128;b.putImageData(a,0,0)},toObject:function(){return b(this.callSuper("toObject"),
{contrast:this.contrast})}});e.Image.filters.Contrast.fromObject=e.Image.filters.BaseFilter.fromObject})("undefined"!==typeof exports?exports:this);
(function(e){e=e.fabric||(e.fabric={});var b=e.util.object.extend,c=e.Image.filters,d=e.util.createClass;c.Saturate=d(c.BaseFilter,{type:"Saturate",initialize:function(a){a=a||{};this.saturate=a.saturate||0},applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);for(var c=a.data,d,e=.01*-this.saturate,k=0,m=c.length;k<m;k+=4)d=Math.max(c[k],c[k+1],c[k+2]),c[k]+=d!==c[k]?(d-c[k])*e:0,c[k+1]+=d!==c[k+1]?(d-c[k+1])*e:0,c[k+2]+=d!==c[k+2]?(d-c[k+2])*e:0;b.putImageData(a,0,
0)},toObject:function(){return b(this.callSuper("toObject"),{saturate:this.saturate})}});e.Image.filters.Saturate.fromObject=e.Image.filters.BaseFilter.fromObject})("undefined"!==typeof exports?exports:this);
(function(e){var b=e.fabric||(e.fabric={}),c=b.util.toFixed,d=b.Object.NUM_FRACTION_DIGITS;b.Text?b.warn("fabric.Text is already defined"):(b.Text=b.util.createClass(b.Object,{_dimensionAffectingProps:"fontSize fontWeight fontFamily fontStyle lineHeight text charSpacing textAlign".split(" "),_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.16,textBackgroundColor:"",
stateProperties:b.Object.prototype.stateProperties.concat("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing"),cacheProperties:b.Object.prototype.cacheProperties.concat("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing","styles"),stroke:null,shadow:null,_fontSizeFraction:.25,_fontSizeMult:1.13,charSpacing:0,initialize:function(a,b){b=
b||{};this.text=a;this.__skipDimension=!0;this.callSuper("initialize",b);this.__skipDimension=!1;this._initDimensions();this.setCoords();this.setupState({propertySet:"_dimensionAffectingProps"})},_initDimensions:function(a){this.__skipDimension||(a||(a=b.util.createCanvasElement().getContext("2d"),this._setTextStyles(a)),this._textLines=this._splitTextIntoLines(),this._clearCache(),this.width=this._getTextWidth(a)||this.cursorWidth||2,this.height=this._getTextHeight(a),this.setCoords())},toString:function(){return"#<fabric.Text ("+
this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var a=this.callSuper("_getCacheCanvasDimensions"),b=this.fontSize;a.width+=b*a.zoomX;a.height+=b*a.zoomY;return a},_render:function(a){this._setTextStyles(a);this.group&&"path-group"===this.group.type&&a.translate(this.left,this.top);this._renderTextLinesBackground(a);this._renderText(a);this._renderTextDecoration(a)},_renderText:function(a){this._renderTextFill(a);this._renderTextStroke(a)},
_setTextStyles:function(a){a.textBaseline="alphabetic";a.font=this._getFontDeclaration()},_getTextHeight:function(){return this._getHeightOfSingleLine()+(this._textLines.length-1)*this._getHeightOfLine()},_getTextWidth:function(a){for(var b=this._getLineWidth(a,0),c=1,d=this._textLines.length;c<d;c++){var e=this._getLineWidth(a,c);e>b&&(b=e)}return b},_renderChars:function(a,b,c,d,e){var f=a.slice(0,-4);if(this[f].toLive){var g=-this.width/2+this[f].offsetX||0;var h=-this.height/2+this[f].offsetY||
0;b.save();b.translate(g,h);d-=g;e-=h}if(0!==this.charSpacing){var l=this._getWidthOfCharSpacing();c=c.split("");for(var q=0,t=c.length;q<t;q++)g=c[q],h=b.measureText(g).width+l,b[a](g,d,e),d+=0<h?h:0}else b[a](c,d,e);this[f].toLive&&b.restore()},_renderTextLine:function(a,b,c,d,e,k){e-=this.fontSize*this._fontSizeFraction;var f=this._getLineWidth(b,k);if("justify"!==this.textAlign||this.width<f)this._renderChars(a,b,c,d,e,k);else{f=c.split(/\s+/);var g=0,h=this._getWidthOfWords(b,f.join(" "),k,0);
h=this.width-h;var l=f.length-1;h=0<l?h/l:0;l=0;for(var t,r=0,w=f.length;r<w;r++){for(;" "===c[g]&&g<c.length;)g++;t=f[r];this._renderChars(a,b,t,d+l,e,k,g);l+=this._getWidthOfWords(b,t,k,g)+h;g+=t.length}}},_getWidthOfWords:function(a,b){a=a.measureText(b).width;0!==this.charSpacing&&(b=b.split("").length,b*=this._getWidthOfCharSpacing(),a+=b);return 0<a?a:0},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},isEmptyStyles:function(){return!0},_renderTextCommon:function(a,
b){for(var c=0,d=this._getLeftOffset(),e=this._getTopOffset(),g=0,m=this._textLines.length;g<m;g++){var n=this._getHeightOfLine(a,g),p=n/this.lineHeight,q=this._getLineWidth(a,g);q=this._getLineLeftOffset(q);this._renderTextLine(b,a,this._textLines[g],d+q,e+c+p,g);c+=n}},_renderTextFill:function(a){!this.fill&&this.isEmptyStyles()||this._renderTextCommon(a,"fillText")},_renderTextStroke:function(a){if(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles())this.shadow&&!this.shadow.affectStroke&&
this._removeShadow(a),a.save(),this._setLineDash(a,this.strokeDashArray),a.beginPath(),this._renderTextCommon(a,"strokeText"),a.closePath(),a.restore()},_getHeightOfLine:function(){return this._getHeightOfSingleLine()*this.lineHeight},_getHeightOfSingleLine:function(){return this.fontSize*this._fontSizeMult},_renderTextLinesBackground:function(a){if(this.textBackgroundColor){var b=0,c=a.fillStyle;a.fillStyle=this.textBackgroundColor;for(var d=0,e=this._textLines.length;d<e;d++){var k=this._getHeightOfLine(a,
d);var m=this._getLineWidth(a,d);if(0<m){var n=this._getLineLeftOffset(m);a.fillRect(this._getLeftOffset()+n,this._getTopOffset()+b,m,k/this.lineHeight)}b+=k}a.fillStyle=c;this._removeShadow(a)}},_getLineLeftOffset:function(a){return"center"===this.textAlign?(this.width-a)/2:"right"===this.textAlign?this.width-a:0},_clearCache:function(){this.__lineWidths=[];this.__lineHeights=[]},_shouldClearDimensionCache:function(){var a=this._forceClearCache;a||(a=this.hasStateChanged("_dimensionAffectingProps"));
a&&(this.saveState({propertySet:"_dimensionAffectingProps"}),this.dirty=!0);return a},_getLineWidth:function(a,b){if(this.__lineWidths[b])return-1===this.__lineWidths[b]?this.width:this.__lineWidths[b];var c=this._textLines[b];a=""===c?0:this._measureLine(a,b);(this.__lineWidths[b]=a)&&"justify"===this.textAlign&&(c=c.split(/\s+/),1<c.length&&(this.__lineWidths[b]=-1));return a},_getWidthOfCharSpacing:function(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1E3:0},_measureLine:function(a,
b){b=this._textLines[b];a=a.measureText(b).width;var c=0;0!==this.charSpacing&&(b=b.split("").length,c=(b-1)*this._getWidthOfCharSpacing());b=a+c;return 0<b?b:0},_renderTextDecoration:function(a){if(this.textDecoration){var b=this.height/2,c=[];-1<this.textDecoration.indexOf("underline")&&c.push(.85);-1<this.textDecoration.indexOf("line-through")&&c.push(.43);-1<this.textDecoration.indexOf("overline")&&c.push(-.12);if(0<c.length){var d=0,e,k;var m=0;for(e=this._textLines.length;m<e;m++){var n=this._getLineWidth(a,
m);var p=this._getLineLeftOffset(n);var q=this._getHeightOfLine(a,m);var t=0;for(k=c.length;t<k;t++)a.fillRect(this._getLeftOffset()+p,d+(this._fontSizeMult-1+c[t])*this.fontSize-b,n,this.fontSize/15);d+=q}}}},_getFontDeclaration:function(){return[b.isLikelyNode?this.fontWeight:this.fontStyle,b.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",b.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(a,b){!this.visible||this.canvas&&this.canvas.skipOffscreen&&
!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&(this._setTextStyles(a),this._initDimensions(a)),this.callSuper("render",a,b))},_splitTextIntoLines:function(){return this.text.split(this._reNewline)},toObject:function(a){a="text fontSize fontWeight fontFamily fontStyle lineHeight textDecoration textAlign textBackgroundColor charSpacing".split(" ").concat(a);return this.callSuper("toObject",a)},toSVG:function(a){this.ctx||(this.ctx=b.util.createCanvasElement().getContext("2d"));
var c=this._createBaseSVGMarkup(),d=this._getSVGLeftTopOffsets(this.ctx);d=this._getSVGTextAndBg(d.textTop,d.textLeft);this._wrapSVGTextAndBg(c,d);return a?a(c.join("")):c.join("")},_getSVGLeftTopOffsets:function(a){a=this._getHeightOfLine(a,0);return{textLeft:-this.width/2+(this.group&&"path-group"===this.group.type?this.left:0),textTop:this.group&&"path-group"===this.group.type?-this.top:0,lineTop:a}},_wrapSVGTextAndBg:function(a,b){var c=this.getSvgFilter();c=""===c?"":' style="'+c+'"';a.push("\t<g ",
this.getSvgId(),'transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"',c,">\n",b.textBgRects.join(""),'\t\t<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(!0),'" >\n',b.textSpans.join(""),
"\t\t</text>\n","\t</g>\n")},getSvgStyles:function(a){return b.Object.prototype.getSvgStyles.call(this,a)+" white-space: pre;"},_getSVGTextAndBg:function(a,b){var c=[],d=[],e=0;this._setSVGBg(d);for(var g=0,m=this._textLines.length;g<m;g++)this.textBackgroundColor&&this._setSVGTextLineBg(d,g,b,a,e),this._setSVGTextLineText(g,c,e,b,a,d),e+=this._getHeightOfLine(this.ctx,g);return{textSpans:c,textBgRects:d}},_setSVGTextLineText:function(a,e,h,f,l){h=this.fontSize*(this._fontSizeMult-this._fontSizeFraction)-
l+h-this.height/2;"justify"===this.textAlign?this._setSVGTextLineJustifed(a,e,h,f):e.push('\t\t\t<tspan x="',c(f+this._getLineLeftOffset(this._getLineWidth(this.ctx,a)),d),'" ','y="',c(h,d),'" ',this._getFillAttributes(this.fill),">",b.util.string.escapeXml(this._textLines[a]),"</tspan>\n")},_setSVGTextLineJustifed:function(a,e,h,f){var g=b.util.createCanvasElement().getContext("2d");this._setTextStyles(g);var k=this._textLines[a].split(/\s+/),m=this._getWidthOfWords(g,k.join(""));m=this.width-m;
var n=k.length-1;m=0<n?m/n:0;var p=this._getFillAttributes(this.fill),q;f+=this._getLineLeftOffset(this._getLineWidth(g,a));a=0;for(q=k.length;a<q;a++)n=k[a],e.push('\t\t\t<tspan x="',c(f,d),'" ','y="',c(h,d),'" ',p,">",b.util.string.escapeXml(n),"</tspan>\n"),f+=this._getWidthOfWords(g,n)+m},_setSVGTextLineBg:function(a,b,e,f,l){a.push("\t\t<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',c(e+this._getLineLeftOffset(this._getLineWidth(this.ctx,b)),d),'" y="',c(l-this.height/2,d),
'" width="',c(this._getLineWidth(this.ctx,b),d),'" height="',c(this._getHeightOfLine(this.ctx,b)/this.lineHeight,d),'"></rect>\n')},_setSVGBg:function(a){this.backgroundColor&&a.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',c(-this.width/2,d),'" y="',c(-this.height/2,d),'" width="',c(this.width,d),'" height="',c(this.height,d),'"></rect>\n')},_getFillAttributes:function(a){var c=a&&"string"===typeof a?new b.Color(a):"";return c&&c.getSource()&&1!==c.getAlpha()?'opacity="'+
c.getAlpha()+'" fill="'+c.setAlpha(1).toRgb()+'"':'fill="'+a+'"'},_set:function(a,b){this.callSuper("_set",a,b);-1<this._dimensionAffectingProps.indexOf(a)&&(this._initDimensions(),this.setCoords())},complexity:function(){return 1}}),b.Text.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size text-decoration text-anchor".split(" ")),b.Text.DEFAULT_SVG_FONT_SIZE=16,b.Text.fromElement=function(a,c){if(!a)return null;var d=b.parseAttributes(a,b.Text.ATTRIBUTE_NAMES);
c=b.util.object.extend(c?b.util.object.clone(c):{},d);c.top=c.top||0;c.left=c.left||0;"dx"in d&&(c.left+=d.dx);"dy"in d&&(c.top+=d.dy);"fontSize"in c||(c.fontSize=b.Text.DEFAULT_SVG_FONT_SIZE);c.originX||(c.originX="left");d="";"textContent"in a?d=a.textContent:"firstChild"in a&&null!==a.firstChild&&"data"in a.firstChild&&null!==a.firstChild.data&&(d=a.firstChild.data);d=d.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");a=new b.Text(d,c);c=a.getHeight()/a.height;c*=(a.height+a.strokeWidth)*a.lineHeight-
a.height;c=a.getHeight()+c;d=0;"left"===a.originX&&(d=a.getWidth()/2);"right"===a.originX&&(d=-a.getWidth()/2);a.set({left:a.getLeft()+d,top:a.getTop()-c/2+a.fontSize*(.18+a._fontSizeFraction)/a.lineHeight});return a},b.Text.fromObject=function(a,c,d){return b.Object._fromObject("Text",a,c,d,"text")},b.util.createAccessors(b.Text))})("undefined"!==typeof exports?exports:this);
(function(){var e=fabric.util.object.clone;fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1E3,cursorDuration:600,styles:null,caching:!0,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],initialize:function(b,c){this.styles=
c?c.styles||{}:{};this.callSuper("initialize",b,c);this.initBehavior()},_clearCache:function(){this.callSuper("_clearCache");this.__widthOfSpace=[]},isEmptyStyles:function(){if(!this.styles)return!0;var b=this.styles,c;for(c in b)for(var d in b[c])for(var a in b[c][d])return!1;return!0},setSelectionStart:function(b){b=Math.max(b,0);this._updateAndFire("selectionStart",b)},setSelectionEnd:function(b){b=Math.min(b,this.text.length);this._updateAndFire("selectionEnd",b)},_updateAndFire:function(b,c){this[b]!==
c&&(this._fireSelectionChanged(),this[b]=c);this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},getSelectionStyles:function(b,c){if(2===arguments.length){for(var d=[],a=b;a<c;a++)d.push(this.getSelectionStyles(a));return d}d=this.get2DCursorLocation(b);return this._getStyleDeclaration(d.lineIndex,d.charIndex)||{}},setSelectionStyles:function(b){if(this.selectionStart===this.selectionEnd)this._extendStyles(this.selectionStart,
b);else for(var c=this.selectionStart;c<this.selectionEnd;c++)this._extendStyles(c,b);this._forceClearCache=!0;return this},_extendStyles:function(b,c){b=this.get2DCursorLocation(b);this._getLineStyle(b.lineIndex)||this._setLineStyle(b.lineIndex,{});this._getStyleDeclaration(b.lineIndex,b.charIndex)||this._setStyleDeclaration(b.lineIndex,b.charIndex,{});fabric.util.object.extend(this._getStyleDeclaration(b.lineIndex,b.charIndex),c)},_initDimensions:function(b){b||this.clearContextTop();this.callSuper("_initDimensions",
b)},render:function(b,c){this.clearContextTop();this.callSuper("render",b,c);this.cursorOffsetCache={};this.renderCursorOrSelection()},_render:function(b){this.callSuper("_render",b);this.ctx=b},clearContextTop:function(){if(this.active&&this.isEditing&&this.canvas&&this.canvas.contextTop){var b=this.canvas.contextTop;b.save();b.transform.apply(b,this.canvas.viewportTransform);this.transform(b);this.transformMatrix&&b.transform.apply(b,this.transformMatrix);this._clearTextArea(b);b.restore()}},renderCursorOrSelection:function(){if(this.active&&
this.isEditing){var b=this.text.split("");if(this.canvas&&this.canvas.contextTop){var c=this.canvas.contextTop;c.save();c.transform.apply(c,this.canvas.viewportTransform);this.transform(c);this.transformMatrix&&c.transform.apply(c,this.transformMatrix);this._clearTextArea(c)}else c=this.ctx,c.save();if(this.selectionStart===this.selectionEnd){var d=this._getCursorBoundaries(b,"cursor");this.renderCursor(d,c)}else d=this._getCursorBoundaries(b,"selection"),this.renderSelection(b,d,c);c.restore()}},
_clearTextArea:function(b){var c=this.width+4,d=this.height+4;b.clearRect(-c/2,-d/2,c,d)},get2DCursorLocation:function(b){"undefined"===typeof b&&(b=this.selectionStart);for(var c=this._textLines.length,d=0;d<c;d++){if(b<=this._textLines[d].length)return{lineIndex:d,charIndex:b};b-=this._textLines[d].length+1}return{lineIndex:d-1,charIndex:this._textLines[d-1].length<b?this._textLines[d-1].length:b}},getCurrentCharStyle:function(b,c){b=this._getStyleDeclaration(b,0===c?0:c-1);return{fontSize:b&&b.fontSize||
this.fontSize,fill:b&&b.fill||this.fill,textBackgroundColor:b&&b.textBackgroundColor||this.textBackgroundColor,textDecoration:b&&b.textDecoration||this.textDecoration,fontFamily:b&&b.fontFamily||this.fontFamily,fontWeight:b&&b.fontWeight||this.fontWeight,fontStyle:b&&b.fontStyle||this.fontStyle,stroke:b&&b.stroke||this.stroke,strokeWidth:b&&b.strokeWidth||this.strokeWidth}},getCurrentCharFontSize:function(b,c){return(b=this._getStyleDeclaration(b,0===c?0:c-1))&&b.fontSize?b.fontSize:this.fontSize},
getCurrentCharColor:function(b,c){return(b=this._getStyleDeclaration(b,0===c?0:c-1))&&b.fill?b.fill:this.cursorColor},_getCursorBoundaries:function(b,c){var d=Math.round(this._getLeftOffset()),a=this._getTopOffset();b=this._getCursorBoundariesOffsets(b,c);return{left:d,top:a,leftOffset:b.left+b.lineLeft,topOffset:b.top}},_getCursorBoundariesOffsets:function(b,c){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;for(var d=0,a=0,e=0,h=0,f=0,l=0;l<this.selectionStart;l++)"\n"===
b[l]?(f=0,h+=this._getHeightOfLine(this.ctx,a),a++,e=0):(f+=this._getWidthOfChar(this.ctx,b[l],a,e),e++),d=this._getLineLeftOffset(this._getLineWidth(this.ctx,a));"cursor"===c&&(h+=(1-this._fontSizeFraction)*this._getHeightOfLine(this.ctx,a)/this.lineHeight-this.getCurrentCharFontSize(a,e)*(1-this._fontSizeFraction));0!==this.charSpacing&&e===this._textLines[a].length&&(f-=this._getWidthOfCharSpacing());return this.cursorOffsetCache={top:h,left:0<f?f:0,lineLeft:d}},renderCursor:function(b,c){var d=
this.get2DCursorLocation(),a=d.lineIndex;d=d.charIndex;var e=this.getCurrentCharFontSize(a,d),h=b.leftOffset,f=this.scaleX*this.canvas.getZoom();f=this.cursorWidth/f;c.fillStyle=this.getCurrentCharColor(a,d);c.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity;c.fillRect(b.left+h-f/2,b.top+b.topOffset,f,e)},renderSelection:function(b,c,d){d.fillStyle=this.selectionColor;b=this.get2DCursorLocation(this.selectionStart);for(var a=this.get2DCursorLocation(this.selectionEnd),e=b.lineIndex,h=a.lineIndex,
f=e;f<=h;f++){var l=this._getLineLeftOffset(this._getLineWidth(d,f))||0,k=this._getHeightOfLine(this.ctx,f),m=0;var n=this._textLines[f];if(f===e){for(var p=0,q=n.length;p<q;p++)p>=b.charIndex&&(f!==h||p<a.charIndex)&&(m+=this._getWidthOfChar(d,n[p],f,p)),p<b.charIndex&&(l+=this._getWidthOfChar(d,n[p],f,p));p===n.length&&(m-=this._getWidthOfCharSpacing())}else if(f>e&&f<h)m+=this._getLineWidth(d,f)||5;else if(f===h){p=0;for(q=a.charIndex;p<q;p++)m+=this._getWidthOfChar(d,n[p],f,p);a.charIndex===n.length&&
(m-=this._getWidthOfCharSpacing())}n=k;if(1>this.lineHeight||f===h&&1<this.lineHeight)k/=this.lineHeight;d.fillRect(c.left+l,c.top+c.topOffset,0<m?m:0,k);c.topOffset+=n}},_renderChars:function(b,c,d,a,e,h,f){if(this.isEmptyStyles())return this._renderCharsFast(b,c,d,a,e);f=f||0;var g=this._getHeightOfLine(c,h),k="";c.save();e-=g/this.lineHeight*this._fontSizeFraction;for(var m=f,n=d.length+f;m<=n;m++){var p=p||this.getCurrentCharStyle(h,m);var q=this.getCurrentCharStyle(h,m+1);if(this._hasStyleChanged(p,
q)||m===n)this._renderChar(b,c,h,m-1,k,a,e,g),k="",p=q;k+=d[m-f]}c.restore()},_renderCharsFast:function(b,c,d,a,e){"fillText"===b&&this.fill&&this.callSuper("_renderChars",b,c,d,a,e);"strokeText"===b&&(this.stroke&&0<this.strokeWidth||this.skipFillStrokeCheck)&&this.callSuper("_renderChars",b,c,d,a,e)},_renderChar:function(b,c,d,a,e,h,f,l){var g=this._getStyleDeclaration(d,a);if(g){var m=this._getHeightOfChar(c,e,d,a);var n=g.stroke;var p=g.fill;var q=g.textDecoration}else m=this.fontSize;n=(n||this.stroke)&&
"strokeText"===b;p=(p||this.fill)&&"fillText"===b;g&&c.save();b=this._applyCharStylesGetWidth(c,e,d,a,g||null);q=q||this.textDecoration;g&&g.textBackgroundColor&&this._removeShadow(c);if(0!==this.charSpacing){d=this._getWidthOfCharSpacing();e=e.split("");a=b=0;for(var t=e.length;a<t;a++){var r=e[a];p&&c.fillText(r,h+b,f);n&&c.strokeText(r,h+b,f);r=c.measureText(r).width+d;b+=0<r?r:0}}else p&&c.fillText(e,h,f),n&&c.strokeText(e,h,f);if(q||""!==q)l=this._fontSizeFraction*l/this.lineHeight,this._renderCharDecoration(c,
q,h,f,l,b,m);g&&c.restore();c.translate(b,0)},_hasStyleChanged:function(b,c){return b.fill!==c.fill||b.fontSize!==c.fontSize||b.textBackgroundColor!==c.textBackgroundColor||b.textDecoration!==c.textDecoration||b.fontFamily!==c.fontFamily||b.fontWeight!==c.fontWeight||b.fontStyle!==c.fontStyle||b.stroke!==c.stroke||b.strokeWidth!==c.strokeWidth},_renderCharDecoration:function(b,c,d,a,e,h,f){if(c){e=f/15;a={underline:a+f/10,"line-through":a-f*(this._fontSizeFraction+this._fontSizeMult-1)+e,overline:a-
(this._fontSizeMult-this._fontSizeFraction)*f};f=["underline","line-through","overline"];var g;for(g=0;g<f.length;g++){var k=f[g];-1<c.indexOf(k)&&b.fillRect(d,a[k],h,e)}}},_renderTextLine:function(b,c,d,a,e,h){this.isEmptyStyles()||(e+=this.fontSize*(this._fontSizeFraction+.03));this.callSuper("_renderTextLine",b,c,d,a,e,h)},_renderTextDecoration:function(b){if(this.isEmptyStyles())return this.callSuper("_renderTextDecoration",b)},_renderTextLinesBackground:function(b){this.callSuper("_renderTextLinesBackground",
b);var c=0,d=this._getLeftOffset(),a=this._getTopOffset(),e="",h,f,l,k;b.save();for(var m=0,n=this._textLines.length;m<n;m++){var p=this._getHeightOfLine(b,m);var q=this._textLines[m];if(""!==q&&this.styles&&this._getLineStyle(m)){var t=this._getLineWidth(b,m);t=this._getLineLeftOffset(t);for(var r=h=f=l=k=0,w=q.length;r<w;r++){var z=this._getStyleDeclaration(m,r)||{};e!==z.textBackgroundColor&&(k&&l&&(b.fillStyle=e,b.fillRect(h,f,l,k)),h=f=l=k=0,e=z.textBackgroundColor||"");if(z.textBackgroundColor){var v=
q[r];e===z.textBackgroundColor&&(e=z.textBackgroundColor,h||(h=d+t+this._getWidthOfCharsAt(b,m,r)),f=a+c,l+=this._getWidthOfChar(b,v,m,r),k=p/this.lineHeight)}else e=""}k&&l&&(b.fillStyle=e,b.fillRect(h,f,l,k))}c+=p}b.restore()},_getCacheProp:function(b,c){return b+c.fontSize+c.fontWeight+c.fontStyle},_getFontCache:function(b){fabric.charWidthsCache[b]||(fabric.charWidthsCache[b]={});return fabric.charWidthsCache[b]},_applyCharStylesGetWidth:function(b,c,d,a,g){var h=g||this._getStyleDeclaration(d,
a);g=e(h);this._applyFontStyles(g);a=this._getFontCache(g.fontFamily);d=this._getCacheProp(c,g);if(!h&&a[d]&&this.caching)return a[d];"string"===typeof g.shadow&&(g.shadow=new fabric.Shadow(g.shadow));h=g.fill||this.fill;b.fillStyle=h.toLive?h.toLive(b,this):h;g.stroke&&(b.strokeStyle=g.stroke&&g.stroke.toLive?g.stroke.toLive(b,this):g.stroke);b.lineWidth=g.strokeWidth||this.strokeWidth;b.font=this._getFontDeclaration.call(g);g.shadow&&(g.scaleX=this.scaleX,g.scaleY=this.scaleY,g.canvas=this.canvas,
g.getObjectScaling=this.getObjectScaling,this._setShadow.call(g,b));return this.caching&&a[d]?a[d]:(b=b.measureText(c).width,this.caching&&(a[d]=b),b)},_applyFontStyles:function(b){b.fontFamily||(b.fontFamily=this.fontFamily);b.fontSize||(b.fontSize=this.fontSize);b.fontWeight||(b.fontWeight=this.fontWeight);b.fontStyle||(b.fontStyle=this.fontStyle)},_getStyleDeclaration:function(b,c,d){return d?this.styles[b]&&this.styles[b][c]?e(this.styles[b][c]):{}:this.styles[b]&&this.styles[b][c]?this.styles[b][c]:
null},_setStyleDeclaration:function(b,c,d){this.styles[b][c]=d},_deleteStyleDeclaration:function(b,c){delete this.styles[b][c]},_getLineStyle:function(b){return this.styles[b]},_setLineStyle:function(b,c){this.styles[b]=c},_deleteLineStyle:function(b){delete this.styles[b]},_getWidthOfChar:function(b,c,d,a){if(!this._isMeasuring&&"justify"===this.textAlign&&this._reSpacesAndTabs.test(c))return this._getWidthOfSpace(b,d);b.save();c=this._applyCharStylesGetWidth(b,c,d,a);0!==this.charSpacing&&(c+=this._getWidthOfCharSpacing());
b.restore();return 0<c?c:0},_getHeightOfChar:function(b,c,d){return(b=this._getStyleDeclaration(c,d))&&b.fontSize?b.fontSize:this.fontSize},_getWidthOfCharsAt:function(b,c,d){var a=0,e;for(e=0;e<d;e++){var h=this._textLines[c][e];a+=this._getWidthOfChar(b,h,c,e)}return a},_measureLine:function(b,c){this._isMeasuring=!0;b=this._getWidthOfCharsAt(b,c,this._textLines[c].length);0!==this.charSpacing&&(b-=this._getWidthOfCharSpacing());this._isMeasuring=!1;return 0<b?b:0},_getWidthOfSpace:function(b,c){if(this.__widthOfSpace[c])return this.__widthOfSpace[c];
var d=this._textLines[c],a=this._getWidthOfWords(b,d,c,0);a=this.width-a;d=d.length-d.replace(this._reSpacesAndTabs,"").length;b=Math.max(a/d,b.measureText(" ").width);return this.__widthOfSpace[c]=b},_getWidthOfWords:function(b,c,d,a){for(var e=0,h=0;h<c.length;h++){var f=c[h];f.match(/\s/)||(e+=this._getWidthOfChar(b,f,d,h+a))}return e},_getHeightOfLine:function(b,c){if(this.__lineHeights[c])return this.__lineHeights[c];var d=this._textLines[c],a=this._getHeightOfChar(b,c,0),e=1;for(d=d.length;e<
d;e++){var h=this._getHeightOfChar(b,c,e);h>a&&(a=h)}this.__lineHeights[c]=a*this.lineHeight*this._fontSizeMult;return this.__lineHeights[c]},_getTextHeight:function(b){for(var c,d=0,a=0,e=this._textLines.length;a<e;a++)c=this._getHeightOfLine(b,a),d+=a===e-1?c/this.lineHeight:c;return d},toObject:function(b){return fabric.util.object.extend(this.callSuper("toObject",b),{styles:e(this.styles,!0)})}});fabric.IText.fromObject=function(b,c,d){return fabric.Object._fromObject("IText",b,c,d,"text")}})();
(function(){var e=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initAddedHandler();this.initRemovedHandler();this.initCursorSelectionHandlers();this.initDoubleClickSimulation();this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing();this.selected=!1;this.callSuper("onDeselect")},initAddedHandler:function(){var b=this;this.on("added",function(){var c=b.canvas;c&&(c._hasITextHandlers||
(c._hasITextHandlers=!0,b._initCanvasHandlers(c)),c._iTextInstances=c._iTextInstances||[],c._iTextInstances.push(b))})},initRemovedHandler:function(){var b=this;this.on("removed",function(){var c=b.canvas;c&&(c._iTextInstances=c._iTextInstances||[],fabric.util.removeFromArray(c._iTextInstances,b),0===c._iTextInstances.length&&(c._hasITextHandlers=!1,b._removeCanvasHandlers(c)))})},_initCanvasHandlers:function(b){b._mouseUpITextHandler=function(){b._iTextInstances&&b._iTextInstances.forEach(function(b){b.__isMousedown=
!1})}.bind(this);b.on("mouse:up",b._mouseUpITextHandler)},_removeCanvasHandlers:function(b){b.off("mouse:up",b._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(b,c,d,a){var e={isAborted:!1,abort:function(){this.isAborted=!0}};b.animate("_currentCursorOpacity",c,{duration:d,onComplete:function(){if(!e.isAborted)b[a]()},onChange:function(){b.canvas&&b.selectionStart===b.selectionEnd&&b.renderCursorOrSelection()},
abort:function(){return e.isAborted}});return e},_onTickComplete:function(){var b=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1);this._cursorTimeout1=setTimeout(function(){b._currentTickCompleteState=b._animateCursor(b,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(b){var c=this;b=b?0:this.cursorDelay;this.abortCursorAnimation();this._currentCursorOpacity=1;this._cursorTimeout2=setTimeout(function(){c._tick()},b)},abortCursorAnimation:function(){var b=this._currentTickState||
this._currentTickCompleteState;this._currentTickState&&this._currentTickState.abort();this._currentTickCompleteState&&this._currentTickCompleteState.abort();clearTimeout(this._cursorTimeout1);clearTimeout(this._cursorTimeout2);this._currentCursorOpacity=0;b&&this.canvas&&this.canvas.clearContext(this.canvas.contextTop||this.ctx)},selectAll:function(){this.selectionStart=0;this.selectionEnd=this.text.length;this._fireSelectionChanged();this._updateTextarea()},getSelectedText:function(){return this.text.slice(this.selectionStart,
this.selectionEnd)},findWordBoundaryLeft:function(b){var c=0,d=b-1;if(this._reSpace.test(this.text.charAt(d)))for(;this._reSpace.test(this.text.charAt(d));)c++,d--;for(;/\S/.test(this.text.charAt(d))&&-1<d;)c++,d--;return b-c},findWordBoundaryRight:function(b){var c=0,d=b;if(this._reSpace.test(this.text.charAt(d)))for(;this._reSpace.test(this.text.charAt(d));)c++,d++;for(;/\S/.test(this.text.charAt(d))&&d<this.text.length;)c++,d++;return b+c},findLineBoundaryLeft:function(b){for(var c=0,d=b-1;!/\n/.test(this.text.charAt(d))&&
-1<d;)c++,d--;return b-c},findLineBoundaryRight:function(b){for(var c=0,d=b;!/\n/.test(this.text.charAt(d))&&d<this.text.length;)c++,d++;return b+c},getNumNewLinesInSelectedText:function(){for(var b=this.getSelectedText(),c=0,d=0,a=b.length;d<a;d++)"\n"===b[d]&&c++;return c},searchWordBoundary:function(b,c){b=this._reSpace.test(this.text.charAt(b))?b-1:b;for(var d=this.text.charAt(b),a=/[ \n\.,;!\?\-]/;!a.test(d)&&0<b&&b<this.text.length;)b+=c,d=this.text.charAt(b);a.test(d)&&"\n"!==d&&(b+=1===c?
0:1);return b},selectWord:function(b){b=b||this.selectionStart;var c=this.searchWordBoundary(b,-1);b=this.searchWordBoundary(b,1);this.selectionStart=c;this.selectionEnd=b;this._fireSelectionChanged();this._updateTextarea();this.renderCursorOrSelection()},selectLine:function(b){b=b||this.selectionStart;var c=this.findLineBoundaryLeft(b);b=this.findLineBoundaryRight(b);this.selectionStart=c;this.selectionEnd=b;this._fireSelectionChanged();this._updateTextarea()},enterEditing:function(b){if(!this.isEditing&&
this.editable){this.canvas&&this.exitEditingOnOthers(this.canvas);this.selected=this.isEditing=!0;this.initHiddenTextarea(b);this.hiddenTextarea.focus();this._updateTextarea();this._saveEditingProps();this._setEditingProps();this._textBeforeEdit=this.text;this._tick();this.fire("editing:entered");this._fireSelectionChanged();if(!this.canvas)return this;this.canvas.fire("text:editing:entered",{target:this});this.initMouseMoveHandler();this.canvas.renderAll();return this}},exitEditingOnOthers:function(b){b._iTextInstances&&
b._iTextInstances.forEach(function(b){b.selected=!1;b.isEditing&&b.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(b){if(this.__isMousedown&&this.isEditing){b=this.getSelectionStartFromPointer(b.e);var c=this.selectionStart,d=this.selectionEnd;if(b===this.__selectionStartOnMouseDown&&c!==d||c!==b&&d!==b)if(b>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=b):(this.selectionStart=
b,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart!==c||this.selectionEnd!==d)this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()}},_setEditingProps:function(){this.hoverCursor="text";this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text");this.borderColor=this.editingBorderColor;this.hasControls=this.selectable=!1;this.lockMovementX=this.lockMovementY=!0},_updateTextarea:function(){if(this.hiddenTextarea&&
!this.inCompositionMode&&(this.cursorOffsetCache={},this.hiddenTextarea.value=this.text,this.hiddenTextarea.selectionStart=this.selectionStart,this.hiddenTextarea.selectionEnd=this.selectionEnd,this.selectionStart===this.selectionEnd)){var b=this._calcTextareaPosition();this.hiddenTextarea.style.left=b.left;this.hiddenTextarea.style.top=b.top;this.hiddenTextarea.style.fontSize=b.fontSize}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var b=this.text.split(""),c=this._getCursorBoundaries(b,
"cursor");b=this.get2DCursorLocation();b=this.getCurrentCharFontSize(b.lineIndex,b.charIndex);var d=c.leftOffset,a=this.calcTransformMatrix();c={x:c.left+d,y:c.top+c.topOffset+b};var e=this.canvas.upperCanvasEl;d=e.width-b;e=e.height-b;c=fabric.util.transformPoint(c,a);c=fabric.util.transformPoint(c,this.canvas.viewportTransform);0>c.x&&(c.x=0);c.x>d&&(c.x=d);0>c.y&&(c.y=0);c.y>e&&(c.y=e);c.x+=this.canvas._offset.left;c.y+=this.canvas._offset.top;return{left:c.x+"px",top:c.y+"px",fontSize:b}},_saveEditingProps:function(){this._savedProps=
{hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.overCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=
this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var b=this._textBeforeEdit!==this.text;this.isEditing=this.selected=!1;this.selectable=!0;this.selectionEnd=this.selectionStart;this.hiddenTextarea&&(this.hiddenTextarea.blur&&this.hiddenTextarea.blur(),this.canvas&&this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea),this.hiddenTextarea=null);this.abortCursorAnimation();
this._restoreEditingProps();this._currentCursorOpacity=0;this.fire("editing:exited");b&&this.fire("modified");this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),b&&this.canvas.fire("object:modified",{target:this}));return this},_removeExtraneousStyles:function(){for(var b in this.styles)this._textLines[b]||delete this.styles[b]},_removeCharsFromTo:function(b,c){for(;c!==b;)this._removeSingleCharAndStyle(b+1),c--;this.selectionEnd=
this.selectionStart=b},_removeSingleCharAndStyle:function(b){var c="\n"===this.text[b-1];this.removeStyleObject(c,c?b:b-1);this.text=this.text.slice(0,b-1)+this.text.slice(b);this._textLines=this._splitTextIntoLines()},insertChars:function(b,c){var d;1<this.selectionEnd-this.selectionStart&&this._removeCharsFromTo(this.selectionStart,this.selectionEnd);if(!c&&this.isEmptyStyles())this.insertChar(b,!1);else for(var a=0,e=b.length;a<e;a++)c&&(d=fabric.util.object.clone(fabric.copiedTextStyle[a],!0)),
this.insertChar(b[a],a<e-1,d)},insertChar:function(b,c,d){var a="\n"===this.text[this.selectionStart];this.text=this.text.slice(0,this.selectionStart)+b+this.text.slice(this.selectionEnd);this._textLines=this._splitTextIntoLines();this.insertStyleObjects(b,a,d);this.selectionEnd=this.selectionStart+=b.length;c||(this._updateTextarea(),this.setCoords(),this._fireSelectionChanged(),this.fire("changed"),this.restartCursorIfNeeded(),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.renderAll()))},
restartCursorIfNeeded:function(){this._currentTickState&&!this._currentTickState.isAborted&&this._currentTickCompleteState&&!this._currentTickCompleteState.isAborted||this.initDelayedCursor()},insertNewlineStyleObject:function(b,c,d){this.shiftLineStyles(b,1);var a={},g={};this.styles[b]&&this.styles[b][c-1]&&(a=this.styles[b][c-1]);if(d&&a)g[0]=e(a),this.styles[b+1]=g;else{d=!1;for(var h in this.styles[b])a=parseInt(h,10),a>=c&&(d=!0,g[a-c]=this.styles[b][h],delete this.styles[b][h]);d&&(this.styles[b+
1]=g)}this._forceClearCache=!0},insertCharStyleObject:function(b,c,d){var a=this.styles[b],g=e(a);0!==c||d||(c=1);for(var h in g){var f=parseInt(h,10);f>=c&&(a[f+1]=g[f],g[f-1]||delete a[f])}(d=d||e(a[c-1]))&&(this.styles[b][c]=d);this._forceClearCache=!0},insertStyleObjects:function(b,c,d){var a=this.get2DCursorLocation(),e=a.lineIndex;a=a.charIndex;this._getLineStyle(e)||this._setLineStyle(e,{});"\n"===b?this.insertNewlineStyleObject(e,a,c):this.insertCharStyleObject(e,a,d)},shiftLineStyles:function(b,
c){var d=e(this.styles),a;for(a in d){var g=parseInt(a,10);g<=b&&delete d[g]}for(a in this.styles)g=parseInt(a,10),g>b&&(this.styles[g+c]=d[g],d[g-c]||delete this.styles[g])},removeStyleObject:function(b,c){c=this.get2DCursorLocation(c);this._removeStyleObject(b,c,c.lineIndex,c.charIndex)},_getTextOnPreviousLine:function(b){return this._textLines[b-1]},_removeStyleObject:function(b,c,d,a){if(b){var g=this._getTextOnPreviousLine(c.lineIndex);g=g?g.length:0;this.styles[d-1]||(this.styles[d-1]={});for(a in this.styles[d])this.styles[d-
1][parseInt(a,10)+g]=this.styles[d][a];this.shiftLineStyles(c.lineIndex,-1)}else for(g in(c=this.styles[d])&&delete c[a],d=e(c),d)b=parseInt(g,10),b>=a&&0!==b&&(c[b-1]=d[b],delete c[b])},insertNewline:function(){this.insertChars("\n")},setSelectionStartEndWithShift:function(b,c,d){d<=b?(c===b?this._selectionDirection="left":"right"===this._selectionDirection&&(this._selectionDirection="left",this.selectionEnd=b),this.selectionStart=d):d>b&&d<c?"right"===this._selectionDirection?this.selectionEnd=
d:this.selectionStart=d:(c===b?this._selectionDirection="right":"left"===this._selectionDirection&&(this._selectionDirection="right",this.selectionStart=c),this.selectionEnd=d)},setSelectionInBoundaries:function(){var b=this.text.length;this.selectionStart>b?this.selectionStart=b:0>this.selectionStart&&(this.selectionStart=0);this.selectionEnd>b?this.selectionEnd=b:0>this.selectionEnd&&(this.selectionEnd=0)}})})();
fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date;this.__lastLastClickTime=+new Date;this.__lastPointer={};this.on("mousedown",this.onMouseDown.bind(this))},onMouseDown:function(e){this.__newClickTime=+new Date;var b=this.canvas.getPointer(e.e);this.isTripleClick(b,e.e)?(this.fire("tripleclick",e),this._stopEvent(e.e)):this.isDoubleClick(b)&&(this.fire("dblclick",e),this._stopEvent(e.e));this.__lastLastClickTime=this.__lastClickTime;
this.__lastClickTime=this.__newClickTime;this.__lastPointer=b;this.__lastIsEditing=this.isEditing;this.__lastSelected=this.selected},isDoubleClick:function(e){return 500>this.__newClickTime-this.__lastClickTime&&this.__lastPointer.x===e.x&&this.__lastPointer.y===e.y&&this.__lastIsEditing},isTripleClick:function(e){return 500>this.__newClickTime-this.__lastClickTime&&500>this.__lastClickTime-this.__lastLastClickTime&&this.__lastPointer.x===e.x&&this.__lastPointer.y===e.y},_stopEvent:function(e){e.preventDefault&&
e.preventDefault();e.stopPropagation&&e.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler();this.initMouseupHandler();this.initClicks()},initClicks:function(){this.on("dblclick",function(e){this.selectWord(this.getSelectionStartFromPointer(e.e))});this.on("tripleclick",function(e){this.selectLine(this.getSelectionStartFromPointer(e.e))})},initMousedownHandler:function(){this.on("mousedown",function(e){if(this.editable&&(!e.e.button||1===e.e.button)){var b=this.canvas.getPointer(e.e);
this.__mousedownX=b.x;this.__mousedownY=b.y;this.__isMousedown=!0;this.selected&&this.setCursorByClick(e.e);this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection())}})},_isObjectMoved:function(e){e=this.canvas.getPointer(e);return this.__mousedownX!==e.x||this.__mousedownY!==e.y},initMouseupHandler:function(){this.on("mouseup",function(e){this.__isMousedown=!1;!this.editable||this._isObjectMoved(e.e)||
e.e.button&&1!==e.e.button||(this.__lastSelected&&!this.__corner&&(this.enterEditing(e.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()),this.selected=!0)})},setCursorByClick:function(e){var b=this.getSelectionStartFromPointer(e),c=this.selectionStart,d=this.selectionEnd;e.shiftKey?this.setSelectionStartEndWithShift(c,d,b):this.selectionEnd=this.selectionStart=b;this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(e){e=
this.getLocalPointer(e);for(var b=0,c,d=0,a=0,g,h=0,f=this._textLines.length;h<f;h++){g=this._textLines[h];d+=this._getHeightOfLine(this.ctx,h)*this.scaleY;c=this._getLineWidth(this.ctx,h);c=this._getLineLeftOffset(c)*this.scaleX;for(var l=0,k=g.length;l<k;l++)if(b=c,c+=this._getWidthOfChar(this.ctx,g[l],h,this.flipX?k-l:l)*this.scaleX,d<=e.y||c<=e.x)a++;else return this._getNewSelectionStartFromOffset(e,b,c,a+h,k);if(e.y<d)return this._getNewSelectionStartFromOffset(e,b,c,a+h-1,k)}return this.text.length},
_getNewSelectionStartFromOffset:function(e,b,c,d,a){e=d+(c-e.x>e.x-b?0:1);this.flipX&&(e=a-e);e>this.text.length&&(e=this.text.length);return e}});
fabric.util.object.extend(fabric.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement("textarea");this.hiddenTextarea.setAttribute("autocapitalize","off");this.hiddenTextarea.setAttribute("autocorrect","off");this.hiddenTextarea.setAttribute("autocomplete","off");this.hiddenTextarea.setAttribute("spellcheck","false");this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea","");this.hiddenTextarea.setAttribute("wrap","off");var e=this._calcTextareaPosition();
this.hiddenTextarea.style.cssText="position: absolute; top: "+e.top+"; left: "+e.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; line-height: 1px; padding\uff70top: "+e.fontSize+";";fabric.document.body.appendChild(this.hiddenTextarea);fabric.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this));fabric.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this));fabric.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this));fabric.util.addListener(this.hiddenTextarea,
"copy",this.copy.bind(this));fabric.util.addListener(this.hiddenTextarea,"cut",this.cut.bind(this));fabric.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this));fabric.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this));fabric.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this));fabric.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this));!this._clickHandlerInitialized&&
this.canvas&&(fabric.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{8:"removeChars",9:"exitEditing",27:"exitEditing",13:"insertNewline",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown",46:"forwardDelete"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},
onKeyDown:function(e){if(this.isEditing){if(e.keyCode in this.keysMap)this[this.keysMap[e.keyCode]](e);else if(e.keyCode in this.ctrlKeysMapDown&&(e.ctrlKey||e.metaKey))this[this.ctrlKeysMapDown[e.keyCode]](e);else return;e.stopImmediatePropagation();e.preventDefault();33<=e.keyCode&&40>=e.keyCode?(this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.renderAll()}},onKeyUp:function(e){!this.isEditing||this._copyDone?this._copyDone=!1:e.keyCode in this.ctrlKeysMapUp&&(e.ctrlKey||
e.metaKey)&&(this[this.ctrlKeysMapUp[e.keyCode]](e),e.stopImmediatePropagation(),e.preventDefault(),this.canvas&&this.canvas.renderAll())},onInput:function(e){if(this.isEditing&&!this.inCompositionMode){var b=this.selectionStart||0,c=this.selectionEnd||0,d=this.text.length,a=this.hiddenTextarea.value.length;a>d?(b="left"===this._selectionDirection?c:b,d=this.hiddenTextarea.value.slice(b,b+(a-d))):d=this.hiddenTextarea.value.slice(b,b+(a-d+c-b));this.insertChars(d);e.stopPropagation()}},onCompositionStart:function(){this.inCompositionMode=
!0;this.prevCompositionLength=0;this.compositionStart=this.selectionStart},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(e){e=e.data;this.selectionStart=this.compositionStart;this.selectionEnd=this.selectionEnd===this.selectionStart?this.compositionStart+this.prevCompositionLength:this.selectionEnd;this.insertChars(e,!1);this.prevCompositionLength=e.length},forwardDelete:function(e){if(this.selectionStart===this.selectionEnd){if(this.selectionStart===this.text.length)return;
this.moveCursorRight(e)}this.removeChars(e)},copy:function(e){if(this.selectionStart!==this.selectionEnd){var b=this.getSelectedText(),c=this._getClipboardData(e);c&&c.setData("text",b);fabric.copiedText=b;fabric.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd);e.stopImmediatePropagation();e.preventDefault();this._copyDone=!0}},paste:function(e){var b=this._getClipboardData(e);var c=!0;b?(b=b.getData("text").replace(/\r/g,""),fabric.copiedTextStyle&&fabric.copiedText===
b||(c=!1)):b=fabric.copiedText;b&&this.insertChars(b,c);e.stopImmediatePropagation();e.preventDefault()},cut:function(e){this.selectionStart!==this.selectionEnd&&(this.copy(e),this.removeChars(e))},_getClipboardData:function(e){return e&&e.clipboardData||fabric.window.clipboardData},_getWidthBeforeCursor:function(e,b){b=this._textLines[e].slice(0,b);var c=this._getLineWidth(this.ctx,e);c=this._getLineLeftOffset(c);for(var d,a=0,g=b.length;a<g;a++)d=b[a],c+=this._getWidthOfChar(this.ctx,d,e,a);return c},
getDownCursorOffset:function(e,b){var c=this._getSelectionForOffset(e,b),d=this.get2DCursorLocation(c);b=d.lineIndex;if(b===this._textLines.length-1||e.metaKey||34===e.keyCode)return this.text.length-c;e=d.charIndex;c=this._getWidthBeforeCursor(b,e);c=this._getIndexOnLine(b+1,c);return this._textLines[b].slice(e).length+c+2},_getSelectionForOffset:function(e,b){return e.shiftKey&&this.selectionStart!==this.selectionEnd&&b?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(e,b){var c=
this._getSelectionForOffset(e,b),d=this.get2DCursorLocation(c);b=d.lineIndex;if(0===b||e.metaKey||33===e.keyCode)return-c;e=d.charIndex;c=this._getWidthBeforeCursor(b,e);c=this._getIndexOnLine(b-1,c);e=this._textLines[b].slice(0,e);return-this._textLines[b-1].length+c-e.length},_getIndexOnLine:function(e,b){var c=this._getLineWidth(this.ctx,e),d=this._textLines[e];c=this._getLineLeftOffset(c);for(var a=0,g,h=0,f=d.length;h<f;h++){var l=this._getWidthOfChar(this.ctx,d[h],e,h);c+=l;if(c>b){g=!0;a=Math.abs(c-
b)<Math.abs(c-l-b)?h:h-1;break}}g||(a=d.length-1);return a},moveCursorDown:function(e){this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length||this._moveCursorUpOrDown("Down",e)},moveCursorUp:function(e){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorUpOrDown("Up",e)},_moveCursorUpOrDown:function(e,b){e=this["get"+e+"CursorOffset"](b,"right"===this._selectionDirection);b.shiftKey?this.moveCursorWithShift(e):this.moveCursorWithoutShift(e);0!==e&&(this.setSelectionInBoundaries(),
this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(e){this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,"left"===this._selectionDirection?this.selectionStart+e:this.selectionEnd+e);return 0!==e},moveCursorWithoutShift:function(e){0>e?this.selectionEnd=this.selectionStart+=e:this.selectionStart=this.selectionEnd+=e;return 0!==e},moveCursorLeft:function(e){0===this.selectionStart&&
0===this.selectionEnd||this._moveCursorLeftOrRight("Left",e)},_move:function(e,b,c){if(e.altKey)e=this["findWordBoundary"+c](this[b]);else if(e.metaKey||35===e.keyCode||36===e.keyCode)e=this["findLineBoundary"+c](this[b]);else return this[b]+="Left"===c?-1:1,!0;if(this[b]!==e)return this[b]=e,!0},_moveLeft:function(e,b){return this._move(e,b,"Left")},_moveRight:function(e,b){return this._move(e,b,"Right")},moveCursorLeftWithoutShift:function(e){var b=!0;this._selectionDirection="left";this.selectionEnd===
this.selectionStart&&0!==this.selectionStart&&(b=this._moveLeft(e,"selectionStart"));this.selectionEnd=this.selectionStart;return b},moveCursorLeftWithShift:function(e){if("right"===this._selectionDirection&&this.selectionStart!==this.selectionEnd)return this._moveLeft(e,"selectionEnd");if(0!==this.selectionStart)return this._selectionDirection="left",this._moveLeft(e,"selectionStart")},moveCursorRight:function(e){this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length||this._moveCursorLeftOrRight("Right",
e)},_moveCursorLeftOrRight:function(e,b){e="moveCursor"+e+"With";this._currentCursorOpacity=1;e=b.shiftKey?e+"Shift":e+"outShift";this[e](b)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(e){if("left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd)return this._moveRight(e,"selectionStart");if(this.selectionEnd!==this.text.length)return this._selectionDirection="right",this._moveRight(e,
"selectionEnd")},moveCursorRightWithoutShift:function(e){var b=!0;this._selectionDirection="right";this.selectionStart===this.selectionEnd?(b=this._moveRight(e,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd;return b},removeChars:function(e){this.selectionStart===this.selectionEnd?this._removeCharsNearCursor(e):this._removeCharsFromTo(this.selectionStart,this.selectionEnd);this.set("dirty",!0);this.setSelectionEnd(this.selectionStart);this._removeExtraneousStyles();
this.canvas&&this.canvas.renderAll();this.setCoords();this.fire("changed");this.canvas&&this.canvas.fire("text:changed",{target:this})},_removeCharsNearCursor:function(e){0!==this.selectionStart&&(e.metaKey?(e=this.findLineBoundaryLeft(this.selectionStart),this._removeCharsFromTo(e,this.selectionStart),this.setSelectionStart(e)):e.altKey?(e=this.findWordBoundaryLeft(this.selectionStart),this._removeCharsFromTo(e,this.selectionStart),this.setSelectionStart(e)):(this._removeSingleCharAndStyle(this.selectionStart),
this.setSelectionStart(this.selectionStart-1)))}});
(function(){var e=fabric.util.toFixed,b=fabric.Object.NUM_FRACTION_DIGITS;fabric.util.object.extend(fabric.IText.prototype,{_setSVGTextLineText:function(b,d,a,e,h,f){this._getLineStyle(b)?this._setSVGTextLineChars(b,d,a,e,f):fabric.Text.prototype._setSVGTextLineText.call(this,b,d,a,e,h)},_setSVGTextLineChars:function(b,d,a,e,h){a=this._textLines[b];e=0;for(var c=this._getLineLeftOffset(this._getLineWidth(this.ctx,b))-this.width/2,g=this._getSVGLineTopOffset(b),k=this._getHeightOfLine(this.ctx,b),
m=0,n=a.length;m<n;m++){var p=this._getStyleDeclaration(b,m)||{};d.push(this._createTextCharSpan(a[m],p,c,g.lineTop+g.offset,e));var q=this._getWidthOfChar(this.ctx,a[m],b,m);p.textBackgroundColor&&h.push(this._createTextCharBg(p,c,g.lineTop,k,q,e));e+=q}},_getSVGLineTopOffset:function(b){for(var c=0,a=0;a<b;a++)c+=this._getHeightOfLine(this.ctx,a);b=this._getHeightOfLine(this.ctx,a);return{lineTop:c,offset:(this._fontSizeMult-this._fontSizeFraction)*b/(this.lineHeight*this._fontSizeMult)}},_createTextCharBg:function(c,
d,a,g,h,f){return['\t\t<rect fill="',c.textBackgroundColor,'" x="',e(d+f,b),'" y="',e(a-this.height/2,b),'" width="',e(h,b),'" height="',e(g/this.lineHeight,b),'"></rect>\n'].join("")},_createTextCharSpan:function(c,d,a,g,h){var f=this.getSvgStyles.call(fabric.util.object.extend({visible:!0,fill:this.fill,stroke:this.stroke,type:"text",getSvgFilter:fabric.Object.prototype.getSvgFilter},d));return['\t\t\t<tspan x="',e(a+h,b),'" y="',e(g-this.height/2,b),'" ',d.fontFamily?'font-family="'+d.fontFamily.replace(/"/g,
"'")+'" ':"",d.fontSize?'font-size="'+d.fontSize+'" ':"",d.fontStyle?'font-style="'+d.fontStyle+'" ':"",d.fontWeight?'font-weight="'+d.fontWeight+'" ':"",d.textDecoration?'text-decoration="'+d.textDecoration+'" ':"",'style="',f,'">',fabric.util.string.escapeXml(c),"</tspan>\n"].join("")}})})();
(function(e){var b=e.fabric||(e.fabric={});b.Textbox=b.util.createClass(b.IText,b.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingY:!0,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:b.Text.prototype._dimensionAffectingProps.concat("width"),initialize:function(c,d){this.callSuper("initialize",c,d);this.setControlsVisibility(b.Textbox.getTextboxControlVisibility());this.ctx=this.objectCaching?this._cacheContext:b.util.createCanvasElement().getContext("2d")},
_initDimensions:function(c){this.__skipDimension||(c||(c=b.util.createCanvasElement().getContext("2d"),this._setTextStyles(c),this.clearContextTop()),this.dynamicMinWidth=0,this._textLines=this._splitTextIntoLines(c),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this._clearCache(),this.height=this._getTextHeight(c),this.setCoords())},_generateStyleMap:function(){for(var b=0,d=0,a=0,e={},h=0;h<this._textLines.length;h++)"\n"===this.text[a]&&0<h?(d=0,a++,b++):" "===this.text[a]&&
0<h&&(d++,a++),e[h]={line:b,offset:d},a+=this._textLines[h].length,d+=this._textLines[h].length;return e},_getStyleDeclaration:function(b,d,a){if(this._styleMap){var c=this._styleMap[b];if(!c)return a?{}:null;b=c.line;d=c.offset+d}return this.callSuper("_getStyleDeclaration",b,d,a)},_setStyleDeclaration:function(b,d,a){var c=this._styleMap[b];b=c.line;d=c.offset+d;this.styles[b][d]=a},_deleteStyleDeclaration:function(b,d){var a=this._styleMap[b];b=a.line;d=a.offset+d;delete this.styles[b][d]},_getLineStyle:function(b){return this.styles[this._styleMap[b].line]},
_setLineStyle:function(b,d){this.styles[this._styleMap[b].line]=d},_deleteLineStyle:function(b){delete this.styles[this._styleMap[b].line]},_wrapText:function(b,d){d=d.split(this._reNewline);var a=[],c;for(c=0;c<d.length;c++)a=a.concat(this._wrapLine(b,d[c],c));return a},_measureText:function(b,d,a,e){var c=0;e=e||0;for(var f=0,g=d.length;f<g;f++)c+=this._getWidthOfChar(b,d[f],a,f+e);return c},_wrapLine:function(b,d,a){var c=0,e=[],f="";d=d.split(" ");for(var l,k=0,m,n=0,p=0,q=!0,t=this._getWidthOfCharSpacing(),
r=0;r<d.length;r++)l=d[r],m=this._measureText(b,l,a,k),k+=l.length,c+=n+m-t,c>=this.width&&!q?(e.push(f),f="",c=m,q=!0):c+=t,q||(f+=" "),f+=l,n=this._measureText(b," ",a,k),k++,q=!1,m>p&&(p=m);r&&e.push(f);p>this.dynamicMinWidth&&(this.dynamicMinWidth=p-t);return e},_splitTextIntoLines:function(b){b=b||this.ctx;var c=this.textAlign;this._styleMap=null;b.save();this._setTextStyles(b);this.textAlign="left";var a=this._wrapText(b,this.text);this.textAlign=c;b.restore();this._textLines=a;this._styleMap=
this._generateStyleMap();return a},setOnGroup:function(b,d){"scaleX"===b&&(this.set("scaleX",Math.abs(1/d)),this.set("width",this.get("width")*d/("undefined"===typeof this.__oldScaleX?1:this.__oldScaleX)),this.__oldScaleX=d)},get2DCursorLocation:function(b){"undefined"===typeof b&&(b=this.selectionStart);for(var c=this._textLines.length,a=0,e=0;e<c;e++){var h=this._textLines[e].length;if(b<=a+h)return{lineIndex:e,charIndex:b-a};a+=h;"\n"!==this.text[a]&&" "!==this.text[a]||a++}return{lineIndex:c-
1,charIndex:this._textLines[c-1].length}},_getCursorBoundariesOffsets:function(b,d){for(var a=b=0,c=this.get2DCursorLocation(),e=this._textLines[c.lineIndex].split(""),f=this._getLineLeftOffset(this._getLineWidth(this.ctx,c.lineIndex)),l=0;l<c.charIndex;l++)a+=this._getWidthOfChar(this.ctx,e[l],c.lineIndex,l);for(l=0;l<c.lineIndex;l++)b+=this._getHeightOfLine(this.ctx,l);"cursor"===d&&(b+=(1-this._fontSizeFraction)*this._getHeightOfLine(this.ctx,c.lineIndex)/this.lineHeight-this.getCurrentCharFontSize(c.lineIndex,
c.charIndex)*(1-this._fontSizeFraction));return{top:b,left:a,lineLeft:f}},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},toObject:function(b){return this.callSuper("toObject",["minWidth"].concat(b))}});b.Textbox.fromObject=function(c,d,a){return b.Object._fromObject("Textbox",c,d,a,"text")};b.Textbox.getTextboxControlVisibility=function(){return{tl:!1,tr:!1,br:!1,bl:!1,ml:!0,mt:!1,mr:!0,mb:!1,mtr:!0}}})("undefined"!==typeof exports?exports:this);
(function(){var e=fabric.Canvas.prototype._setObjectScale;fabric.Canvas.prototype._setObjectScale=function(b,c,d,a,g,h,f){var l=c.target;if(l instanceof fabric.Textbox){if(b=b.x/c.scaleX/(l.width+l.strokeWidth)*l.width,b>=l.getMinWidth())return l.set("width",b),!0}else return e.call(fabric.Canvas.prototype,b,c,d,a,g,h,f)};fabric.Group.prototype._refreshControlsVisibility=function(){if("undefined"!==typeof fabric.Textbox)for(var b=this._objects.length;b--;)if(this._objects[b]instanceof fabric.Textbox){this.setControlsVisibility(fabric.Textbox.getTextboxControlVisibility());
break}};fabric.util.object.extend(fabric.Textbox.prototype,{_removeExtraneousStyles:function(){for(var b in this._styleMap)this._textLines[b]||delete this.styles[this._styleMap[b].line]},insertCharStyleObject:function(b,c,d){var a=this._styleMap[b];b=a.line;c=a.offset+c;fabric.IText.prototype.insertCharStyleObject.apply(this,[b,c,d])},insertNewlineStyleObject:function(b,c,d){var a=this._styleMap[b];b=a.line;c=a.offset+c;fabric.IText.prototype.insertNewlineStyleObject.apply(this,[b,c,d])},shiftLineStyles:function(b,
c){b=this._styleMap[b].line;fabric.IText.prototype.shiftLineStyles.call(this,b,c)},_getTextOnPreviousLine:function(b){for(var c=this._textLines[b-1];this._styleMap[b-2]&&this._styleMap[b-2].line===this._styleMap[b-1].line;)c=this._textLines[b-2]+c,b--;return c},removeStyleObject:function(b,c){c=this.get2DCursorLocation(c);var d=this._styleMap[c.lineIndex];this._removeStyleObject(b,c,d.line,d.offset+c.charIndex)}})})();
(function(){var e=fabric.IText.prototype._getNewSelectionStartFromOffset;fabric.IText.prototype._getNewSelectionStartFromOffset=function(b,c,d,a,g){a=e.call(this,b,c,d,a,g);for(d=c=b=0;d<this._textLines.length;d++){b+=this._textLines[d].length;if(b+c>=a)break;"\n"!==this.text[b+c]&&" "!==this.text[b+c]||c++}return a-d+c}})();
(function(){function e(b,c,e){var f=d.parse(b);f.port||(f.port=0===f.protocol.indexOf("https:")?443:80);b=(0===f.protocol.indexOf("https:")?g:a).request({hostname:f.hostname,port:f.port,path:f.path,method:"GET"},function(b){var a="";c&&b.setEncoding(c);b.on("end",function(){e(a)});b.on("data",function(c){200===b.statusCode&&(a+=c)})});b.on("error",function(b){b.errno===process.ECONNREFUSED?fabric.log("ECONNREFUSED: connection refused to "+f.hostname+":"+f.port):fabric.log(b.message);e(null)});b.end()}
function b(b,a){require("fs").readFile(b,function(b,c){if(b)throw fabric.log(b),b;a(c)})}if("undefined"===typeof document||"undefined"===typeof window){var c=require("xmldom").DOMParser,d=require("url"),a=require("http"),g=require("https"),h=require("canvas"),f=require("canvas").Image;fabric.util.loadImage=function(a,c,d){function g(b){b?(h.src=new Buffer(b,"binary"),h._src=a,c&&c.call(d,h)):(h=null,c&&c.call(d,null,!0))}var h=new f;a&&(a instanceof Buffer||0===a.indexOf("data"))?(h.src=h._src=a,
c&&c.call(d,h)):a&&0!==a.indexOf("http")?b(a,g):a?e(a,"binary",g):c&&c.call(d,a)};fabric.loadSVGFromURL=function(a,c,d){a=a.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim();0!==a.indexOf("http")?b(a,function(a){fabric.loadSVGFromString(a.toString(),c,d)}):e(a,"",function(a){fabric.loadSVGFromString(a,c,d)})};fabric.loadSVGFromString=function(a,b,d){a=(new c).parseFromString(a);fabric.parseSVGDocument(a.documentElement,function(a,c){b&&b(a,c)},d)};fabric.util.getScript=function(a,b){e(a,"",function(a){eval(a);
b&&b()})};fabric.createCanvasForNode=function(a,b,c,d){d=d||c;var e=fabric.document.createElement("canvas"),f=new h(a||600,b||600,d);a=new h(a||600,b||600,d);e.style={};e.width=f.width;e.height=f.height;c=c||{};c.nodeCanvas=f;c.nodeCacheCanvas=a;c=new (fabric.Canvas||fabric.StaticCanvas)(e,c);c.nodeCanvas=f;c.nodeCacheCanvas=a;c.contextContainer=f.getContext("2d");c.contextCache=a.getContext("2d");c.Font=h.Font;return c};var l=fabric.StaticCanvas.prototype._initStatic;fabric.StaticCanvas.prototype._initStatic=
function(a,b){a=a||fabric.document.createElement("canvas");this.nodeCanvas=new h(a.width,a.height);this.nodeCacheCanvas=new h(a.width,a.height);l.call(this,a,b);this.contextContainer=this.nodeCanvas.getContext("2d");this.contextCache=this.nodeCacheCanvas.getContext("2d");this.Font=h.Font};fabric.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()};fabric.StaticCanvas.prototype.createJPEGStream=function(a){return this.nodeCanvas.createJPEGStream(a)};fabric.StaticCanvas.prototype._initRetinaScaling=
function(){if(this._isRetinaScaling())return this.lowerCanvasEl.setAttribute("width",this.width*fabric.devicePixelRatio),this.lowerCanvasEl.setAttribute("height",this.height*fabric.devicePixelRatio),this.nodeCanvas.width=this.width*fabric.devicePixelRatio,this.nodeCanvas.height=this.height*fabric.devicePixelRatio,this.contextContainer.scale(fabric.devicePixelRatio,fabric.devicePixelRatio),this};fabric.Canvas&&(fabric.Canvas.prototype._initRetinaScaling=fabric.StaticCanvas.prototype._initRetinaScaling);
var k=fabric.StaticCanvas.prototype._setBackstoreDimension;fabric.StaticCanvas.prototype._setBackstoreDimension=function(a,b){k.call(this,a,b);this.nodeCanvas[a]=b;return this};fabric.Canvas&&(fabric.Canvas.prototype._setBackstoreDimension=fabric.StaticCanvas.prototype._setBackstoreDimension)}})();
