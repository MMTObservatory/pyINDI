(function(m){m.plot.plugins.push({init:function(b){function r(a){c.active&&(t(a),b.getPlaceholder().trigger("plotselecting",[q()]))}function u(a){1==a.which&&(document.body.focus(),void 0!==document.onselectstart&&null==f.onselectstart&&(f.onselectstart=document.onselectstart,document.onselectstart=function(){return!1}),void 0!==document.ondrag&&null==f.ondrag&&(f.ondrag=document.ondrag,document.ondrag=function(){return!1}),v(c.first,a),c.active=!0,n=function(a){n=null;void 0!==document.onselectstart&&
(document.onselectstart=f.onselectstart);void 0!==document.ondrag&&(document.ondrag=f.ondrag);c.active=!1;t(a);p()?w():(b.getPlaceholder().trigger("plotunselected",[]),b.getPlaceholder().trigger("plotselecting",[null]))},m(document).one("mouseup",n))}function q(){if(!p()||!c.show)return null;var a={},e=c.first,l=c.second;m.each(b.getAxes(),function(c,b){if(b.used){var d=b.c2p(e[b.direction]);b=b.c2p(l[b.direction]);a[c]={from:Math.min(d,b),to:Math.max(d,b)}}});return a}function w(){var a=q();b.getPlaceholder().trigger("plotselected",
[a]);a.xaxis&&a.yaxis&&b.getPlaceholder().trigger("selected",[{x1:a.xaxis.from,y1:a.yaxis.from,x2:a.xaxis.to,y2:a.yaxis.to}])}function v(a,e){var l=b.getOptions(),d=b.getPlaceholder().offset(),k=b.getPlotOffset(),g=e.pageX-d.left-k.left,h=b.width();a.x=0>g?0:g>h?h:g;e=e.pageY-d.top-k.top;d=b.height();a.y=0>e?0:e>d?d:e;"y"==l.selection.mode&&(a.x=a==c.first?0:b.width());"x"==l.selection.mode&&(a.y=a==c.first?0:b.height())}function t(a){null!=a.pageX&&(v(c.second,a),p()?(c.show=!0,b.triggerRedrawOverlay()):
x(!0))}function x(a){c.show&&(c.show=!1,b.triggerRedrawOverlay(),a||b.getPlaceholder().trigger("plotunselected",[]))}function y(a,c){var e=b.getAxes(),d;for(d in e){var k=e[d];if(k.direction==c){var g=c+k.n+"axis";a[g]||1!=k.n||(g=c+"axis");if(a[g]){var h=a[g].from;var f=a[g].to;break}}}a[g]||(k="x"==c?b.getXAxes()[0]:b.getYAxes()[0],h=a[c+"1"],f=a[c+"2"]);null!=h&&null!=f&&h>f&&(a=h,h=f,f=a);return{from:h,to:f,axis:k}}function p(){var a=b.getOptions().selection.minSize;return Math.abs(c.second.x-
c.first.x)>=a&&Math.abs(c.second.y-c.first.y)>=a}var c={first:{x:-1,y:-1},second:{x:-1,y:-1},show:!1,active:!1},f={},n=null;b.clearSelection=x;b.setSelection=function(a,e){var l=b.getOptions();if("y"==l.selection.mode)c.first.x=0,c.second.x=b.width();else{var d=y(a,"x");c.first.x=d.axis.p2c(d.from);c.second.x=d.axis.p2c(d.to)}"x"==l.selection.mode?(c.first.y=0,c.second.y=b.height()):(d=y(a,"y"),c.first.y=d.axis.p2c(d.from),c.second.y=d.axis.p2c(d.to));c.show=!0;b.triggerRedrawOverlay();!e&&p()&&w()};
b.getSelection=q;b.hooks.bindEvents.push(function(a,c){null!=a.getOptions().selection.mode&&(c.mousemove(r),c.mousedown(u))});b.hooks.drawOverlay.push(function(a,b){if(c.show&&p()){var e=a.getPlotOffset();a=a.getOptions();b.save();b.translate(e.left,e.top);e=m.color.parse(a.selection.color);b.strokeStyle=e.scale("a",.8).toString();b.lineWidth=1;b.lineJoin=a.selection.shape;b.fillStyle=e.scale("a",.4).toString();e=Math.min(c.first.x,c.second.x)+.5;a=Math.min(c.first.y,c.second.y)+.5;var d=Math.abs(c.second.x-
c.first.x)-1,f=Math.abs(c.second.y-c.first.y)-1;b.fillRect(e,a,d,f);b.strokeRect(e,a,d,f);b.restore()}});b.hooks.shutdown.push(function(a,b){b.unbind("mousemove",r);b.unbind("mousedown",u);n&&m(document).unbind("mouseup",n)})},options:{selection:{mode:null,color:"#e8cfac",shape:"round",minSize:5}},name:"selection",version:"1.1"})})(jQuery);
